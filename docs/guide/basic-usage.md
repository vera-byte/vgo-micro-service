# åŸºæœ¬ä½¿ç”¨

æœ¬æŒ‡å—å°†å¸¦æ‚¨äº†è§£VGOå¾®æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€åº”ç”¨ç®¡ç†ç­‰æ ¸å¿ƒç‰¹æ€§ã€‚

## ğŸ¯ åŠŸèƒ½æ¦‚è§ˆ

VGOå¾®æœåŠ¡æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **ç”¨æˆ·ç®¡ç†**: åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ç”¨æˆ·
- **ç­–ç•¥ç®¡ç†**: å®šä¹‰å’Œç®¡ç†æƒé™ç­–ç•¥
- **è®¿é—®å¯†é’¥ç®¡ç†**: ç”Ÿæˆå’Œç®¡ç†APIè®¿é—®å¯†é’¥
- **åº”ç”¨ç®¡ç†**: OAuth2åº”ç”¨æ³¨å†Œå’Œç®¡ç†
- **æƒé™éªŒè¯**: ç»†ç²’åº¦çš„æƒé™æ£€æŸ¥
- **å¼€å‘è€…è®¤è¯**: ä¸ªäººå’Œä¼ä¸šå¼€å‘è€…èº«ä»½éªŒè¯

## ğŸ–¥ï¸ ä½¿ç”¨è°ƒè¯•ç•Œé¢

### è®¿é—®è°ƒè¯•ç•Œé¢

å¯åŠ¨æœåŠ¡åï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®è°ƒè¯•ç•Œé¢ï¼š

```
http://localhost:8080
```

è°ƒè¯•ç•Œé¢æä¾›äº†å‹å¥½çš„Webç•Œé¢æ¥ç®¡ç†æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- **ç”¨æˆ·ç®¡ç†é¡µé¢**: åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç”¨æˆ·
- **ç­–ç•¥ç®¡ç†é¡µé¢**: ç®¡ç†æƒé™ç­–ç•¥
- **è®¿é—®å¯†é’¥é¡µé¢**: ç”Ÿæˆå’Œç®¡ç†APIå¯†é’¥
- **åº”ç”¨ç®¡ç†é¡µé¢**: æ³¨å†Œå’Œç®¡ç†OAuth2åº”ç”¨
- **æƒé™æ£€æŸ¥é¡µé¢**: æµ‹è¯•æƒé™éªŒè¯

### ç•Œé¢åŠŸèƒ½è¯´æ˜

#### 1. ç”¨æˆ·ç®¡ç†

- **åˆ›å»ºç”¨æˆ·**: å¡«å†™ç”¨æˆ·åã€æ˜¾ç¤ºåç§°ã€é‚®ç®±ç­‰ä¿¡æ¯
- **æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨**: æ”¯æŒåˆ†é¡µå’Œæœç´¢
- **ç¼–è¾‘ç”¨æˆ·**: ä¿®æ”¹ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- **åˆ é™¤ç”¨æˆ·**: åˆ é™¤ä¸éœ€è¦çš„ç”¨æˆ·è´¦æˆ·

#### 2. ç­–ç•¥ç®¡ç†

- **åˆ›å»ºç­–ç•¥**: å®šä¹‰JSONæ ¼å¼çš„æƒé™ç­–ç•¥
- **ç­–ç•¥æ¨¡æ¿**: æä¾›å¸¸ç”¨ç­–ç•¥æ¨¡æ¿
- **ç­–ç•¥ç»‘å®š**: å°†ç­–ç•¥ç»‘å®šåˆ°ç”¨æˆ·
- **ç­–ç•¥éªŒè¯**: éªŒè¯ç­–ç•¥è¯­æ³•æ­£ç¡®æ€§

#### 3. è®¿é—®å¯†é’¥ç®¡ç†

- **ç”Ÿæˆå¯†é’¥**: ä¸ºç”¨æˆ·ç”ŸæˆAPIè®¿é—®å¯†é’¥
- **å¯†é’¥çŠ¶æ€**: å¯ç”¨/ç¦ç”¨è®¿é—®å¯†é’¥
- **å¯†é’¥è½®æ¢**: å®šæœŸæ›´æ–°è®¿é—®å¯†é’¥
- **ä½¿ç”¨ç»Ÿè®¡**: æŸ¥çœ‹å¯†é’¥ä½¿ç”¨æƒ…å†µ

#### 4. åº”ç”¨ç®¡ç†

- **æ³¨å†Œåº”ç”¨**: åˆ›å»ºOAuth2åº”ç”¨
- **åº”ç”¨é…ç½®**: è®¾ç½®å›è°ƒURLã€å…è®¸æ¥æºç­‰
- **åº”ç”¨ç±»å‹**: æ”¯æŒWebã€ç§»åŠ¨ã€APIã€SPAç­‰ç±»å‹
- **åº”ç”¨çŠ¶æ€**: ç®¡ç†åº”ç”¨çš„æ¿€æ´»çŠ¶æ€

## ğŸ”§ ä½¿ç”¨gRPC API

### å®‰è£…grpcurlå·¥å…·

```bash
# ä½¿ç”¨Goå®‰è£…
go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest

# æˆ–ä½¿ç”¨åŒ…ç®¡ç†å™¨
# macOS
brew install grpcurl

# Ubuntu/Debian
sudo apt install grpcurl
```

### ç”¨æˆ·ç®¡ç†API

#### åˆ›å»ºç”¨æˆ·

```bash
grpcurl -plaintext -d '{
  "name": "john_doe",
  "display_name": "John Doe",
  "email": "john@example.com"
}' localhost:50051 iam.v1.IAM/CreateUser
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "user": {
    "id": "1",
    "name": "john_doe",
    "display_name": "John Doe",
    "email": "john@example.com",
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯

```bash
grpcurl -plaintext -d '{
  "name": "john_doe"
}' localhost:50051 iam.v1.IAM/GetUser
```

#### æ›´æ–°ç”¨æˆ·ä¿¡æ¯

```bash
grpcurl -plaintext -d '{
  "name": "john_doe",
  "display_name": "John Smith",
  "email": "john.smith@example.com"
}' localhost:50051 iam.v1.IAM/UpdateUser
```

#### åˆ é™¤ç”¨æˆ·

```bash
grpcurl -plaintext -d '{
  "name": "john_doe"
}' localhost:50051 iam.v1.IAM/DeleteUser
```

#### è·å–ç”¨æˆ·åˆ—è¡¨

```bash
grpcurl -plaintext -d '{
  "page": 1,
  "page_size": 10
}' localhost:50051 iam.v1.IAM/ListUsers
```

### ç­–ç•¥ç®¡ç†API

#### åˆ›å»ºç­–ç•¥

```bash
grpcurl -plaintext -d '{
  "name": "read_only_policy",
  "description": "åªè¯»æƒé™ç­–ç•¥",
  "policy_document": "{\"Version\":\"2025-01-01\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"iam:GetUser\",\"iam:ListUsers\"],\"Resource\":[\"*\"]}]}"
}' localhost:50051 iam.v1.IAM/CreatePolicy
```

#### è·å–ç­–ç•¥

```bash
grpcurl -plaintext -d '{
  "name": "read_only_policy"
}' localhost:50051 iam.v1.IAM/GetPolicy
```

#### ç»‘å®šç­–ç•¥åˆ°ç”¨æˆ·

```bash
grpcurl -plaintext -d '{
  "user_name": "john_doe",
  "policy_name": "read_only_policy"
}' localhost:50051 iam.v1.IAM/AttachUserPolicy
```

#### è§£ç»‘ç”¨æˆ·ç­–ç•¥

```bash
grpcurl -plaintext -d '{
  "user_name": "john_doe",
  "policy_name": "read_only_policy"
}' localhost:50051 iam.v1.IAM/DetachUserPolicy
```

### è®¿é—®å¯†é’¥ç®¡ç†API

#### åˆ›å»ºè®¿é—®å¯†é’¥

```bash
grpcurl -plaintext -d '{
  "user_name": "john_doe",
  "description": "APIè®¿é—®å¯†é’¥"
}' localhost:50051 iam.v1.IAM/CreateAccessKey
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "access_key": {
    "access_key_id": "AKIA1234567890EXAMPLE",
    "secret_access_key": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
    "status": "active",
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```

#### è·å–è®¿é—®å¯†é’¥åˆ—è¡¨

```bash
grpcurl -plaintext -d '{
  "user_name": "john_doe"
}' localhost:50051 iam.v1.IAM/ListAccessKeys
```

#### æ›´æ–°è®¿é—®å¯†é’¥çŠ¶æ€

```bash
grpcurl -plaintext -d '{
  "access_key_id": "AKIA1234567890EXAMPLE",
  "status": "inactive"
}' localhost:50051 iam.v1.IAM/UpdateAccessKey
```

#### åˆ é™¤è®¿é—®å¯†é’¥

```bash
grpcurl -plaintext -d '{
  "access_key_id": "AKIA1234567890EXAMPLE"
}' localhost:50051 iam.v1.IAM/DeleteAccessKey
```

### åº”ç”¨ç®¡ç†API

#### åˆ›å»ºåº”ç”¨

```bash
grpcurl -plaintext -d '{
  "app_name": "MyWebApp",
  "app_description": "æˆ‘çš„Webåº”ç”¨",
  "app_type": "web",
  "app_website": "https://myapp.example.com",
  "callback_urls": ["https://myapp.example.com/callback"],
  "allowed_origins": ["https://myapp.example.com"]
}' localhost:50051 iam.v1.IAM/CreateApplication
```

#### è·å–åº”ç”¨ä¿¡æ¯

```bash
grpcurl -plaintext -d '{
  "app_id": 1
}' localhost:50051 iam.v1.IAM/GetApplication
```

#### æ›´æ–°åº”ç”¨

```bash
grpcurl -plaintext -d '{
  "app_id": 1,
  "app_name": "UpdatedWebApp",
  "app_description": "æ›´æ–°åçš„Webåº”ç”¨",
  "app_type": "spa"
}' localhost:50051 iam.v1.IAM/UpdateApplication
```

#### è·å–åº”ç”¨åˆ—è¡¨

```bash
grpcurl -plaintext -d '{
  "user_name": "john_doe",
  "status": "active",
  "page": 1,
  "page_size": 10
}' localhost:50051 iam.v1.IAM/ListApplications
```

#### åˆ é™¤åº”ç”¨

```bash
grpcurl -plaintext -d '{
  "app_id": 1
}' localhost:50051 iam.v1.IAM/DeleteApplication
```

### æƒé™éªŒè¯API

#### æ£€æŸ¥æƒé™

```bash
grpcurl -plaintext -d '{
  "user_name": "john_doe",
  "action": "iam:GetUser",
  "resource": "*"
}' localhost:50051 iam.v1.IAM/CheckPermission
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "allowed": true,
  "reason": "User has required permissions"
}
```

## ğŸ” æƒé™ç­–ç•¥è¯­æ³•

### ç­–ç•¥æ–‡æ¡£ç»“æ„

```json
{
  "Version": "2025-01-01",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "iam:GetUser",
        "iam:ListUsers"
      ],
      "Resource": ["*"]
    }
  ]
}
```

### ç­–ç•¥å…ƒç´ è¯´æ˜

- **Version**: ç­–ç•¥è¯­è¨€ç‰ˆæœ¬
- **Statement**: æƒé™å£°æ˜æ•°ç»„
- **Effect**: æƒé™æ•ˆæœï¼ˆAllow/Denyï¼‰
- **Action**: å…è®¸æˆ–æ‹’ç»çš„æ“ä½œ
- **Resource**: æ“ä½œçš„èµ„æºèŒƒå›´

### å¸¸ç”¨ç­–ç•¥ç¤ºä¾‹

#### 1. ç®¡ç†å‘˜ç­–ç•¥

```json
{
  "Version": "2025-01-01",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*"
    }
  ]
}
```

#### 2. åªè¯»ç­–ç•¥

```json
{
  "Version": "2025-01-01",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "iam:GetUser",
        "iam:ListUsers",
        "iam:GetPolicy",
        "iam:ListPolicies",
        "iam:GetApplication",
        "iam:ListApplications"
      ],
      "Resource": "*"
    }
  ]
}
```

#### 3. ç”¨æˆ·è‡ªç®¡ç†ç­–ç•¥

```json
{
  "Version": "2025-01-01",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "iam:GetUser",
        "iam:UpdateUser",
        "iam:CreateAccessKey",
        "iam:ListAccessKeys",
        "iam:UpdateAccessKey",
        "iam:DeleteAccessKey"
      ],
      "Resource": "arn:iam::user/${aws:username}"
    }
  ]
}
```

#### 4. åº”ç”¨ç®¡ç†ç­–ç•¥

```json
{
  "Version": "2025-01-01",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "iam:CreateApplication",
        "iam:GetApplication",
        "iam:UpdateApplication",
        "iam:DeleteApplication",
        "iam:ListApplications"
      ],
      "Resource": "*"
    }
  ]
}
```

## ğŸ”‘ APIè®¤è¯

### ä½¿ç”¨è®¿é—®å¯†é’¥è®¤è¯

åœ¨è°ƒç”¨APIæ—¶ï¼Œéœ€è¦ä½¿ç”¨è®¿é—®å¯†é’¥è¿›è¡Œè®¤è¯ï¼š

```bash
# è®¾ç½®è®¤è¯å¤´
export ACCESS_KEY_ID="your_access_key_id"
export SECRET_ACCESS_KEY="your_secret_access_key"

# ä½¿ç”¨è®¤è¯è°ƒç”¨API
grpcurl -plaintext \
  -H "Authorization: AWS4-HMAC-SHA256 Credential=$ACCESS_KEY_ID/..." \
  -d '{"name":"john_doe"}' \
  localhost:50051 iam.v1.IAM/GetUser
```

### ç­¾åè®¡ç®—

VGOä½¿ç”¨AWS Signature Version 4ç®—æ³•è¿›è¡ŒAPIç­¾åéªŒè¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®˜æ–¹SDKæˆ–è‡ªè¡Œå®ç°ç­¾åç®—æ³•ã€‚

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8080/health

# æŸ¥çœ‹PrometheusæŒ‡æ ‡
curl http://localhost:9090/metrics
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# Docker Composeç¯å¢ƒ
docker-compose logs -f vgo-iam

# ç›´æ¥è¿è¡Œ
tail -f logs/iam.log
```

## ğŸ”§ å¸¸ç”¨æ“ä½œè„šæœ¬

### æ‰¹é‡åˆ›å»ºç”¨æˆ·

```bash
#!/bin/bash

# æ‰¹é‡åˆ›å»ºç”¨æˆ·è„šæœ¬
users=(
  "alice:Alice Smith:alice@example.com"
  "bob:Bob Johnson:bob@example.com"
  "charlie:Charlie Brown:charlie@example.com"
)

for user in "${users[@]}"; do
  IFS=':' read -r name display_name email <<< "$user"
  
  grpcurl -plaintext -d "{
    \"name\": \"$name\",
    \"display_name\": \"$display_name\",
    \"email\": \"$email\"
  }" localhost:50051 iam.v1.IAM/CreateUser
  
  echo "Created user: $name"
done
```

### æ‰¹é‡ç»‘å®šç­–ç•¥

```bash
#!/bin/bash

# æ‰¹é‡ç»‘å®šç­–ç•¥è„šæœ¬
users=("alice" "bob" "charlie")
policy="read_only_policy"

for user in "${users[@]}"; do
  grpcurl -plaintext -d "{
    \"user_name\": \"$user\",
    \"policy_name\": \"$policy\"
  }" localhost:50051 iam.v1.IAM/AttachUserPolicy
  
  echo "Attached policy $policy to user: $user"
done
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

#### 1. æƒé™è¢«æ‹’ç»

```
Error: permission denied
```

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”æƒé™
- éªŒè¯ç­–ç•¥é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤è®¿é—®å¯†é’¥çŠ¶æ€ä¸ºactive

#### 2. ç”¨æˆ·ä¸å­˜åœ¨

```
Error: user not found
```

è§£å†³æ–¹æ¡ˆï¼š
- ç¡®è®¤ç”¨æˆ·åæ‹¼å†™æ­£ç¡®
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²åˆ›å»º
- éªŒè¯æ•°æ®åº“è¿æ¥æ­£å¸¸

#### 3. ç­–ç•¥è¯­æ³•é”™è¯¯

```
Error: invalid policy document
```

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æŸ¥JSONè¯­æ³•æ˜¯å¦æ­£ç¡®
- éªŒè¯ç­–ç•¥å­—æ®µæ˜¯å¦å®Œæ•´
- ä½¿ç”¨ç­–ç•¥éªŒè¯å·¥å…·æ£€æŸ¥

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è°ƒè¯•æ—¥å¿—**ï¼š
   ```yaml
   log:
     level: debug
   ```

2. **ä½¿ç”¨å¥åº·æ£€æŸ¥**ï¼š
   ```bash
   curl http://localhost:8080/health
   ```

3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**ï¼š
   ```bash
   grpcurl -plaintext -v localhost:50051 list
   ```

## ğŸ“š ä¸‹ä¸€æ­¥

ç°åœ¨æ‚¨å·²ç»äº†è§£äº†VGOçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ ï¼š

- [APIæ–‡æ¡£](/api/) - è¯¦ç»†çš„APIæ¥å£è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](/deployment/) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [å¼€å‘æŒ‡å—](/development/) - å‚ä¸é¡¹ç›®å¼€å‘

::: tip æç¤º
å»ºè®®åœ¨å¼€å‘ç¯å¢ƒä¸­å…ˆç†Ÿæ‚‰å„é¡¹åŠŸèƒ½ï¼Œç„¶åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚
:::

::: warning æ³¨æ„
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶ï¼Œè¯·ç¡®ä¿ï¼š
- ä½¿ç”¨å¼ºå¯†ç å’Œå®‰å…¨çš„è®¿é—®å¯†é’¥
- å®šæœŸè½®æ¢è®¿é—®å¯†é’¥
- é…ç½®é€‚å½“çš„æƒé™ç­–ç•¥
- å¯ç”¨ç›‘æ§å’Œæ—¥å¿—è®°å½•
:::