<template><div><h1 id="ç›‘æ§é…ç½®" tabindex="-1"><a class="header-anchor" href="#ç›‘æ§é…ç½®">#</a> ç›‘æ§é…ç½®</h1>
<p>VGOå¾®æœåŠ¡æä¾›äº†å®Œæ•´çš„ç›‘æ§è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æŒ‡æ ‡æ”¶é›†ã€æ—¥å¿—èšåˆã€é“¾è·¯è¿½è¸ªå’Œå‘Šè­¦é€šçŸ¥ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é…ç½®å’Œä½¿ç”¨è¿™äº›ç›‘æ§ç»„ä»¶ã€‚</p>
<h2 id="ğŸ“Š-ç›‘æ§æ¶æ„" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-ç›‘æ§æ¶æ„">#</a> ğŸ“Š ç›‘æ§æ¶æ„</h2>
<h3 id="ç›‘æ§ç»„ä»¶å›¾" tabindex="-1"><a class="header-anchor" href="#ç›‘æ§ç»„ä»¶å›¾">#</a> ç›‘æ§ç»„ä»¶å›¾</h3>
<div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid"><pre v-pre><code class="language-mermaid"><span class="line"><span class="token keyword">graph</span> TB</span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"åº”ç”¨å±‚"</span></span>
<span class="line">        A<span class="token text string">[IAM Service]</span></span>
<span class="line">        B<span class="token text string">[Web UI]</span></span>
<span class="line">        C<span class="token text string">[gRPC Client]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"æŒ‡æ ‡æ”¶é›†"</span></span>
<span class="line">        D<span class="token text string">[Prometheus]</span></span>
<span class="line">        E<span class="token text string">[Node Exporter]</span></span>
<span class="line">        F<span class="token text string">[Postgres Exporter]</span></span>
<span class="line">        G<span class="token text string">[Redis Exporter]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"æ—¥å¿—æ”¶é›†"</span></span>
<span class="line">        H<span class="token text string">[Fluent Bit]</span></span>
<span class="line">        I<span class="token text string">[Elasticsearch]</span></span>
<span class="line">        J<span class="token text string">[Kibana]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"é“¾è·¯è¿½è¸ª"</span></span>
<span class="line">        K<span class="token text string">[Jaeger]</span></span>
<span class="line">        L<span class="token text string">[Jaeger Collector]</span></span>
<span class="line">        M<span class="token text string">[Jaeger Query]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"å‘Šè­¦é€šçŸ¥"</span></span>
<span class="line">        N<span class="token text string">[AlertManager]</span></span>
<span class="line">        O<span class="token text string">[Webhook]</span></span>
<span class="line">        P<span class="token text string">[Email/Slack]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"å¯è§†åŒ–"</span></span>
<span class="line">        Q<span class="token text string">[Grafana]</span></span>
<span class="line">        R<span class="token text string">[Dashboard]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    A <span class="token arrow operator">--></span> D</span>
<span class="line">    A <span class="token arrow operator">--></span> H</span>
<span class="line">    A <span class="token arrow operator">--></span> K</span>
<span class="line">    </span>
<span class="line">    D <span class="token arrow operator">--></span> N</span>
<span class="line">    D <span class="token arrow operator">--></span> Q</span>
<span class="line">    </span>
<span class="line">    H <span class="token arrow operator">--></span> I</span>
<span class="line">    I <span class="token arrow operator">--></span> J</span>
<span class="line">    </span>
<span class="line">    K <span class="token arrow operator">--></span> L</span>
<span class="line">    L <span class="token arrow operator">--></span> M</span>
<span class="line">    </span>
<span class="line">    N <span class="token arrow operator">--></span> O</span>
<span class="line">    O <span class="token arrow operator">--></span> P</span>
<span class="line">    </span>
<span class="line">    Q <span class="token arrow operator">--></span> R</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç›‘æ§æŒ‡æ ‡åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#ç›‘æ§æŒ‡æ ‡åˆ†ç±»">#</a> ç›‘æ§æŒ‡æ ‡åˆ†ç±»</h3>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>æŒ‡æ ‡ç±»å‹</th>
<th>ç¤ºä¾‹æŒ‡æ ‡</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>åº”ç”¨æŒ‡æ ‡</td>
<td>Counter, Histogram</td>
<td>grpc_requests_total, http_request_duration</td>
<td>ä¸šåŠ¡ç›‘æ§</td>
</tr>
<tr>
<td>ç³»ç»ŸæŒ‡æ ‡</td>
<td>Gauge, Counter</td>
<td>cpu_usage, memory_usage, disk_io</td>
<td>èµ„æºç›‘æ§</td>
</tr>
<tr>
<td>æ•°æ®åº“æŒ‡æ ‡</td>
<td>Gauge, Counter</td>
<td>pg_connections, pg_query_duration</td>
<td>æ•°æ®åº“ç›‘æ§</td>
</tr>
<tr>
<td>ç¼“å­˜æŒ‡æ ‡</td>
<td>Gauge, Counter</td>
<td>redis_connected_clients, redis_memory_usage</td>
<td>ç¼“å­˜ç›‘æ§</td>
</tr>
<tr>
<td>ç½‘ç»œæŒ‡æ ‡</td>
<td>Counter, Histogram</td>
<td>network_bytes_sent, network_latency</td>
<td>ç½‘ç»œç›‘æ§</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ”§-prometheusé…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-prometheusé…ç½®">#</a> ğŸ”§ Prometheusé…ç½®</h2>
<h3 id="_1-prometheuséƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_1-prometheuséƒ¨ç½²">#</a> 1. Prometheuséƒ¨ç½²</h3>
<h4 id="docker-composeé…ç½®" tabindex="-1"><a class="header-anchor" href="#docker-composeé…ç½®">#</a> Docker Composeé…ç½®</h4>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.monitoring.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">prometheus</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/prometheus<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>prometheus</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9090:9090"</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./monitoring/prometheus<span class="token punctuation">:</span>/etc/prometheus</span>
<span class="line">      <span class="token punctuation">-</span> prometheus_data<span class="token punctuation">:</span>/prometheus</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--config.file=/etc/prometheus/prometheus.yml'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--storage.tsdb.path=/prometheus'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--web.console.libraries=/etc/prometheus/console_libraries'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--web.console.templates=/etc/prometheus/consoles'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--storage.tsdb.retention.time=200h'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--web.enable-lifecycle'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--web.enable-admin-api'</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.prometheus.rule=Host(`prometheus.vgo.local`)"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.prometheus.loadbalancer.server.port=9090"</span></span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">node-exporter</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/node<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>node<span class="token punctuation">-</span>exporter</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9100:9100"</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> /proc<span class="token punctuation">:</span>/host/proc<span class="token punctuation">:</span>ro</span>
<span class="line">      <span class="token punctuation">-</span> /sys<span class="token punctuation">:</span>/host/sys<span class="token punctuation">:</span>ro</span>
<span class="line">      <span class="token punctuation">-</span> /<span class="token punctuation">:</span>/rootfs<span class="token punctuation">:</span>ro</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--path.procfs=/host/proc'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--path.rootfs=/rootfs'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--path.sysfs=/host/sys'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">postgres-exporter</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> prometheuscommunity/postgres<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>postgres<span class="token punctuation">-</span>exporter</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9187:9187"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">DATA_SOURCE_NAME</span><span class="token punctuation">:</span> <span class="token string">"postgresql://vgo_user:your_password@postgres:5432/vgo_db?sslmode=disable"</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> postgres</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">redis-exporter</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> oliver006/redis_exporter<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>exporter</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9121:9121"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">REDIS_ADDR</span><span class="token punctuation">:</span> <span class="token string">"redis://redis:6379"</span></span>
<span class="line">      <span class="token key atrule">REDIS_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">"your_redis_password"</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> redis</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">prometheus_data</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">vgo-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="prometheusé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#prometheusé…ç½®æ–‡ä»¶">#</a> Prometheusé…ç½®æ–‡ä»¶</h4>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># monitoring/prometheus/prometheus.yml</span></span>
<span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">  <span class="token key atrule">external_labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> <span class="token string">'vgo-cluster'</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token string">'production'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">rule_files</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">"rules/*.yml"</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">alerting</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token punctuation">-</span> alertmanager<span class="token punctuation">:</span><span class="token number">9093</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># Prometheusè‡ªèº«</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'prometheus'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'localhost:9090'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 5s</span>
<span class="line">    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /metrics</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># VGO IAMæœåŠ¡</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'vgo-iam'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'iam:8082'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 10s</span>
<span class="line">    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /metrics</span>
<span class="line">    <span class="token key atrule">relabel_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__address__<span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> instance</span>
<span class="line">        <span class="token key atrule">replacement</span><span class="token punctuation">:</span> <span class="token string">'vgo-iam'</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># ç³»ç»ŸæŒ‡æ ‡</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'node-exporter'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node-exporter:9100'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">    <span class="token key atrule">relabel_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__address__<span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> instance</span>
<span class="line">        <span class="token key atrule">replacement</span><span class="token punctuation">:</span> <span class="token string">'vgo-host'</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># PostgreSQLæŒ‡æ ‡</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'postgres-exporter'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'postgres-exporter:9187'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">    <span class="token key atrule">relabel_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__address__<span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> instance</span>
<span class="line">        <span class="token key atrule">replacement</span><span class="token punctuation">:</span> <span class="token string">'vgo-postgres'</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># RedisæŒ‡æ ‡</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'redis-exporter'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'redis-exporter:9121'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">    <span class="token key atrule">relabel_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__address__<span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> instance</span>
<span class="line">        <span class="token key atrule">replacement</span><span class="token punctuation">:</span> <span class="token string">'vgo-redis'</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># Dockerå®¹å™¨æŒ‡æ ‡</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'cadvisor'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'cadvisor:8080'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /metrics</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># Blackboxæ¢æµ‹</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'blackbox'</span></span>
<span class="line">    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /probe</span>
<span class="line">    <span class="token key atrule">params</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">module</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>http_2xx<span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//iam<span class="token punctuation">:</span>8080/health</span>
<span class="line">        <span class="token punctuation">-</span> http<span class="token punctuation">:</span>//iam<span class="token punctuation">:</span>8081/ready</span>
<span class="line">    <span class="token key atrule">relabel_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__address__<span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> __param_target</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__param_target<span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">target_label</span><span class="token punctuation">:</span> instance</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">target_label</span><span class="token punctuation">:</span> __address__</span>
<span class="line">        <span class="token key atrule">replacement</span><span class="token punctuation">:</span> blackbox<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span><span class="token number">9115</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å‘Šè­¦è§„åˆ™é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-å‘Šè­¦è§„åˆ™é…ç½®">#</a> 2. å‘Šè­¦è§„åˆ™é…ç½®</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># monitoring/prometheus/rules/vgo-alerts.yml</span></span>
<span class="line"><span class="token key atrule">groups</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam<span class="token punctuation">-</span>alerts</span>
<span class="line">    <span class="token key atrule">rules</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># æœåŠ¡å¯ç”¨æ€§å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> VGOServiceDown</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> up<span class="token punctuation">{</span>job="vgo<span class="token punctuation">-</span>iam"<span class="token punctuation">}</span> == 0</span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡ä¸å¯ç”¨"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡å·²ç»åœæ­¢å“åº”è¶…è¿‡1åˆ†é’Ÿ"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># é«˜é”™è¯¯ç‡å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> VGOHighErrorRate</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            rate(grpc_server_handled_total{grpc_code!="OK",job="vgo-iam"}[5m])</span>
<span class="line">            /</span>
<span class="line">            rate(grpc_server_handled_total{job="vgo-iam"}[5m])</span>
<span class="line">          ) > 0.05</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡é”™è¯¯ç‡è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡5åˆ†é’Ÿå†…é”™è¯¯ç‡è¶…è¿‡5%ï¼Œå½“å‰å€¼ï¼š{{ $value | humanizePercentage }}"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># é«˜å»¶è¿Ÿå‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> VGOHighLatency</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          histogram_quantile(0.95,</span>
<span class="line">            rate(grpc_server_handling_seconds_bucket{job="vgo-iam"}[5m])</span>
<span class="line">          ) > 1</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡å»¶è¿Ÿè¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡95%åˆ†ä½å»¶è¿Ÿè¶…è¿‡1ç§’ï¼Œå½“å‰å€¼ï¼š{{ $value }}s"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> VGOHighMemoryUsage</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            process_resident_memory_bytes{job="vgo-iam"}</span>
<span class="line">            /</span>
<span class="line">            (1024*1024*1024)</span>
<span class="line">          ) > 1</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡å†…å­˜ä½¿ç”¨è¶…è¿‡1GBï¼Œå½“å‰å€¼ï¼š{{ $value | humanize }}B"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># CPUä½¿ç”¨ç‡å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> VGOHighCPUUsage</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          rate(process_cpu_seconds_total{job="vgo-iam"}[5m]) * 100 > 80</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡CPUä½¿ç”¨ç‡è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"VGO IAMæœåŠ¡CPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼ï¼š{{ $value | humanizePercentage }}"</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>database<span class="token punctuation">-</span>alerts</span>
<span class="line">    <span class="token key atrule">rules</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># æ•°æ®åº“è¿æ¥æ•°å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> PostgreSQLHighConnections</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          pg_stat_database_numbackends{datname="vgo_db"} > 80</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> postgresql</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"PostgreSQLè¿æ¥æ•°è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"PostgreSQLæ•°æ®åº“è¿æ¥æ•°è¶…è¿‡80ï¼Œå½“å‰å€¼ï¼š{{ $value }}"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># æ•°æ®åº“æŸ¥è¯¢æ—¶é—´å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> PostgreSQLSlowQueries</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          pg_stat_activity_max_tx_duration{datname="vgo_db"} > 300</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> postgresql</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"PostgreSQLå­˜åœ¨æ…¢æŸ¥è¯¢"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"PostgreSQLå­˜åœ¨æ‰§è¡Œæ—¶é—´è¶…è¿‡5åˆ†é’Ÿçš„æŸ¥è¯¢ï¼Œå½“å‰æœ€é•¿ï¼š{{ $value }}ç§’"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># æ•°æ®åº“ç£ç›˜ç©ºé—´å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> PostgreSQLDiskSpaceLow</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            pg_database_size_bytes{datname="vgo_db"}</span>
<span class="line">            /</span>
<span class="line">            (1024*1024*1024)</span>
<span class="line">          ) > 50</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> postgresql</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"PostgreSQLç£ç›˜ç©ºé—´ä¸è¶³"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"PostgreSQLæ•°æ®åº“å¤§å°è¶…è¿‡50GBï¼Œå½“å‰å€¼ï¼š{{ $value | humanize }}B"</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>alerts</span>
<span class="line">    <span class="token key atrule">rules</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># Rediså†…å­˜ä½¿ç”¨å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> RedisHighMemoryUsage</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            redis_memory_used_bytes</span>
<span class="line">            /</span>
<span class="line">            redis_memory_max_bytes</span>
<span class="line">          ) > 0.8</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> redis</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Rediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Rediså†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼ï¼š{{ $value | humanizePercentage }}"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># Redisè¿æ¥æ•°å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> RedisHighConnections</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> redis_connected_clients <span class="token punctuation">></span> 100</span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> redis</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Redisè¿æ¥æ•°è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Redisè¿æ¥æ•°è¶…è¿‡100ï¼Œå½“å‰å€¼ï¼š{{ $value }}"</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>system<span class="token punctuation">-</span>alerts</span>
<span class="line">    <span class="token key atrule">rules</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># ç³»ç»ŸCPUä½¿ç”¨ç‡å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> SystemHighCPUUsage</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)</span>
<span class="line">          ) > 80</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> system</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"ç³»ç»ŸCPUä½¿ç”¨ç‡è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"ç³»ç»ŸCPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼ï¼š{{ $value | humanizePercentage }}"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> SystemHighMemoryUsage</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)</span>
<span class="line">            /</span>
<span class="line">            node_memory_MemTotal_bytes</span>
<span class="line">          ) > 0.8</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> system</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼ï¼š{{ $value | humanizePercentage }}"</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment"># ç³»ç»Ÿç£ç›˜ç©ºé—´å‘Šè­¦</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> SystemDiskSpaceLow</span>
<span class="line">        <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          (</span>
<span class="line">            (node_filesystem_size_bytes{fstype!="tmpfs"} - node_filesystem_free_bytes{fstype!="tmpfs"})</span>
<span class="line">            /</span>
<span class="line">            node_filesystem_size_bytes{fstype!="tmpfs"}</span>
<span class="line">          ) > 0.8</span></span>
<span class="line">        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m</span>
<span class="line">        <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical</span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span> system</span>
<span class="line">        <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"ç³»ç»Ÿç£ç›˜ç©ºé—´ä¸è¶³"</span></span>
<span class="line">          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"ç³»ç»Ÿç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡80%ï¼ŒæŒ‚è½½ç‚¹ï¼š{{ $labels.mountpoint }}ï¼Œå½“å‰å€¼ï¼š{{ $value | humanizePercentage }}"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“ˆ-grafanaé…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ“ˆ-grafanaé…ç½®">#</a> ğŸ“ˆ Grafanaé…ç½®</h2>
<h3 id="_1-grafanaéƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_1-grafanaéƒ¨ç½²">#</a> 1. Grafanaéƒ¨ç½²</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.grafana.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">grafana</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>grafana</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"3000:3000"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> GF_SECURITY_ADMIN_PASSWORD=admin123</span>
<span class="line">      <span class="token punctuation">-</span> GF_USERS_ALLOW_SIGN_UP=false</span>
<span class="line">      <span class="token punctuation">-</span> GF_INSTALL_PLUGINS=grafana<span class="token punctuation">-</span>piechart<span class="token punctuation">-</span>panel<span class="token punctuation">,</span>grafana<span class="token punctuation">-</span>worldmap<span class="token punctuation">-</span>panel</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> grafana_data<span class="token punctuation">:</span>/var/lib/grafana</span>
<span class="line">      <span class="token punctuation">-</span> ./monitoring/grafana/provisioning<span class="token punctuation">:</span>/etc/grafana/provisioning</span>
<span class="line">      <span class="token punctuation">-</span> ./monitoring/grafana/dashboards<span class="token punctuation">:</span>/var/lib/grafana/dashboards</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.grafana.rule=Host(`grafana.vgo.local`)"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.grafana.loadbalancer.server.port=3000"</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> prometheus</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">grafana_data</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">vgo-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æ•°æ®æºé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®æºé…ç½®">#</a> 2. æ•°æ®æºé…ç½®</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># monitoring/grafana/provisioning/datasources/prometheus.yml</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">datasources</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Prometheus</span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> prometheus</span>
<span class="line">    <span class="token key atrule">access</span><span class="token punctuation">:</span> proxy</span>
<span class="line">    <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheus<span class="token punctuation">:</span><span class="token number">9090</span></span>
<span class="line">    <span class="token key atrule">isDefault</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">editable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">jsonData</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">timeInterval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">      <span class="token key atrule">queryTimeout</span><span class="token punctuation">:</span> 60s</span>
<span class="line">      <span class="token key atrule">httpMethod</span><span class="token punctuation">:</span> POST</span>
<span class="line">    <span class="token key atrule">secureJsonData</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Jaeger</span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> jaeger</span>
<span class="line">    <span class="token key atrule">access</span><span class="token punctuation">:</span> proxy</span>
<span class="line">    <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//jaeger<span class="token punctuation">-</span>query<span class="token punctuation">:</span><span class="token number">16686</span></span>
<span class="line">    <span class="token key atrule">editable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">jsonData</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">tracesToLogs</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">datasourceUid</span><span class="token punctuation">:</span> <span class="token string">'loki'</span></span>
<span class="line">        <span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'job'</span><span class="token punctuation">,</span> <span class="token string">'instance'</span><span class="token punctuation">,</span> <span class="token string">'pod'</span><span class="token punctuation">,</span> <span class="token string">'namespace'</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">mappedTags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">'service.name'</span><span class="token punctuation">,</span> <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'service'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">mapTagNamesEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">        <span class="token key atrule">spanStartTimeShift</span><span class="token punctuation">:</span> <span class="token string">'1h'</span></span>
<span class="line">        <span class="token key atrule">spanEndTimeShift</span><span class="token punctuation">:</span> <span class="token string">'1h'</span></span>
<span class="line">        <span class="token key atrule">filterByTraceID</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">        <span class="token key atrule">filterBySpanID</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Loki</span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> loki</span>
<span class="line">    <span class="token key atrule">access</span><span class="token punctuation">:</span> proxy</span>
<span class="line">    <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki<span class="token punctuation">:</span><span class="token number">3100</span></span>
<span class="line">    <span class="token key atrule">editable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">jsonData</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">maxLines</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">      <span class="token key atrule">derivedFields</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">datasourceUid</span><span class="token punctuation">:</span> <span class="token string">'jaeger'</span></span>
<span class="line">          <span class="token key atrule">matcherRegex</span><span class="token punctuation">:</span> <span class="token string">'trace_id=(\w+)'</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'TraceID'</span></span>
<span class="line">          <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">'$${__value.raw}'</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ä»ªè¡¨æ¿é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-ä»ªè¡¨æ¿é…ç½®">#</a> 3. ä»ªè¡¨æ¿é…ç½®</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># monitoring/grafana/provisioning/dashboards/dashboards.yml</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">providers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'VGO Dashboards'</span></span>
<span class="line">    <span class="token key atrule">orgId</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">    <span class="token key atrule">folder</span><span class="token punctuation">:</span> <span class="token string">'VGO'</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> file</span>
<span class="line">    <span class="token key atrule">disableDeletion</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">    <span class="token key atrule">updateIntervalSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">    <span class="token key atrule">allowUiUpdates</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">options</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/lib/grafana/dashboards</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-vgoæœåŠ¡ä»ªè¡¨æ¿" tabindex="-1"><a class="header-anchor" href="#_4-vgoæœåŠ¡ä»ªè¡¨æ¿">#</a> 4. VGOæœåŠ¡ä»ªè¡¨æ¿</h3>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"dashboard"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"VGO IAM Service"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vgo"</span><span class="token punctuation">,</span> <span class="token string">"iam"</span><span class="token punctuation">,</span> <span class="token string">"microservice"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"timezone"</span><span class="token operator">:</span> <span class="token string">"browser"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"panels"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"è¯·æ±‚é€Ÿç‡"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"rate(grpc_server_handled_total{job=\"vgo-iam\"}[5m])"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"RPS"</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"reqps"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"color"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"thresholds"</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"é”™è¯¯ç‡"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"rate(grpc_server_handled_total{job=\"vgo-iam\",grpc_code!=\"OK\"}[5m]) / rate(grpc_server_handled_total{job=\"vgo-iam\"}[5m])"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"Error Rate"</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"percentunit"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"color"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"thresholds"</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">0.05</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"å“åº”æ—¶é—´"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"histogram_quantile(0.95, rate(grpc_server_handling_seconds_bucket{job=\"vgo-iam\"}[5m]))"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"P95 Latency"</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"s"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"color"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"thresholds"</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"æ´»è·ƒè¿æ¥æ•°"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"grpc_server_started_total{job=\"vgo-iam\"} - grpc_server_handled_total{job=\"vgo-iam\"}"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"Active Connections"</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"short"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"color"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"thresholds"</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"è¯·æ±‚é€Ÿç‡è¶‹åŠ¿"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"rate(grpc_server_handled_total{job=\"vgo-iam\"}[5m])"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{{grpc_method}}"</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"reqps"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"custom"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"drawStyle"</span><span class="token operator">:</span> <span class="token string">"line"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"lineInterpolation"</span><span class="token operator">:</span> <span class="token string">"linear"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"lineWidth"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"fillOpacity"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"gradientMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"spanNulls"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"pointSize"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"stacking"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span> <span class="token property">"group"</span><span class="token operator">:</span> <span class="token string">"A"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"axisPlacement"</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"axisLabel"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"scaleDistribution"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"linear"</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"å“åº”æ—¶é—´åˆ†å¸ƒ"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"histogram_quantile(0.50, rate(grpc_server_handling_seconds_bucket{job=\"vgo-iam\"}[5m]))"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"P50"</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"histogram_quantile(0.95, rate(grpc_server_handling_seconds_bucket{job=\"vgo-iam\"}[5m]))"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"P95"</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"histogram_quantile(0.99, rate(grpc_server_handling_seconds_bucket{job=\"vgo-iam\"}[5m]))"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"P99"</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"s"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">"custom"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">"drawStyle"</span><span class="token operator">:</span> <span class="token string">"line"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"lineInterpolation"</span><span class="token operator">:</span> <span class="token string">"linear"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"lineWidth"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"fillOpacity"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"gradientMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"spanNulls"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"pointSize"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"stacking"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span> <span class="token property">"group"</span><span class="token operator">:</span> <span class="token string">"A"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"axisPlacement"</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"axisLabel"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token property">"scaleDistribution"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"linear"</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"time"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"from"</span><span class="token operator">:</span> <span class="token string">"now-1h"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"to"</span><span class="token operator">:</span> <span class="token string">"now"</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"refresh"</span><span class="token operator">:</span> <span class="token string">"5s"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"schemaVersion"</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-é“¾è·¯è¿½è¸ªé…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ”-é“¾è·¯è¿½è¸ªé…ç½®">#</a> ğŸ” é“¾è·¯è¿½è¸ªé…ç½®</h2>
<h3 id="_1-jaegeréƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_1-jaegeréƒ¨ç½²">#</a> 1. Jaegeréƒ¨ç½²</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.jaeger.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">jaeger-collector</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> jaegertracing/jaeger<span class="token punctuation">-</span>collector<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>jaeger<span class="token punctuation">-</span>collector</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"14268:14268"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"14250:14250"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> SPAN_STORAGE_TYPE=elasticsearch</span>
<span class="line">      <span class="token punctuation">-</span> ES_SERVER_URLS=http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span></span>
<span class="line">      <span class="token punctuation">-</span> ES_USERNAME=elastic</span>
<span class="line">      <span class="token punctuation">-</span> ES_PASSWORD=changeme</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">jaeger-query</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> jaegertracing/jaeger<span class="token punctuation">-</span>query<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>jaeger<span class="token punctuation">-</span>query</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"16686:16686"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> SPAN_STORAGE_TYPE=elasticsearch</span>
<span class="line">      <span class="token punctuation">-</span> ES_SERVER_URLS=http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span></span>
<span class="line">      <span class="token punctuation">-</span> ES_USERNAME=elastic</span>
<span class="line">      <span class="token punctuation">-</span> ES_PASSWORD=changeme</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.jaeger.rule=Host(`jaeger.vgo.local`)"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.jaeger.loadbalancer.server.port=16686"</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">jaeger-agent</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> jaegertracing/jaeger<span class="token punctuation">-</span>agent<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>jaeger<span class="token punctuation">-</span>agent</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"6831:6831/udp"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"6832:6832/udp"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"5778:5778"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> REPORTER_GRPC_HOST_PORT=jaeger<span class="token punctuation">-</span>collector<span class="token punctuation">:</span><span class="token number">14250</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> jaeger<span class="token punctuation">-</span>collector</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">vgo-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-åº”ç”¨é“¾è·¯è¿½è¸ªé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-åº”ç”¨é“¾è·¯è¿½è¸ªé…ç½®">#</a> 2. åº”ç”¨é“¾è·¯è¿½è¸ªé…ç½®</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token comment">// internal/tracing/jaeger.go</span></span>
<span class="line"><span class="token keyword">package</span> tracing</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">"context"</span></span>
<span class="line">	<span class="token string">"io"</span></span>
<span class="line">	<span class="token string">"time"</span></span>
<span class="line"></span>
<span class="line">	<span class="token string">"github.com/opentracing/opentracing-go"</span></span>
<span class="line">	<span class="token string">"github.com/uber/jaeger-client-go"</span></span>
<span class="line">	<span class="token string">"github.com/uber/jaeger-client-go/config"</span></span>
<span class="line">	<span class="token string">"github.com/uber/jaeger-client-go/log"</span></span>
<span class="line">	<span class="token string">"github.com/uber/jaeger-client-go/metrics"</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// TracingConfig é“¾è·¯è¿½è¸ªé…ç½®</span></span>
<span class="line"><span class="token keyword">type</span> TracingConfig <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	ServiceName     <span class="token builtin">string</span>  <span class="token string">`yaml:"service_name"`</span></span>
<span class="line">	JaegerEndpoint  <span class="token builtin">string</span>  <span class="token string">`yaml:"jaeger_endpoint"`</span></span>
<span class="line">	SampleRate      <span class="token builtin">float64</span> <span class="token string">`yaml:"sample_rate"`</span></span>
<span class="line">	Enabled         <span class="token builtin">bool</span>    <span class="token string">`yaml:"enabled"`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// InitJaeger åˆå§‹åŒ–Jaegerè¿½è¸ª</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">InitJaeger</span><span class="token punctuation">(</span>cfg TracingConfig<span class="token punctuation">)</span> <span class="token punctuation">(</span>opentracing<span class="token punctuation">.</span>Tracer<span class="token punctuation">,</span> io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">!</span>cfg<span class="token punctuation">.</span>Enabled <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> opentracing<span class="token punctuation">.</span>NoopTracer<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>noopCloser<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// Jaegeré…ç½®</span></span>
<span class="line">	jcfg <span class="token operator">:=</span> config<span class="token punctuation">.</span>Configuration<span class="token punctuation">{</span></span>
<span class="line">		ServiceName<span class="token punctuation">:</span> cfg<span class="token punctuation">.</span>ServiceName<span class="token punctuation">,</span></span>
<span class="line">		Sampler<span class="token punctuation">:</span> <span class="token operator">&amp;</span>config<span class="token punctuation">.</span>SamplerConfig<span class="token punctuation">{</span></span>
<span class="line">			Type<span class="token punctuation">:</span>  jaeger<span class="token punctuation">.</span>SamplerTypeConst<span class="token punctuation">,</span></span>
<span class="line">			Param<span class="token punctuation">:</span> cfg<span class="token punctuation">.</span>SampleRate<span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		Reporter<span class="token punctuation">:</span> <span class="token operator">&amp;</span>config<span class="token punctuation">.</span>ReporterConfig<span class="token punctuation">{</span></span>
<span class="line">			LogSpans<span class="token punctuation">:</span>            <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">			BufferFlushInterval<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span></span>
<span class="line">			CollectorEndpoint<span class="token punctuation">:</span>   cfg<span class="token punctuation">.</span>JaegerEndpoint<span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// åˆ›å»ºè¿½è¸ªå™¨</span></span>
<span class="line">	tracer<span class="token punctuation">,</span> closer<span class="token punctuation">,</span> err <span class="token operator">:=</span> jcfg<span class="token punctuation">.</span><span class="token function">NewTracer</span><span class="token punctuation">(</span></span>
<span class="line">		config<span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span>log<span class="token punctuation">.</span>StdLogger<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">		config<span class="token punctuation">.</span><span class="token function">Metrics</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>NullFactory<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// è®¾ç½®å…¨å±€è¿½è¸ªå™¨</span></span>
<span class="line">	opentracing<span class="token punctuation">.</span><span class="token function">SetGlobalTracer</span><span class="token punctuation">(</span>tracer<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">return</span> tracer<span class="token punctuation">,</span> closer<span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// StartSpan å¼€å§‹ä¸€ä¸ªæ–°çš„span</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">StartSpan</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> operationName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>opentracing<span class="token punctuation">.</span>Span<span class="token punctuation">,</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	span<span class="token punctuation">,</span> ctx <span class="token operator">:=</span> opentracing<span class="token punctuation">.</span><span class="token function">StartSpanFromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> operationName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> span<span class="token punctuation">,</span> ctx</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// FinishSpan ç»“æŸspan</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">FinishSpan</span><span class="token punctuation">(</span>span opentracing<span class="token punctuation">.</span>Span<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		span<span class="token punctuation">.</span><span class="token function">SetTag</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">		span<span class="token punctuation">.</span><span class="token function">LogKV</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	span<span class="token punctuation">.</span><span class="token function">Finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> noopCloser <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>noopCloser<span class="token punctuation">)</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“‹-æ—¥å¿—èšåˆé…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ“‹-æ—¥å¿—èšåˆé…ç½®">#</a> ğŸ“‹ æ—¥å¿—èšåˆé…ç½®</h2>
<h3 id="_1-elk-stackéƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_1-elk-stackéƒ¨ç½²">#</a> 1. ELK Stackéƒ¨ç½²</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.elk.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>8.8.0</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>elasticsearch</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> discovery.type=single<span class="token punctuation">-</span>node</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span>
<span class="line">      <span class="token punctuation">-</span> xpack.security.enabled=false</span>
<span class="line">      <span class="token punctuation">-</span> xpack.security.enrollment.enabled=false</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9200:9200"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9300:9300"</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch_data<span class="token punctuation">:</span>/usr/share/elasticsearch/data</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">kibana</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/kibana/kibana<span class="token punctuation">:</span>8.8.0</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>kibana</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"5601:5601"</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ELASTICSEARCH_HOSTS=http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.kibana.rule=Host(`kibana.vgo.local`)"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.kibana.loadbalancer.server.port=5601"</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">fluent-bit</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> fluent/fluent<span class="token punctuation">-</span>bit<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>fluent<span class="token punctuation">-</span>bit</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./monitoring/fluent<span class="token punctuation">-</span>bit/fluent<span class="token punctuation">-</span>bit.conf<span class="token punctuation">:</span>/fluent<span class="token punctuation">-</span>bit/etc/fluent<span class="token punctuation">-</span>bit.conf</span>
<span class="line">      <span class="token punctuation">-</span> ./monitoring/fluent<span class="token punctuation">-</span>bit/parsers.conf<span class="token punctuation">:</span>/fluent<span class="token punctuation">-</span>bit/etc/parsers.conf</span>
<span class="line">      <span class="token punctuation">-</span> /var/lib/docker/containers<span class="token punctuation">:</span>/var/lib/docker/containers<span class="token punctuation">:</span>ro</span>
<span class="line">      <span class="token punctuation">-</span> /var/log<span class="token punctuation">:</span>/var/log<span class="token punctuation">:</span>ro</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">elasticsearch_data</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">vgo-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-fluent-bité…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-fluent-bité…ç½®">#</a> 2. Fluent Bité…ç½®</h3>
<div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini"><pre v-pre><code class="language-ini"><span class="line"><span class="token comment"># monitoring/fluent-bit/fluent-bit.conf</span></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">SERVICE</span><span class="token punctuation">]</span></span></span>
<span class="line">    Flush         1</span>
<span class="line">    Log_Level     info</span>
<span class="line">    Daemon        off</span>
<span class="line">    Parsers_File  parsers.conf</span>
<span class="line">    HTTP_Server   On</span>
<span class="line">    HTTP_Listen   0.0.0.0</span>
<span class="line">    HTTP_Port     2020</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">INPUT</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name              tail</span>
<span class="line">    Path              /var/lib/docker/containers/*/*.log</span>
<span class="line">    Parser            docker</span>
<span class="line">    Tag               docker.*</span>
<span class="line">    Refresh_Interval  5</span>
<span class="line">    Mem_Buf_Limit     50MB</span>
<span class="line">    Skip_Long_Lines   On</span>
<span class="line">    Skip_Empty_Lines  On</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">INPUT</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name              systemd</span>
<span class="line">    Tag               systemd.*</span>
<span class="line">    <span class="token key attr-name">Systemd_Filter    _SYSTEMD_UNIT</span><span class="token punctuation">=</span><span class="token value attr-value">docker.service</span></span>
<span class="line">    Read_From_Tail    On</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">FILTER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name                kubernetes</span>
<span class="line">    Match               docker.*</span>
<span class="line">    Kube_URL            https://kubernetes.default.svc:443</span>
<span class="line">    Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
<span class="line">    Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token</span>
<span class="line">    Kube_Tag_Prefix     docker.var.lib.docker.containers.</span>
<span class="line">    Merge_Log           On</span>
<span class="line">    Merge_Log_Key       log_processed</span>
<span class="line">    K8S-Logging.Parser  On</span>
<span class="line">    K8S-Logging.Exclude Off</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">FILTER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name                parser</span>
<span class="line">    Match               docker.*vgo*</span>
<span class="line">    Key_Name            log</span>
<span class="line">    Parser              vgo_json</span>
<span class="line">    Reserve_Data        On</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">FILTER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name                nest</span>
<span class="line">    Match               docker.*vgo*</span>
<span class="line">    Operation           lift</span>
<span class="line">    Nested_under        kubernetes</span>
<span class="line">    Add_prefix          k8s_</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">FILTER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name                modify</span>
<span class="line">    Match               docker.*vgo*</span>
<span class="line">    Add                 service vgo-iam</span>
<span class="line">    Add                 environment production</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">OUTPUT</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name            es</span>
<span class="line">    Match           docker.*vgo*</span>
<span class="line">    Host            elasticsearch</span>
<span class="line">    Port            9200</span>
<span class="line">    Index           vgo-logs</span>
<span class="line">    Type            _doc</span>
<span class="line">    Logstash_Format On</span>
<span class="line">    Logstash_Prefix vgo</span>
<span class="line">    Logstash_DateFormat %Y.%m.%d</span>
<span class="line">    Include_Tag_Key On</span>
<span class="line">    Tag_Key         @tag</span>
<span class="line">    Retry_Limit     5</span>
<span class="line">    Suppress_Type_Name On</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">OUTPUT</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name            es</span>
<span class="line">    Match           systemd.*</span>
<span class="line">    Host            elasticsearch</span>
<span class="line">    Port            9200</span>
<span class="line">    Index           system-logs</span>
<span class="line">    Type            _doc</span>
<span class="line">    Logstash_Format On</span>
<span class="line">    Logstash_Prefix system</span>
<span class="line">    Logstash_DateFormat %Y.%m.%d</span>
<span class="line">    Include_Tag_Key On</span>
<span class="line">    Tag_Key         @tag</span>
<span class="line">    Retry_Limit     5</span>
<span class="line">    Suppress_Type_Name On</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini"><pre v-pre><code class="language-ini"><span class="line"><span class="token comment"># monitoring/fluent-bit/parsers.conf</span></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">PARSER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name        docker</span>
<span class="line">    Format      json</span>
<span class="line">    Time_Key    time</span>
<span class="line">    Time_Format %Y-%m-%dT%H:%M:%S.%L</span>
<span class="line">    Time_Keep   On</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">PARSER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name        vgo_json</span>
<span class="line">    Format      json</span>
<span class="line">    Time_Key    timestamp</span>
<span class="line">    Time_Format %Y-%m-%dT%H:%M:%S.%L%z</span>
<span class="line">    Time_Keep   On</span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">PARSER</span><span class="token punctuation">]</span></span></span>
<span class="line">    Name        nginx</span>
<span class="line">    Format      regex</span>
<span class="line">    Regex       ^(?&lt;remote>[^ ]*) (?&lt;host>[^ ]*) (?&lt;user>[^ ]*) \[(?&lt;time>[^\]]*)\] "(?&lt;method>\S+)(?: +(?&lt;path>[^\"]*?)(?: +\S*)?)?" (?&lt;code>[^ ]*) (?&lt;size>[^ ]*)(?: "(?&lt;referer>[^\"]*)" "(?&lt;agent>[^\"]*)")</span>
<span class="line">    Time_Key    time</span>
<span class="line">    Time_Format %d/%b/%Y:%H:%M:%S %z</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš¨-alertmanageré…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸš¨-alertmanageré…ç½®">#</a> ğŸš¨ AlertManageré…ç½®</h2>
<h3 id="_1-alertmanageréƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_1-alertmanageréƒ¨ç½²">#</a> 1. AlertManageréƒ¨ç½²</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.alertmanager.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">alertmanager</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/alertmanager<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>alertmanager</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"9093:9093"</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./monitoring/alertmanager<span class="token punctuation">:</span>/etc/alertmanager</span>
<span class="line">      <span class="token punctuation">-</span> alertmanager_data<span class="token punctuation">:</span>/alertmanager</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--config.file=/etc/alertmanager/alertmanager.yml'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--storage.path=/alertmanager'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--web.external-url=http://localhost:9093'</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">'--cluster.listen-address=0.0.0.0:9094'</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> vgo<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.alertmanager.rule=Host(`alertmanager.vgo.local`)"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.alertmanager.loadbalancer.server.port=9093"</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">alertmanager_data</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">vgo-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-alertmanageré…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-alertmanageré…ç½®æ–‡ä»¶">#</a> 2. AlertManageré…ç½®æ–‡ä»¶</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># monitoring/alertmanager/alertmanager.yml</span></span>
<span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">smtp_smarthost</span><span class="token punctuation">:</span> <span class="token string">'smtp.gmail.com:587'</span></span>
<span class="line">  <span class="token key atrule">smtp_from</span><span class="token punctuation">:</span> <span class="token string">'alerts@vgo.example.com'</span></span>
<span class="line">  <span class="token key atrule">smtp_auth_username</span><span class="token punctuation">:</span> <span class="token string">'alerts@vgo.example.com'</span></span>
<span class="line">  <span class="token key atrule">smtp_auth_password</span><span class="token punctuation">:</span> <span class="token string">'your_app_password'</span></span>
<span class="line">  <span class="token key atrule">slack_api_url</span><span class="token punctuation">:</span> <span class="token string">'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">route</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'alertname'</span><span class="token punctuation">,</span> <span class="token string">'cluster'</span><span class="token punctuation">,</span> <span class="token string">'service'</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 10s</span>
<span class="line">  <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 10s</span>
<span class="line">  <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 1h</span>
<span class="line">  <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">'web.hook'</span></span>
<span class="line">  <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">'critical-alerts'</span></span>
<span class="line">      <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 5s</span>
<span class="line">      <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 30m</span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">'warning-alerts'</span></span>
<span class="line">      <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 30s</span>
<span class="line">      <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 2h</span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">service</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">'vgo-team'</span></span>
<span class="line">      <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 10s</span>
<span class="line">      <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 1h</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">receivers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'web.hook'</span></span>
<span class="line">    <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">'http://webhook-service:8080/alerts'</span></span>
<span class="line">        <span class="token key atrule">send_resolved</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">http_config</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">basic_auth</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">'webhook_user'</span></span>
<span class="line">            <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">'webhook_password'</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'critical-alerts'</span></span>
<span class="line">    <span class="token key atrule">email_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">'oncall@vgo.example.com'</span></span>
<span class="line">        <span class="token key atrule">subject</span><span class="token punctuation">:</span> <span class="token string">'ğŸš¨ [CRITICAL] VGO Alert: {{ .GroupLabels.alertname }}'</span></span>
<span class="line">        <span class="token key atrule">body</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          {{ range .Alerts }}</span>
<span class="line">          Alert: {{ .Annotations.summary }}</span>
<span class="line">          Description: {{ .Annotations.description }}</span>
<span class="line">          Service: {{ .Labels.service }}</span>
<span class="line">          Severity: {{ .Labels.severity }}</span>
<span class="line">          Time: {{ .StartsAt.Format "2006-01-02 15:04:05" }}</span>
<span class="line">          {{ end }}</span></span>
<span class="line">    <span class="token key atrule">slack_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">channel</span><span class="token punctuation">:</span> <span class="token string">'#critical-alerts'</span></span>
<span class="line">        <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">'ğŸš¨ Critical Alert'</span></span>
<span class="line">        <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          {{ range .Alerts }}</span>
<span class="line">          *Alert:* {{ .Annotations.summary }}</span>
<span class="line">          *Description:* {{ .Annotations.description }}</span>
<span class="line">          *Service:* {{ .Labels.service }}</span>
<span class="line">          *Severity:* {{ .Labels.severity }}</span>
<span class="line">          {{ end }}</span></span>
<span class="line">        <span class="token key atrule">send_resolved</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'warning-alerts'</span></span>
<span class="line">    <span class="token key atrule">email_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">'team@vgo.example.com'</span></span>
<span class="line">        <span class="token key atrule">subject</span><span class="token punctuation">:</span> <span class="token string">'âš ï¸ [WARNING] VGO Alert: {{ .GroupLabels.alertname }}'</span></span>
<span class="line">        <span class="token key atrule">body</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          {{ range .Alerts }}</span>
<span class="line">          Alert: {{ .Annotations.summary }}</span>
<span class="line">          Description: {{ .Annotations.description }}</span>
<span class="line">          Service: {{ .Labels.service }}</span>
<span class="line">          Severity: {{ .Labels.severity }}</span>
<span class="line">          Time: {{ .StartsAt.Format "2006-01-02 15:04:05" }}</span>
<span class="line">          {{ end }}</span></span>
<span class="line">    <span class="token key atrule">slack_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">channel</span><span class="token punctuation">:</span> <span class="token string">'#alerts'</span></span>
<span class="line">        <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">'âš ï¸ Warning Alert'</span></span>
<span class="line">        <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          {{ range .Alerts }}</span>
<span class="line">          *Alert:* {{ .Annotations.summary }}</span>
<span class="line">          *Description:* {{ .Annotations.description }}</span>
<span class="line">          *Service:* {{ .Labels.service }}</span>
<span class="line">          *Severity:* {{ .Labels.severity }}</span>
<span class="line">          {{ end }}</span></span>
<span class="line">        <span class="token key atrule">send_resolved</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'vgo-team'</span></span>
<span class="line">    <span class="token key atrule">email_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">'vgo-team@vgo.example.com'</span></span>
<span class="line">        <span class="token key atrule">subject</span><span class="token punctuation">:</span> <span class="token string">'[VGO] Service Alert: {{ .GroupLabels.alertname }}'</span></span>
<span class="line">        <span class="token key atrule">body</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          VGOæœåŠ¡å‘Šè­¦é€šçŸ¥ï¼š</span></span>
<span class="line">          </span>
<span class="line">          <span class="token punctuation">{</span><span class="token punctuation">{</span> range .Alerts <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">å‘Šè­¦åç§°</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Annotations.summary <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">è¯¦ç»†æè¿°</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Annotations.description <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">æœåŠ¡åç§°</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Labels.service <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">å‘Šè­¦çº§åˆ«</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Labels.severity <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">å¼€å§‹æ—¶é—´</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .StartsAt.Format "2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05" <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token punctuation">{</span> if .EndsAt <span class="token punctuation">}</span><span class="token punctuation">}</span>ç»“æŸæ—¶é—´<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .EndsAt.Format "2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05" <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">slack_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">channel</span><span class="token punctuation">:</span> <span class="token string">'#vgo-alerts'</span></span>
<span class="line">        <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">'VGO Service Alert'</span></span>
<span class="line">        <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          {{ range .Alerts }}</span>
<span class="line">          *æœåŠ¡:* {{ .Labels.service }}</span>
<span class="line">          *å‘Šè­¦:* {{ .Annotations.summary }}</span>
<span class="line">          *æè¿°:* {{ .Annotations.description }}</span>
<span class="line">          *çº§åˆ«:* {{ .Labels.severity }}</span>
<span class="line">          {{ end }}</span></span>
<span class="line">        <span class="token key atrule">send_resolved</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">inhibit_rules</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">source_match</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">'critical'</span></span>
<span class="line">    <span class="token key atrule">target_match</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">'warning'</span></span>
<span class="line">    <span class="token key atrule">equal</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'alertname'</span><span class="token punctuation">,</span> <span class="token string">'cluster'</span><span class="token punctuation">,</span> <span class="token string">'service'</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-ç›‘æ§éƒ¨ç½²è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-ç›‘æ§éƒ¨ç½²è„šæœ¬">#</a> ğŸ”§ ç›‘æ§éƒ¨ç½²è„šæœ¬</h2>
<h3 id="å®Œæ•´éƒ¨ç½²è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#å®Œæ•´éƒ¨ç½²è„šæœ¬">#</a> å®Œæ•´éƒ¨ç½²è„šæœ¬</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># scripts/deploy-monitoring.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸš€ å¼€å§‹éƒ¨ç½²VGOç›‘æ§ç³»ç»Ÿ..."</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºç›‘æ§ç›®å½•</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> monitoring/<span class="token punctuation">{</span>prometheus,grafana,alertmanager,fluent-bit,jaeger<span class="token punctuation">}</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> monitoring/grafana/<span class="token punctuation">{</span>provisioning/<span class="token punctuation">{</span>datasources,dashboards<span class="token punctuation">}</span>,dashboards<span class="token punctuation">}</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> monitoring/prometheus/rules</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥Dockerå’ŒDocker Compose</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token function">docker</span> <span class="token operator">&amp;></span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"</span></span>
<span class="line">    <span class="token builtin class-name">exit</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token function">docker-compose</span> <span class="token operator">&amp;></span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ Docker Composeæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker Compose"</span></span>
<span class="line">    <span class="token builtin class-name">exit</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºç½‘ç»œ</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“¡ åˆ›å»ºDockerç½‘ç»œ..."</span></span>
<span class="line"><span class="token function">docker</span> network create vgo-network <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"ç½‘ç»œå·²å­˜åœ¨"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># éƒ¨ç½²Elasticsearchå’ŒKibana</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“Š éƒ¨ç½²ELK Stack..."</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.elk.yml up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç­‰å¾…Elasticsearchå¯åŠ¨</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"â³ ç­‰å¾…Elasticsearchå¯åŠ¨..."</span></span>
<span class="line"><span class="token keyword">until</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:9200/_cluster/health <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'"status":"green"\|"status":"yellow"'</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"ç­‰å¾…Elasticsearch..."</span></span>
<span class="line">    <span class="token function">sleep</span> <span class="token number">5</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"âœ… Elasticsearchå·²å¯åŠ¨"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># éƒ¨ç½²Jaeger</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ” éƒ¨ç½²Jaeger..."</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.jaeger.yml up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># éƒ¨ç½²Prometheuså’Œç›¸å…³ç»„ä»¶</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“ˆ éƒ¨ç½²Prometheus..."</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.monitoring.yml up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># éƒ¨ç½²Grafana</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“Š éƒ¨ç½²Grafana..."</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.grafana.yml up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># éƒ¨ç½²AlertManager</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸš¨ éƒ¨ç½²AlertManager..."</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.alertmanager.yml up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç­‰å¾…æ‰€æœ‰æœåŠ¡å¯åŠ¨</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"â³ ç­‰å¾…æ‰€æœ‰æœåŠ¡å¯åŠ¨..."</span></span>
<span class="line"><span class="token function">sleep</span> <span class="token number">30</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€..."</span></span>
<span class="line"><span class="token assign-left variable">services</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"prometheus:9090"</span> <span class="token string">"grafana:3000"</span> <span class="token string">"alertmanager:9093"</span> <span class="token string">"kibana:5601"</span> <span class="token string">"jaeger-query:16686"</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">service</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${services<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $service <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f1</span><span class="token variable">)</span></span></span>
<span class="line">    <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $service <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f2</span><span class="token variable">)</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-f</span> http://localhost:<span class="token variable">$port</span> <span class="token operator">></span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"âœ… <span class="token variable">$name</span> è¿è¡Œæ­£å¸¸ (ç«¯å£ <span class="token variable">$port</span>)"</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"âŒ <span class="token variable">$name</span> å¯åŠ¨å¤±è´¥ (ç«¯å£ <span class="token variable">$port</span>)"</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯¼å…¥Grafanaä»ªè¡¨æ¿</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“Š å¯¼å…¥Grafanaä»ªè¡¨æ¿..."</span></span>
<span class="line"><span class="token function">sleep</span> <span class="token number">10</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºæ•°æ®æº</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token punctuation">\</span></span>
<span class="line">  http://admin:admin123@localhost:3000/api/datasources <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">    "name": "Prometheus",</span>
<span class="line">    "type": "prometheus",</span>
<span class="line">    "url": "http://prometheus:9090",</span>
<span class="line">    "access": "proxy",</span>
<span class="line">    "isDefault": true</span>
<span class="line">  }'</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"æ•°æ®æºå¯èƒ½å·²å­˜åœ¨"</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">""</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ‰ ç›‘æ§ç³»ç»Ÿéƒ¨ç½²å®Œæˆï¼"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">""</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“Š è®¿é—®åœ°å€ï¼š"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  - Grafana:      http://localhost:3000 (admin/admin123)"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  - Prometheus:   http://localhost:9090"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  - AlertManager: http://localhost:9093"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  - Kibana:       http://localhost:5601"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  - Jaeger:       http://localhost:16686"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">""</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“ ä¸‹ä¸€æ­¥ï¼š"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  1. é…ç½®Grafanaä»ªè¡¨æ¿"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  2. è®¾ç½®å‘Šè­¦é€šçŸ¥"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  3. é…ç½®æ—¥å¿—ç´¢å¼•æ¨¡å¼"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  4. éªŒè¯é“¾è·¯è¿½è¸ª"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">""</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç›‘æ§éªŒè¯è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#ç›‘æ§éªŒè¯è„šæœ¬">#</a> ç›‘æ§éªŒè¯è„šæœ¬</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># scripts/verify-monitoring.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ” éªŒè¯VGOç›‘æ§ç³»ç»Ÿ..."</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥PrometheusæŒ‡æ ‡</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“ˆ æ£€æŸ¥PrometheusæŒ‡æ ‡..."</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:9090/api/v1/query?query<span class="token operator">=</span>up <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'"status":"success"'</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âœ… Prometheus APIæ­£å¸¸"</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ Prometheus APIå¼‚å¸¸"</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥VGOæœåŠ¡æŒ‡æ ‡</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ¯ æ£€æŸ¥VGOæœåŠ¡æŒ‡æ ‡..."</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:9090/api/v1/query?query<span class="token operator">=</span>grpc_server_handled_total <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'grpc_server_handled_total'</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âœ… VGOæœåŠ¡æŒ‡æ ‡æ­£å¸¸"</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âš ï¸ VGOæœåŠ¡æŒ‡æ ‡æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ"</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥å‘Šè­¦è§„åˆ™</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸš¨ æ£€æŸ¥å‘Šè­¦è§„åˆ™..."</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:9090/api/v1/rules <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'VGOServiceDown'</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âœ… å‘Šè­¦è§„åˆ™å·²åŠ è½½"</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ å‘Šè­¦è§„åˆ™æœªåŠ è½½"</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥Grafana</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ“Š æ£€æŸ¥Grafana..."</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-u</span> admin:admin123 http://localhost:3000/api/health <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'"database":"ok"'</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âœ… Grafanaæ­£å¸¸"</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ Grafanaå¼‚å¸¸"</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥Elasticsearch</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ” æ£€æŸ¥Elasticsearch..."</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:9200/_cluster/health <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'"status":"green"\|"status":"yellow"'</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âœ… Elasticsearchæ­£å¸¸"</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ Elasticsearchå¼‚å¸¸"</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥Jaeger</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ğŸ”— æ£€æŸ¥Jaeger..."</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:16686/api/services <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'"data"'</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âœ… Jaegeræ­£å¸¸"</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"âŒ Jaegerå¼‚å¸¸"</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">""</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"âœ… ç›‘æ§ç³»ç»ŸéªŒè¯å®Œæˆï¼"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-ç›¸å…³æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-ç›¸å…³æ–‡æ¡£">#</a> ğŸ“š ç›¸å…³æ–‡æ¡£</h2>
<ul>
<li><RouteLink to="/deployment/docker-compose.html">Docker Composeéƒ¨ç½²</RouteLink> - åŸºç¡€éƒ¨ç½²æ–¹æ¡ˆ</li>
<li><RouteLink to="/deployment/kubernetes.html">Kuberneteséƒ¨ç½²</RouteLink> - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</li>
<li><RouteLink to="/deployment/troubleshooting.html">æ•…éšœæ’é™¤</RouteLink> - é—®é¢˜è¯Šæ–­æŒ‡å—</li>
<li><RouteLink to="/deployment/performance.html">æ€§èƒ½è°ƒä¼˜</RouteLink> - æ€§èƒ½ä¼˜åŒ–å»ºè®®</li>
<li><RouteLink to="/deployment/security.html">å®‰å…¨é…ç½®</RouteLink> - å®‰å…¨æœ€ä½³å®è·µ</li>
</ul>
<hr>
<div class="hint-container tip">
<p class="hint-container-title">æç¤º</p>
<p>ç›‘æ§ç³»ç»Ÿéœ€è¦ä¸€å®šçš„èµ„æºï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºç›‘æ§ç»„ä»¶åˆ†é…è¶³å¤Ÿçš„CPUå’Œå†…å­˜ã€‚</p>
</div>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>è¯·æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´å‘Šè­¦é˜ˆå€¼å’Œé€šçŸ¥é…ç½®ï¼Œé¿å…å‘Šè­¦é£æš´ã€‚</p>
</div>
</div></template>


