<template><div><h1 id="éƒ¨ç½²æŒ‡å—" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²æŒ‡å—">#</a> éƒ¨ç½²æŒ‡å—</h1>
<p>æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ä¸åŒç¯å¢ƒä¸­éƒ¨ç½²VGOå¾®æœåŠ¡ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚VGOå¾®æœåŠ¡æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œæ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„éƒ¨ç½²æ–¹æ¡ˆã€‚</p>
<h2 id="ğŸ“‹-éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“‹-éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ">#</a> ğŸ“‹ éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ</h2>
<table>
<thead>
<tr>
<th>éƒ¨ç½²æ–¹å¼</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>å¤æ‚åº¦</th>
<th>æ¨èæŒ‡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td><RouteLink to="/deployment/docker-compose.html">Docker Compose</RouteLink></td>
<td>å¼€å‘ã€æµ‹è¯•ç¯å¢ƒ</td>
<td>â­</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><RouteLink to="/deployment/kubernetes.html">Kubernetes</RouteLink></td>
<td>ç”Ÿäº§ç¯å¢ƒ</td>
<td>â­â­â­â­</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><RouteLink to="/deployment/binary.html">äºŒè¿›åˆ¶éƒ¨ç½²</RouteLink></td>
<td>ç®€å•ç”Ÿäº§ç¯å¢ƒ</td>
<td>â­â­</td>
<td>â­â­â­</td>
</tr>
<tr>
<td><RouteLink to="/deployment/source.html">æºç ç¼–è¯‘</RouteLink></td>
<td>å¼€å‘ç¯å¢ƒ</td>
<td>â­â­â­</td>
<td>â­â­</td>
</tr>
<tr>
<td><RouteLink to="/deployment/cloud.html">äº‘æœåŠ¡éƒ¨ç½²</RouteLink></td>
<td>äº‘åŸç”Ÿç¯å¢ƒ</td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ—ï¸-ç³»ç»Ÿæ¶æ„" tabindex="-1"><a class="header-anchor" href="#ğŸ—ï¸-ç³»ç»Ÿæ¶æ„">#</a> ğŸ—ï¸ ç³»ç»Ÿæ¶æ„</h2>
<h3 id="æ ¸å¿ƒç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç»„ä»¶">#</a> æ ¸å¿ƒç»„ä»¶</h3>
<div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid"><pre v-pre><code class="language-mermaid"><span class="line"><span class="token keyword">graph</span> TB</span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"å®¢æˆ·ç«¯å±‚"</span></span>
<span class="line">        A<span class="token text string">[Webç•Œé¢]</span></span>
<span class="line">        B<span class="token text string">[gRPCå®¢æˆ·ç«¯]</span></span>
<span class="line">        C<span class="token text string">[REST APIå®¢æˆ·ç«¯]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"ç½‘å…³å±‚"</span></span>
<span class="line">        D<span class="token text string">[è´Ÿè½½å‡è¡¡å™¨]</span></span>
<span class="line">        E<span class="token text string">[APIç½‘å…³]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"æœåŠ¡å±‚"</span></span>
<span class="line">        F<span class="token text string">[IAMæœåŠ¡]</span></span>
<span class="line">        G<span class="token text string">[ç”¨æˆ·ç®¡ç†æœåŠ¡]</span></span>
<span class="line">        H<span class="token text string">[ç­–ç•¥ç®¡ç†æœåŠ¡]</span></span>
<span class="line">        I<span class="token text string">[æƒé™éªŒè¯æœåŠ¡]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"æ•°æ®å±‚"</span></span>
<span class="line">        J<span class="token text string">[PostgreSQL]</span></span>
<span class="line">        K<span class="token text string">[Redis]</span></span>
<span class="line">        L<span class="token text string">[æ–‡ä»¶å­˜å‚¨]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">subgraph</span> <span class="token string">"ç›‘æ§å±‚"</span></span>
<span class="line">        M<span class="token text string">[Prometheus]</span></span>
<span class="line">        N<span class="token text string">[Grafana]</span></span>
<span class="line">        O<span class="token text string">[Jaeger]</span></span>
<span class="line">        P<span class="token text string">[ELK Stack]</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">    </span>
<span class="line">    A <span class="token arrow operator">--></span> D</span>
<span class="line">    B <span class="token arrow operator">--></span> D</span>
<span class="line">    C <span class="token arrow operator">--></span> D</span>
<span class="line">    D <span class="token arrow operator">--></span> E</span>
<span class="line">    E <span class="token arrow operator">--></span> F</span>
<span class="line">    E <span class="token arrow operator">--></span> G</span>
<span class="line">    E <span class="token arrow operator">--></span> H</span>
<span class="line">    E <span class="token arrow operator">--></span> I</span>
<span class="line">    F <span class="token arrow operator">--></span> J</span>
<span class="line">    F <span class="token arrow operator">--></span> K</span>
<span class="line">    G <span class="token arrow operator">--></span> J</span>
<span class="line">    H <span class="token arrow operator">--></span> J</span>
<span class="line">    I <span class="token arrow operator">--></span> K</span>
<span class="line">    F <span class="token arrow operator">--></span> L</span>
<span class="line">    </span>
<span class="line">    F <span class="token arrow operator">--></span> M</span>
<span class="line">    G <span class="token arrow operator">--></span> M</span>
<span class="line">    H <span class="token arrow operator">--></span> M</span>
<span class="line">    I <span class="token arrow operator">--></span> M</span>
<span class="line">    M <span class="token arrow operator">--></span> N</span>
<span class="line">    F <span class="token arrow operator">--></span> O</span>
<span class="line">    G <span class="token arrow operator">--></span> O</span>
<span class="line">    H <span class="token arrow operator">--></span> O</span>
<span class="line">    I <span class="token arrow operator">--></span> O</span>
<span class="line">    F <span class="token arrow operator">--></span> P</span>
<span class="line">    G <span class="token arrow operator">--></span> P</span>
<span class="line">    H <span class="token arrow operator">--></span> P</span>
<span class="line">    I <span class="token arrow operator">--></span> P</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æœåŠ¡ç«¯å£åˆ†é…" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡ç«¯å£åˆ†é…">#</a> æœåŠ¡ç«¯å£åˆ†é…</h3>
<table>
<thead>
<tr>
<th>æœåŠ¡</th>
<th>ç«¯å£</th>
<th>åè®®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>IAM gRPC</td>
<td>50051</td>
<td>gRPC</td>
<td>ä¸»è¦APIæœåŠ¡</td>
</tr>
<tr>
<td>IAM HTTP</td>
<td>8080</td>
<td>HTTP</td>
<td>REST APIå’ŒWebç•Œé¢</td>
</tr>
<tr>
<td>å¥åº·æ£€æŸ¥</td>
<td>8081</td>
<td>HTTP</td>
<td>å¥åº·æ£€æŸ¥ç«¯ç‚¹</td>
</tr>
<tr>
<td>æŒ‡æ ‡æ”¶é›†</td>
<td>8082</td>
<td>HTTP</td>
<td>PrometheusæŒ‡æ ‡</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>5432</td>
<td>TCP</td>
<td>æ•°æ®åº“æœåŠ¡</td>
</tr>
<tr>
<td>Redis</td>
<td>6379</td>
<td>TCP</td>
<td>ç¼“å­˜æœåŠ¡</td>
</tr>
<tr>
<td>Prometheus</td>
<td>9090</td>
<td>HTTP</td>
<td>ç›‘æ§æœåŠ¡</td>
</tr>
<tr>
<td>Grafana</td>
<td>3000</td>
<td>HTTP</td>
<td>å¯è§†åŒ–ç•Œé¢</td>
</tr>
<tr>
<td>Jaeger</td>
<td>16686</td>
<td>HTTP</td>
<td>é“¾è·¯è¿½è¸ªç•Œé¢</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ”§-ç¯å¢ƒè¦æ±‚" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-ç¯å¢ƒè¦æ±‚">#</a> ğŸ”§ ç¯å¢ƒè¦æ±‚</h2>
<h3 id="æœ€å°ç³»ç»Ÿè¦æ±‚" tabindex="-1"><a class="header-anchor" href="#æœ€å°ç³»ç»Ÿè¦æ±‚">#</a> æœ€å°ç³»ç»Ÿè¦æ±‚</h3>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>æœ€å°é…ç½®</th>
<th>æ¨èé…ç½®</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU</td>
<td>2æ ¸</td>
<td>4æ ¸+</td>
</tr>
<tr>
<td>å†…å­˜</td>
<td>4GB</td>
<td>8GB+</td>
</tr>
<tr>
<td>å­˜å‚¨</td>
<td>20GB</td>
<td>100GB+</td>
</tr>
<tr>
<td>ç½‘ç»œ</td>
<td>100Mbps</td>
<td>1Gbps+</td>
</tr>
</tbody>
</table>
<h3 id="è½¯ä»¶ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#è½¯ä»¶ä¾èµ–">#</a> è½¯ä»¶ä¾èµ–</h3>
<h4 id="å¿…éœ€ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#å¿…éœ€ç»„ä»¶">#</a> å¿…éœ€ç»„ä»¶</h4>
<ul>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>: Linux (Ubuntu 20.04+, CentOS 8+, RHEL 8+)</li>
<li><strong>å®¹å™¨è¿è¡Œæ—¶</strong>: Docker 20.10+ æˆ– Podman 3.0+</li>
<li><strong>æ•°æ®åº“</strong>: PostgreSQL 13+</li>
<li><strong>ç¼“å­˜</strong>: Redis 6.0+</li>
</ul>
<h4 id="å¯é€‰ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#å¯é€‰ç»„ä»¶">#</a> å¯é€‰ç»„ä»¶</h4>
<ul>
<li><strong>å®¹å™¨ç¼–æ’</strong>: Kubernetes 1.20+ æˆ– Docker Swarm</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>: Nginx, HAProxy, æˆ–äº‘è´Ÿè½½å‡è¡¡å™¨</li>
<li><strong>ç›‘æ§</strong>: Prometheus + Grafana</li>
<li><strong>æ—¥å¿—</strong>: ELK Stack æˆ– Loki</li>
<li><strong>é“¾è·¯è¿½è¸ª</strong>: Jaeger æˆ– Zipkin</li>
</ul>
<h2 id="ğŸš€-å¿«é€Ÿå¼€å§‹" tabindex="-1"><a class="header-anchor" href="#ğŸš€-å¿«é€Ÿå¼€å§‹">#</a> ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
<h3 id="_1-ä½¿ç”¨docker-compose-æ¨è" tabindex="-1"><a class="header-anchor" href="#_1-ä½¿ç”¨docker-compose-æ¨è">#</a> 1. ä½¿ç”¨Docker Composeï¼ˆæ¨èï¼‰</h3>
<p>æœ€ç®€å•çš„éƒ¨ç½²æ–¹å¼ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># å…‹éš†é¡¹ç›®</span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/your-org/vgo-microservice.git</span>
<span class="line"><span class="token builtin class-name">cd</span> vgo-microservice</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯åŠ¨æ‰€æœ‰æœåŠ¡</span></span>
<span class="line"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token function">ps</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æŸ¥çœ‹æ—¥å¿—</span></span>
<span class="line"><span class="token function">docker-compose</span> logs <span class="token parameter variable">-f</span> iam</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-éªŒè¯éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_2-éªŒè¯éƒ¨ç½²">#</a> 2. éªŒè¯éƒ¨ç½²</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:8081/health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¿é—®Webç•Œé¢</span></span>
<span class="line"><span class="token function">open</span> http://localhost:8080</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æµ‹è¯•gRPC API</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> localhost:50051 list</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-åˆå§‹åŒ–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_3-åˆå§‹åŒ–æ•°æ®">#</a> 3. åˆå§‹åŒ–æ•°æ®</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> iam ./vgo-iam admin create-user <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--username</span> admin <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--email</span> admin@example.com <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--password</span> admin123</span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºè®¿é—®å¯†é’¥</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> iam ./vgo-iam admin create-access-key <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--username</span> admin <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--description</span> <span class="token string">"ç®¡ç†å‘˜å¯†é’¥"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-å®‰å…¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ”-å®‰å…¨é…ç½®">#</a> ğŸ” å®‰å…¨é…ç½®</h2>
<h3 id="åŸºç¡€å®‰å…¨è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€å®‰å…¨è®¾ç½®">#</a> åŸºç¡€å®‰å…¨è®¾ç½®</h3>
<ol>
<li>
<p><strong>æ›´æ”¹é»˜è®¤å¯†ç </strong></p>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ›´æ”¹æ•°æ®åº“å¯†ç </span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span><span class="token string">"your-secure-password"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ›´æ”¹Rediså¯†ç </span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">REDIS_PASSWORD</span><span class="token operator">=</span><span class="token string">"your-redis-password"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ›´æ”¹JWTå¯†é’¥</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JWT_SECRET</span><span class="token operator">=</span><span class="token string">"your-jwt-secret-key"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><strong>å¯ç”¨TLS</strong></p>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.yml</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">iam</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TLS_ENABLED=true</span>
<span class="line">      <span class="token punctuation">-</span> TLS_CERT_FILE=/certs/server.crt</span>
<span class="line">      <span class="token punctuation">-</span> TLS_KEY_FILE=/certs/server.key</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./certs<span class="token punctuation">:</span>/certs<span class="token punctuation">:</span>ro</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><strong>ç½‘ç»œéš”ç¦»</strong></p>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.yml</span></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">frontend</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line">  <span class="token key atrule">backend</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line">    <span class="token key atrule">internal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ol>
<h3 id="ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ¸…å•" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ¸…å•">#</a> ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ¸…å•</h3>
<ul>
<li>[ ] ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥</li>
<li>[ ] å¯ç”¨TLS/SSLåŠ å¯†</li>
<li>[ ] é…ç½®é˜²ç«å¢™è§„åˆ™</li>
<li>[ ] å¯ç”¨è®¿é—®æ—¥å¿—</li>
<li>[ ] é…ç½®å…¥ä¾µæ£€æµ‹</li>
<li>[ ] å®šæœŸå®‰å…¨æ›´æ–°</li>
<li>[ ] å¤‡ä»½åŠ å¯†</li>
<li>[ ] æƒé™æœ€å°åŒ–</li>
</ul>
<h2 id="ğŸ“Š-ç›‘æ§é…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-ç›‘æ§é…ç½®">#</a> ğŸ“Š ç›‘æ§é…ç½®</h2>
<h3 id="prometheusé…ç½®" tabindex="-1"><a class="header-anchor" href="#prometheusé…ç½®">#</a> Prometheusé…ç½®</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># prometheus.yml</span></span>
<span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'vgo-iam'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'iam:8082'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /metrics</span>
<span class="line">    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 10s</span>
<span class="line">    </span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'postgres'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'postgres-exporter:9187'</span><span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'redis'</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'redis-exporter:9121'</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="grafanaä»ªè¡¨æ¿" tabindex="-1"><a class="header-anchor" href="#grafanaä»ªè¡¨æ¿">#</a> Grafanaä»ªè¡¨æ¿</h3>
<p>é¢„é…ç½®çš„ä»ªè¡¨æ¿åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿæ¦‚è§ˆ</strong>: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡</li>
<li><strong>æœåŠ¡æ€§èƒ½</strong>: è¯·æ±‚é‡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡</li>
<li><strong>æ•°æ®åº“ç›‘æ§</strong>: è¿æ¥æ•°ã€æŸ¥è¯¢æ€§èƒ½ã€é”ç­‰å¾…</li>
<li><strong>ç¼“å­˜ç›‘æ§</strong>: å‘½ä¸­ç‡ã€å†…å­˜ä½¿ç”¨ã€è¿æ¥æ•°</li>
<li><strong>ä¸šåŠ¡æŒ‡æ ‡</strong>: ç”¨æˆ·æ•°é‡ã€æƒé™æ£€æŸ¥æ¬¡æ•°ã€APIè°ƒç”¨ç»Ÿè®¡</li>
</ul>
<h2 id="ğŸ”„-å¤‡ä»½å’Œæ¢å¤" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-å¤‡ä»½å’Œæ¢å¤">#</a> ğŸ”„ å¤‡ä»½å’Œæ¢å¤</h2>
<h3 id="æ•°æ®å¤‡ä»½" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å¤‡ä»½">#</a> æ•°æ®å¤‡ä»½</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ•°æ®åº“å¤‡ä»½</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> postgres pg_dump <span class="token parameter variable">-U</span> vgo_user vgo_db <span class="token operator">></span> backup_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d_%H%M%S<span class="token variable">)</span></span>.sql</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Rediså¤‡ä»½</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> redis redis-cli BGSAVE</span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> redis <span class="token function">cp</span> /data/dump.rdb /backup/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># é…ç½®æ–‡ä»¶å¤‡ä»½</span></span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-czf</span> config_backup_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d_%H%M%S<span class="token variable">)</span></span>.tar.gz configs/</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è‡ªåŠ¨å¤‡ä»½è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨å¤‡ä»½è„šæœ¬">#</a> è‡ªåŠ¨å¤‡ä»½è„šæœ¬</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># backup.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token assign-left variable">BACKUP_DIR</span><span class="token operator">=</span><span class="token string">"/backup/vgo"</span></span>
<span class="line"><span class="token assign-left variable">DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d_%H%M%S<span class="token variable">)</span></span></span>
<span class="line"><span class="token assign-left variable">RETENTION_DAYS</span><span class="token operator">=</span><span class="token number">30</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºå¤‡ä»½ç›®å½•</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$BACKUP_DIR</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ•°æ®åº“å¤‡ä»½</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-T</span> postgres pg_dump <span class="token parameter variable">-U</span> vgo_user vgo_db <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">></span> <span class="token variable">$BACKUP_DIR</span>/db_<span class="token variable">$DATE</span>.sql.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Rediså¤‡ä»½</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> redis redis-cli BGSAVE</span>
<span class="line"><span class="token function">docker-compose</span> <span class="token function">cp</span> redis:/data/dump.rdb <span class="token variable">$BACKUP_DIR</span>/redis_<span class="token variable">$DATE</span>.rdb</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ¸…ç†æ—§å¤‡ä»½</span></span>
<span class="line"><span class="token function">find</span> <span class="token variable">$BACKUP_DIR</span> <span class="token parameter variable">-name</span> <span class="token string">"*.sql.gz"</span> <span class="token parameter variable">-mtime</span> +<span class="token variable">$RETENTION_DAYS</span> <span class="token parameter variable">-delete</span></span>
<span class="line"><span class="token function">find</span> <span class="token variable">$BACKUP_DIR</span> <span class="token parameter variable">-name</span> <span class="token string">"*.rdb"</span> <span class="token parameter variable">-mtime</span> +<span class="token variable">$RETENTION_DAYS</span> <span class="token parameter variable">-delete</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"å¤‡ä»½å®Œæˆ: <span class="token variable">$DATE</span>"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•°æ®æ¢å¤" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æ¢å¤">#</a> æ•°æ®æ¢å¤</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ¢å¤æ•°æ®åº“</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-T</span> postgres psql <span class="token parameter variable">-U</span> vgo_user <span class="token parameter variable">-d</span> vgo_db <span class="token operator">&lt;</span> backup_20240115_103000.sql</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ¢å¤Redis</span></span>
<span class="line"><span class="token function">docker-compose</span> stop redis</span>
<span class="line"><span class="token function">docker-compose</span> <span class="token function">cp</span> redis_20240115_103000.rdb redis:/data/dump.rdb</span>
<span class="line"><span class="token function">docker-compose</span> start redis</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-æ•…éšœæ’é™¤" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-æ•…éšœæ’é™¤">#</a> ğŸ”§ æ•…éšœæ’é™¤</h2>
<h3 id="å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é—®é¢˜">#</a> å¸¸è§é—®é¢˜</h3>
<h4 id="_1-æœåŠ¡å¯åŠ¨å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#_1-æœåŠ¡å¯åŠ¨å¤±è´¥">#</a> 1. æœåŠ¡å¯åŠ¨å¤±è´¥</h4>
<p><strong>ç—‡çŠ¶</strong>: å®¹å™¨æ— æ³•å¯åŠ¨æˆ–ç«‹å³é€€å‡º</p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span>
<span class="line"><span class="token function">docker-compose</span> logs iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥å®¹å™¨çŠ¶æ€</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token function">ps</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥èµ„æºä½¿ç”¨</span></span>
<span class="line"><span class="token function">docker</span> stats</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥ç«¯å£å ç”¨</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tlnp</span> <span class="token operator">|</span> <span class="token function">grep</span> :50051</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¸¸è§åŸå› </strong>:</p>
<ul>
<li>ç«¯å£è¢«å ç”¨</li>
<li>é…ç½®æ–‡ä»¶é”™è¯¯</li>
<li>ä¾èµ–æœåŠ¡æœªå¯åŠ¨</li>
<li>èµ„æºä¸è¶³</li>
</ul>
<h4 id="_2-æ•°æ®åº“è¿æ¥å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®åº“è¿æ¥å¤±è´¥">#</a> 2. æ•°æ®åº“è¿æ¥å¤±è´¥</h4>
<p><strong>ç—‡çŠ¶</strong>: æœåŠ¡æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯</p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ£€æŸ¥æ•°æ®åº“çŠ¶æ€</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> postgres pg_isready <span class="token parameter variable">-U</span> vgo_user</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æµ‹è¯•è¿æ¥</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> postgres psql <span class="token parameter variable">-U</span> vgo_user <span class="token parameter variable">-d</span> vgo_db <span class="token parameter variable">-c</span> <span class="token string">"SELECT 1;"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥ç½‘ç»œè¿é€šæ€§</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> iam <span class="token function">ping</span> postgres</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>æ£€æŸ¥æ•°æ®åº“é…ç½®</li>
<li>ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®</li>
<li>æ£€æŸ¥ç½‘ç»œé…ç½®</li>
<li>æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—</li>
</ul>
<h4 id="_3-æƒé™éªŒè¯å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#_3-æƒé™éªŒè¯å¤±è´¥">#</a> 3. æƒé™éªŒè¯å¤±è´¥</h4>
<p><strong>ç—‡çŠ¶</strong>: APIè°ƒç”¨è¿”å›æƒé™ä¸è¶³é”™è¯¯</p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{"user_name":"test_user"}'</span> localhost:50051 iam.v1.IAM/GetUser</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥ç”¨æˆ·ç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{"user_name":"test_user"}'</span> localhost:50051 iam.v1.IAM/ListUserPolicies</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æµ‹è¯•æƒé™æ£€æŸ¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name":"test_user",</span>
<span class="line">  "action":"iam:GetUser",</span>
<span class="line">  "resource":"arn:iam::user/test_user"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CheckPermission</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–">#</a> æ€§èƒ½ä¼˜åŒ–</h3>
<h4 id="_1-æ•°æ®åº“ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®åº“ä¼˜åŒ–">#</a> 1. æ•°æ®åº“ä¼˜åŒ–</h4>
<div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre v-pre><code class="language-sql"><span class="line"><span class="token comment">-- åˆ›å»ºç´¢å¼•</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> CONCURRENTLY idx_users_username <span class="token keyword">ON</span> users<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> CONCURRENTLY idx_policies_name <span class="token keyword">ON</span> policies<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> CONCURRENTLY idx_user_policies_user_id <span class="token keyword">ON</span> user_policies<span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯</span></span>
<span class="line"><span class="token keyword">ANALYZE</span> users<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">ANALYZE</span> policies<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">ANALYZE</span> user_policies<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- æŸ¥çœ‹æ…¢æŸ¥è¯¢</span></span>
<span class="line"><span class="token keyword">SELECT</span> query<span class="token punctuation">,</span> mean_time<span class="token punctuation">,</span> calls </span>
<span class="line"><span class="token keyword">FROM</span> pg_stat_statements </span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> mean_time <span class="token keyword">DESC</span> </span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-redisä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-redisä¼˜åŒ–">#</a> 2. Redisä¼˜åŒ–</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># é…ç½®å†…å­˜ç­–ç•¥</span></span>
<span class="line">redis-cli CONFIG SET maxmemory-policy allkeys-lru</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯ç”¨æŒä¹…åŒ–</span></span>
<span class="line">redis-cli CONFIG SET save <span class="token string">"900 1 300 10 60 10000"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç›‘æ§æ€§èƒ½</span></span>
<span class="line">redis-cli --latency-history</span>
<span class="line">redis-cli INFO memory</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-åº”ç”¨ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-åº”ç”¨ä¼˜åŒ–">#</a> 3. åº”ç”¨ä¼˜åŒ–</h4>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.yml</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">iam</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># è¿æ¥æ± é…ç½®</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_MAX_OPEN_CONNS=25</span>
<span class="line">      <span class="token punctuation">-</span> DB_MAX_IDLE_CONNS=5</span>
<span class="line">      <span class="token punctuation">-</span> DB_CONN_MAX_LIFETIME=300s</span>
<span class="line">      </span>
<span class="line">      <span class="token comment"># ç¼“å­˜é…ç½®</span></span>
<span class="line">      <span class="token punctuation">-</span> CACHE_TTL=300s</span>
<span class="line">      <span class="token punctuation">-</span> CACHE_MAX_SIZE=1000</span>
<span class="line">      </span>
<span class="line">      <span class="token comment"># æ€§èƒ½é…ç½®</span></span>
<span class="line">      <span class="token punctuation">-</span> GOMAXPROCS=4</span>
<span class="line">      <span class="token punctuation">-</span> GOGC=100</span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># èµ„æºé™åˆ¶</span></span>
<span class="line">    <span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">resources</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">limits</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'2.0'</span></span>
<span class="line">          <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1G</span>
<span class="line">        <span class="token key atrule">reservations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'0.5'</span></span>
<span class="line">          <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512M</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“ˆ-æ‰©å±•éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#ğŸ“ˆ-æ‰©å±•éƒ¨ç½²">#</a> ğŸ“ˆ æ‰©å±•éƒ¨ç½²</h2>
<h3 id="æ°´å¹³æ‰©å±•" tabindex="-1"><a class="header-anchor" href="#æ°´å¹³æ‰©å±•">#</a> æ°´å¹³æ‰©å±•</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token comment"># docker-compose.yml</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">iam</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">    </span>
<span class="line">  <span class="token key atrule">nginx</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"80:80"</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">"443:443"</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> iam</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è´Ÿè½½å‡è¡¡é…ç½®" tabindex="-1"><a class="header-anchor" href="#è´Ÿè½½å‡è¡¡é…ç½®">#</a> è´Ÿè½½å‡è¡¡é…ç½®</h3>
<div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre v-pre><code class="language-nginx"><span class="line"><span class="token comment"># nginx.conf</span></span>
<span class="line"><span class="token directive"><span class="token keyword">upstream</span> iam_backend</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">least_conn</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> iam_1:8080 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> iam_2:8080 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> iam_3:8080 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> your-domain.com</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://iam_backend</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># å¥åº·æ£€æŸ¥</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_next_upstream</span> error timeout invalid_header http_500 http_502 http_503 http_504</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">5s</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /health</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://iam_backend/health</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-ç›¸å…³æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-ç›¸å…³æ–‡æ¡£">#</a> ğŸ“š ç›¸å…³æ–‡æ¡£</h2>
<ul>
<li><RouteLink to="/deployment/docker-compose.html">Docker Composeéƒ¨ç½²</RouteLink> - è¯¦ç»†çš„Docker Composeéƒ¨ç½²æŒ‡å—</li>
<li><RouteLink to="/deployment/kubernetes.html">Kuberneteséƒ¨ç½²</RouteLink> - ç”Ÿäº§çº§Kuberneteséƒ¨ç½²</li>
<li><RouteLink to="/deployment/binary.html">äºŒè¿›åˆ¶éƒ¨ç½²</RouteLink> - ä¼ ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²</li>
<li><RouteLink to="/deployment/cloud.html">äº‘æœåŠ¡éƒ¨ç½²</RouteLink> - äº‘åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆ</li>
<li><RouteLink to="/deployment/monitoring.html">ç›‘æ§é…ç½®</RouteLink> - å®Œæ•´çš„ç›‘æ§è§£å†³æ–¹æ¡ˆ</li>
<li><RouteLink to="/deployment/security.html">å®‰å…¨é…ç½®</RouteLink> - ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®</li>
<li><RouteLink to="/deployment/troubleshooting.html">æ•…éšœæ’é™¤</RouteLink> - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</li>
</ul>
<hr>
<div class="hint-container tip">
<p class="hint-container-title">æç¤º</p>
<p>å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯éƒ¨ç½²æ–¹æ¡ˆï¼Œç¡®è®¤æ— è¯¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
</div>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·åŠ¡å¿…é˜…è¯»å®‰å…¨é…ç½®ç« èŠ‚ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚</p>
</div>
</div></template>


