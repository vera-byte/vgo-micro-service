<template><div><h1 id="è®¿é—®å¯†é’¥ç®¡ç†-api" tabindex="-1"><a class="header-anchor" href="#è®¿é—®å¯†é’¥ç®¡ç†-api">#</a> è®¿é—®å¯†é’¥ç®¡ç† API</h1>
<p>è®¿é—®å¯†é’¥ç®¡ç†APIæä¾›äº†å®Œæ•´çš„APIè®¿é—®å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯†é’¥çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°çŠ¶æ€å’Œåˆ é™¤æ“ä½œã€‚</p>
<h2 id="ğŸ“‹-api-æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“‹-api-æ¦‚è§ˆ">#</a> ğŸ“‹ API æ¦‚è§ˆ</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
<th>æƒé™è¦æ±‚</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>CreateAccessKey</code></td>
<td>åˆ›å»ºè®¿é—®å¯†é’¥</td>
<td><code v-pre>iam:CreateAccessKey</code></td>
</tr>
<tr>
<td><code v-pre>ListAccessKeys</code></td>
<td>è·å–è®¿é—®å¯†é’¥åˆ—è¡¨</td>
<td><code v-pre>iam:ListAccessKeys</code></td>
</tr>
<tr>
<td><code v-pre>UpdateAccessKey</code></td>
<td>æ›´æ–°è®¿é—®å¯†é’¥çŠ¶æ€</td>
<td><code v-pre>iam:UpdateAccessKey</code></td>
</tr>
<tr>
<td><code v-pre>DeleteAccessKey</code></td>
<td>åˆ é™¤è®¿é—®å¯†é’¥</td>
<td><code v-pre>iam:DeleteAccessKey</code></td>
</tr>
</tbody>
</table>
<h2 id="ğŸ”§-api-è¯¦æƒ…" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-api-è¯¦æƒ…">#</a> ğŸ”§ API è¯¦æƒ…</h2>
<h3 id="createaccesskey-åˆ›å»ºè®¿é—®å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#createaccesskey-åˆ›å»ºè®¿é—®å¯†é’¥">#</a> CreateAccessKey - åˆ›å»ºè®¿é—®å¯†é’¥</h3>
<p>ä¸ºæŒ‡å®šç”¨æˆ·åˆ›å»ºæ–°çš„APIè®¿é—®å¯†é’¥ã€‚</p>
<h4 id="è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">CreateAccessKeyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> user_name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token comment">// ç”¨æˆ·åï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> description <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>       <span class="token comment">// å¯†é’¥æè¿°ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token builtin">int32</span> app_id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>            <span class="token comment">// å…³è”åº”ç”¨IDï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token builtin">int32</span> expires_in_days <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// è¿‡æœŸå¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ°¸ä¸è¿‡æœŸï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”" tabindex="-1"><a class="header-anchor" href="#å“åº”">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">CreateAccessKeyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token positional-class-name class-name">AccessKey</span> access_key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">// åˆ›å»ºçš„è®¿é—®å¯†é’¥ä¿¡æ¯</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ä¸ºç”¨æˆ·åˆ›å»ºè®¿é—®å¯†é’¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "john_doe",</span>
<span class="line">  "description": "APIè®¿é—®å¯†é’¥"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CreateAccessKey</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºå…³è”åº”ç”¨çš„è®¿é—®å¯†é’¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "john_doe",</span>
<span class="line">  "description": "ç§»åŠ¨åº”ç”¨APIå¯†é’¥",</span>
<span class="line">  "app_id": 123,</span>
<span class="line">  "expires_in_days": 90</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CreateAccessKey</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"access_key"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"ak-123456"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"access_key_id"</span><span class="token operator">:</span> <span class="token string">"AKIA1234567890EXAMPLE"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"secret_access_key"</span><span class="token operator">:</span> <span class="token string">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token string">"user-789"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"user_name"</span><span class="token operator">:</span> <span class="token string">"john_doe"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"APIè®¿é—®å¯†é’¥"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"ACCESS_KEY_STATUS_ACTIVE"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"app_id"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"expires_at"</span><span class="token operator">:</span> <span class="token string">"2024-04-01T00:00:00Z"</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning">
<p class="hint-container-title">é‡è¦æç¤º</p>
<p><code v-pre>secret_access_key</code> åªåœ¨åˆ›å»ºæ—¶è¿”å›ä¸€æ¬¡ï¼Œè¯·å¦¥å–„ä¿å­˜ã€‚åç»­æ— æ³•å†æ¬¡è·å–ã€‚</p>
</div>
<h4 id="é”™è¯¯æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>ç”¨æˆ·ä¸å­˜åœ¨</td>
<td>ç¡®è®¤ç”¨æˆ·åæ­£ç¡®</td>
</tr>
<tr>
<td><code v-pre>INVALID_ARGUMENT</code></td>
<td>æ— æ•ˆçš„è¿‡æœŸå¤©æ•°</td>
<td>è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</td>
</tr>
<tr>
<td><code v-pre>RESOURCE_EXHAUSTED</code></td>
<td>ç”¨æˆ·è®¿é—®å¯†é’¥æ•°é‡è¾¾åˆ°ä¸Šé™</td>
<td>åˆ é™¤ä¸ä½¿ç”¨çš„å¯†é’¥</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— åˆ›å»ºè®¿é—®å¯†é’¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:CreateAccessKey</code>æƒé™</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="listaccesskeys-è·å–è®¿é—®å¯†é’¥åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#listaccesskeys-è·å–è®¿é—®å¯†é’¥åˆ—è¡¨">#</a> ListAccessKeys - è·å–è®¿é—®å¯†é’¥åˆ—è¡¨</h3>
<p>è·å–æŒ‡å®šç”¨æˆ·çš„è®¿é—®å¯†é’¥åˆ—è¡¨ã€‚</p>
<h4 id="è¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-1">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">ListAccessKeysRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> user_name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token comment">// ç”¨æˆ·åï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line">  <span class="token positional-class-name class-name">AccessKeyStatus</span> status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// å¯†é’¥çŠ¶æ€è¿‡æ»¤ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token builtin">int32</span> page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>              <span class="token comment">// é¡µç ï¼ˆä»1å¼€å§‹ï¼‰</span></span>
<span class="line">  <span class="token builtin">int32</span> page_size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>         <span class="token comment">// æ¯é¡µå¤§å°ï¼ˆæœ€å¤§100ï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-1" tabindex="-1"><a class="header-anchor" href="#å“åº”-1">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">ListAccessKeysResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">AccessKey</span> access_keys <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// è®¿é—®å¯†é’¥åˆ—è¡¨</span></span>
<span class="line">  <span class="token positional-class-name class-name">Pagination</span> pagination <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token comment">// åˆ†é¡µä¿¡æ¯</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># è·å–ç”¨æˆ·çš„æ‰€æœ‰è®¿é—®å¯†é’¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "john_doe",</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 10</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListAccessKeys</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åªè·å–æ´»è·ƒçš„è®¿é—®å¯†é’¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "john_doe",</span>
<span class="line">  "status": "ACCESS_KEY_STATUS_ACTIVE",</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 10</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListAccessKeys</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹-1">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"access_keys"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"ak-123456"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"access_key_id"</span><span class="token operator">:</span> <span class="token string">"AKIA1234567890EXAMPLE"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token string">"user-789"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"user_name"</span><span class="token operator">:</span> <span class="token string">"john_doe"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"APIè®¿é—®å¯†é’¥"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"ACCESS_KEY_STATUS_ACTIVE"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"app_id"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"last_used_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-15T10:30:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"expires_at"</span><span class="token operator">:</span> <span class="token string">"2024-04-01T00:00:00Z"</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"ak-789012"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"access_key_id"</span><span class="token operator">:</span> <span class="token string">"AKIA0987654321EXAMPLE"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token string">"user-789"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"user_name"</span><span class="token operator">:</span> <span class="token string">"john_doe"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"ç§»åŠ¨åº”ç”¨å¯†é’¥"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"ACCESS_KEY_STATUS_INACTIVE"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-10T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-12T00:00:00Z"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"pagination"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"page"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"page_size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"total_count"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"total_pages"</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip">
<p class="hint-container-title">æç¤º</p>
<p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œåˆ—è¡¨æ¥å£ä¸è¿”å› <code v-pre>secret_access_key</code> å­—æ®µã€‚</p>
</div>
<h4 id="é”™è¯¯æƒ…å†µ-1" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ-1">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>ç”¨æˆ·ä¸å­˜åœ¨</td>
<td>ç¡®è®¤ç”¨æˆ·åæ­£ç¡®</td>
</tr>
<tr>
<td><code v-pre>INVALID_ARGUMENT</code></td>
<td>æ— æ•ˆçš„åˆ†é¡µå‚æ•°</td>
<td>æ£€æŸ¥pageå’Œpage_sizeå€¼</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— æŸ¥çœ‹è®¿é—®å¯†é’¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:ListAccessKeys</code>æƒé™</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="updateaccesskey-æ›´æ–°è®¿é—®å¯†é’¥çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#updateaccesskey-æ›´æ–°è®¿é—®å¯†é’¥çŠ¶æ€">#</a> UpdateAccessKey - æ›´æ–°è®¿é—®å¯†é’¥çŠ¶æ€</h3>
<p>æ›´æ–°è®¿é—®å¯†é’¥çš„çŠ¶æ€æˆ–æè¿°ä¿¡æ¯ã€‚</p>
<h4 id="è¯·æ±‚-2" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-2">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">UpdateAccessKeyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> access_key_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">// è®¿é—®å¯†é’¥IDï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line">  <span class="token positional-class-name class-name">AccessKeyStatus</span> status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// æ–°çŠ¶æ€ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> description <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>       <span class="token comment">// æ–°æè¿°ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>FieldMask</span> update_mask <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// æ›´æ–°å­—æ®µæ©ç </span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-2" tabindex="-1"><a class="header-anchor" href="#å“åº”-2">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">UpdateAccessKeyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token positional-class-name class-name">AccessKey</span> access_key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">// æ›´æ–°åçš„è®¿é—®å¯†é’¥ä¿¡æ¯</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ç¦ç”¨è®¿é—®å¯†é’¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "access_key_id": "AKIA1234567890EXAMPLE",</span>
<span class="line">  "status": "ACCESS_KEY_STATUS_INACTIVE",</span>
<span class="line">  "update_mask": {</span>
<span class="line">    "paths": ["status"]</span>
<span class="line">  }</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/UpdateAccessKey</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># å¯ç”¨è®¿é—®å¯†é’¥å¹¶æ›´æ–°æè¿°</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "access_key_id": "AKIA1234567890EXAMPLE",</span>
<span class="line">  "status": "ACCESS_KEY_STATUS_ACTIVE",</span>
<span class="line">  "description": "æ›´æ–°åçš„APIè®¿é—®å¯†é’¥",</span>
<span class="line">  "update_mask": {</span>
<span class="line">    "paths": ["status", "description"]</span>
<span class="line">  }</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/UpdateAccessKey</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹-2">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"access_key"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"ak-123456"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"access_key_id"</span><span class="token operator">:</span> <span class="token string">"AKIA1234567890EXAMPLE"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token string">"user-789"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"user_name"</span><span class="token operator">:</span> <span class="token string">"john_doe"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"æ›´æ–°åçš„APIè®¿é—®å¯†é’¥"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"ACCESS_KEY_STATUS_ACTIVE"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"app_id"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-15T14:30:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"last_used_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-15T10:30:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"expires_at"</span><span class="token operator">:</span> <span class="token string">"2024-04-01T00:00:00Z"</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é”™è¯¯æƒ…å†µ-2" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ-2">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>è®¿é—®å¯†é’¥ä¸å­˜åœ¨</td>
<td>ç¡®è®¤è®¿é—®å¯†é’¥IDæ­£ç¡®</td>
</tr>
<tr>
<td><code v-pre>INVALID_ARGUMENT</code></td>
<td>æ— æ•ˆçš„çŠ¶æ€å€¼</td>
<td>ä½¿ç”¨æœ‰æ•ˆçš„çŠ¶æ€æšä¸¾å€¼</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— æ›´æ–°è®¿é—®å¯†é’¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:UpdateAccessKey</code>æƒé™</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="deleteaccesskey-åˆ é™¤è®¿é—®å¯†é’¥" tabindex="-1"><a class="header-anchor" href="#deleteaccesskey-åˆ é™¤è®¿é—®å¯†é’¥">#</a> DeleteAccessKey - åˆ é™¤è®¿é—®å¯†é’¥</h3>
<p>åˆ é™¤æŒ‡å®šçš„è®¿é—®å¯†é’¥ã€‚</p>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>åˆ é™¤è®¿é—®å¯†é’¥æ˜¯ä¸å¯é€†æ“ä½œï¼Œåˆ é™¤åä½¿ç”¨è¯¥å¯†é’¥çš„APIè°ƒç”¨å°†å¤±è´¥ã€‚</p>
</div>
<h4 id="è¯·æ±‚-3" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-3">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">DeleteAccessKeyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> access_key_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">// è®¿é—®å¯†é’¥IDï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-3" tabindex="-1"><a class="header-anchor" href="#å“åº”-3">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">DeleteAccessKeyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ç©ºå“åº”ï¼ŒæˆåŠŸæ—¶æ— è¿”å›å†…å®¹</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ é™¤è®¿é—®å¯†é’¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "access_key_id": "AKIA1234567890EXAMPLE"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/DeleteAccessKey</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹-3">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><h4 id="é”™è¯¯æƒ…å†µ-3" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ-3">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>è®¿é—®å¯†é’¥ä¸å­˜åœ¨</td>
<td>ç¡®è®¤è®¿é—®å¯†é’¥IDæ­£ç¡®</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— åˆ é™¤è®¿é—®å¯†é’¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:DeleteAccessKey</code>æƒé™</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ“Š-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-æ•°æ®æ¨¡å‹">#</a> ğŸ“Š æ•°æ®æ¨¡å‹</h2>
<h3 id="accesskey-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#accesskey-å¯¹è±¡">#</a> AccessKey å¯¹è±¡</h3>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">AccessKey</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                        <span class="token comment">// å†…éƒ¨IDï¼ˆç³»ç»Ÿç”Ÿæˆï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> access_key_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>             <span class="token comment">// è®¿é—®å¯†é’¥IDï¼ˆå…¬å¼€æ ‡è¯†ç¬¦ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> secret_access_key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>         <span class="token comment">// ç§˜å¯†è®¿é—®å¯†é’¥ï¼ˆä»…åˆ›å»ºæ—¶è¿”å›ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> user_id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>                   <span class="token comment">// ç”¨æˆ·ID</span></span>
<span class="line">  <span class="token builtin">string</span> user_name <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>                 <span class="token comment">// ç”¨æˆ·å</span></span>
<span class="line">  <span class="token builtin">string</span> description <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>               <span class="token comment">// å¯†é’¥æè¿°</span></span>
<span class="line">  <span class="token positional-class-name class-name">AccessKeyStatus</span> status <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>           <span class="token comment">// å¯†é’¥çŠ¶æ€</span></span>
<span class="line">  <span class="token builtin">int32</span> app_id <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>                     <span class="token comment">// å…³è”åº”ç”¨ID</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> created_at <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>     <span class="token comment">// åˆ›å»ºæ—¶é—´</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> updated_at <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token comment">// æ›´æ–°æ—¶é—´</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> last_used_at <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>  <span class="token comment">// æœ€åä½¿ç”¨æ—¶é—´</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> expires_at <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>    <span class="token comment">// è¿‡æœŸæ—¶é—´</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="accesskeystatus-æšä¸¾" tabindex="-1"><a class="header-anchor" href="#accesskeystatus-æšä¸¾">#</a> AccessKeyStatus æšä¸¾</h3>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">AccessKeyStatus</span> <span class="token punctuation">{</span></span>
<span class="line">  ACCESS_KEY_STATUS_UNSPECIFIED <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// æœªæŒ‡å®š</span></span>
<span class="line">  ACCESS_KEY_STATUS_ACTIVE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token comment">// æ´»è·ƒ</span></span>
<span class="line">  ACCESS_KEY_STATUS_INACTIVE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>       <span class="token comment">// éæ´»è·ƒ</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-æƒé™è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æƒé™è¦æ±‚">#</a> ğŸ” æƒé™è¦æ±‚</h2>
<h3 id="æ‰€éœ€æƒé™" tabindex="-1"><a class="header-anchor" href="#æ‰€éœ€æƒé™">#</a> æ‰€éœ€æƒé™</h3>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>æƒé™</th>
<th>èµ„æº</th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆ›å»ºè®¿é—®å¯†é’¥</td>
<td><code v-pre>iam:CreateAccessKey</code></td>
<td><code v-pre>arn:iam::user/*</code> æˆ– <code v-pre>arn:iam::user/${aws:username}</code></td>
</tr>
<tr>
<td>åˆ—è¡¨è®¿é—®å¯†é’¥</td>
<td><code v-pre>iam:ListAccessKeys</code></td>
<td><code v-pre>arn:iam::user/*</code> æˆ– <code v-pre>arn:iam::user/${aws:username}</code></td>
</tr>
<tr>
<td>æ›´æ–°è®¿é—®å¯†é’¥</td>
<td><code v-pre>iam:UpdateAccessKey</code></td>
<td><code v-pre>arn:iam::access-key/*</code></td>
</tr>
<tr>
<td>åˆ é™¤è®¿é—®å¯†é’¥</td>
<td><code v-pre>iam:DeleteAccessKey</code></td>
<td><code v-pre>arn:iam::access-key/*</code></td>
</tr>
</tbody>
</table>
<h3 id="ç­–ç•¥ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç­–ç•¥ç¤ºä¾‹">#</a> ç­–ç•¥ç¤ºä¾‹</h3>
<h4 id="ç”¨æˆ·è‡ªç®¡ç†è®¿é—®å¯†é’¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ç”¨æˆ·è‡ªç®¡ç†è®¿é—®å¯†é’¥ç­–ç•¥">#</a> ç”¨æˆ·è‡ªç®¡ç†è®¿é—®å¯†é’¥ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:CreateAccessKey"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:ListAccessKeys"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:UpdateAccessKey"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:DeleteAccessKey"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"arn:iam::user/${aws:username}"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"arn:iam::access-key/*"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"StringEquals"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"iam:AccessKeyOwner"</span><span class="token operator">:</span> <span class="token string">"${aws:username}"</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç®¡ç†å‘˜è®¿é—®å¯†é’¥ç®¡ç†ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ç®¡ç†å‘˜è®¿é—®å¯†é’¥ç®¡ç†ç­–ç•¥">#</a> ç®¡ç†å‘˜è®¿é—®å¯†é’¥ç®¡ç†ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:CreateAccessKey"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:ListAccessKeys"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:UpdateAccessKey"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:DeleteAccessKey"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”‘-è®¿é—®å¯†é’¥ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ğŸ”‘-è®¿é—®å¯†é’¥ä½¿ç”¨">#</a> ğŸ”‘ è®¿é—®å¯†é’¥ä½¿ç”¨</h2>
<h3 id="aws-signature-version-4-è®¤è¯" tabindex="-1"><a class="header-anchor" href="#aws-signature-version-4-è®¤è¯">#</a> AWS Signature Version 4 è®¤è¯</h3>
<p>VGOä½¿ç”¨AWS Signature Version 4ç®—æ³•è¿›è¡ŒAPIè®¤è¯ã€‚</p>
<h4 id="è®¤è¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#è®¤è¯æµç¨‹">#</a> è®¤è¯æµç¨‹</h4>
<ol>
<li><strong>å‡†å¤‡è¯·æ±‚</strong>ï¼šæ„é€ HTTPè¯·æ±‚</li>
<li><strong>åˆ›å»ºè§„èŒƒè¯·æ±‚</strong>ï¼šæ ‡å‡†åŒ–è¯·æ±‚æ ¼å¼</li>
<li><strong>åˆ›å»ºå¾…ç­¾åå­—ç¬¦ä¸²</strong>ï¼šåŒ…å«è¯·æ±‚æ‘˜è¦</li>
<li><strong>è®¡ç®—ç­¾å</strong>ï¼šä½¿ç”¨HMAC-SHA256ç®—æ³•</li>
<li><strong>æ·»åŠ è®¤è¯å¤´</strong>ï¼šåŒ…å«ç­¾åä¿¡æ¯</li>
</ol>
<h4 id="è®¤è¯å¤´æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#è®¤è¯å¤´æ ¼å¼">#</a> è®¤è¯å¤´æ ¼å¼</h4>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code class="language-text"><span class="line">Authorization: AWS4-HMAC-SHA256 Credential=AKIAIOSFODNN7EXAMPLE/20230101/us-east-1/iam/aws4_request, SignedHeaders=host;x-amz-date, Signature=calculated_signature</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><h4 id="go-sdk-ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#go-sdk-ç¤ºä¾‹">#</a> Go SDK ç¤ºä¾‹</h4>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">"context"</span></span>
<span class="line">    <span class="token string">"crypto/hmac"</span></span>
<span class="line">    <span class="token string">"crypto/sha256"</span></span>
<span class="line">    <span class="token string">"encoding/hex"</span></span>
<span class="line">    <span class="token string">"fmt"</span></span>
<span class="line">    <span class="token string">"time"</span></span>
<span class="line">    </span>
<span class="line">    <span class="token string">"google.golang.org/grpc"</span></span>
<span class="line">    <span class="token string">"google.golang.org/grpc/metadata"</span></span>
<span class="line">    </span>
<span class="line">    iamv1 <span class="token string">"github.com/your-org/vgo/api/iam/v1"</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Credentials <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    AccessKeyID     <span class="token builtin">string</span></span>
<span class="line">    SecretAccessKey <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Credentials<span class="token punctuation">)</span> <span class="token function">Sign</span><span class="token punctuation">(</span>stringToSign <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">    h <span class="token operator">:=</span> hmac<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>sha256<span class="token punctuation">.</span>New<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>SecretAccessKey<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    h<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>stringToSign<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">createAuthenticatedContext</span><span class="token punctuation">(</span>creds <span class="token operator">*</span>Credentials<span class="token punctuation">)</span> context<span class="token punctuation">.</span>Context <span class="token punctuation">{</span></span>
<span class="line">    now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    dateStamp <span class="token operator">:=</span> now<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"20060102"</span><span class="token punctuation">)</span></span>
<span class="line">    amzDate <span class="token operator">:=</span> now<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"20060102T150405Z"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// æ„é€ è®¤è¯å¤´</span></span>
<span class="line">    credential <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s/%s/us-east-1/iam/aws4_request"</span><span class="token punctuation">,</span> creds<span class="token punctuation">.</span>AccessKeyID<span class="token punctuation">,</span> dateStamp<span class="token punctuation">)</span></span>
<span class="line">    signedHeaders <span class="token operator">:=</span> <span class="token string">"host;x-amz-date"</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ç®€åŒ–çš„ç­¾åè®¡ç®—ï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦å®Œæ•´çš„SigV4å®ç°ï¼‰</span></span>
<span class="line">    stringToSign <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"AWS4-HMAC-SHA256\n%s\n%s/%s/us-east-1/iam/aws4_request\n%s"</span><span class="token punctuation">,</span></span>
<span class="line">        amzDate<span class="token punctuation">,</span> dateStamp<span class="token punctuation">,</span> <span class="token string">"iam"</span><span class="token punctuation">,</span> <span class="token string">"request_hash"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    signature <span class="token operator">:=</span> creds<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>stringToSign<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    authHeader <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"AWS4-HMAC-SHA256 Credential=%s, SignedHeaders=%s, Signature=%s"</span><span class="token punctuation">,</span></span>
<span class="line">        credential<span class="token punctuation">,</span> signedHeaders<span class="token punctuation">,</span> signature<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ›å»ºå¸¦è®¤è¯ä¿¡æ¯çš„context</span></span>
<span class="line">    md <span class="token operator">:=</span> metadata<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">"authorization"</span><span class="token punctuation">:</span> authHeader<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"x-amz-date"</span><span class="token punctuation">:</span>    amzDate<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> metadata<span class="token punctuation">.</span><span class="token function">NewOutgoingContext</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> md<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è¿æ¥åˆ°æœåŠ¡</span></span>
<span class="line">    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">"localhost:50051"</span><span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithInsecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    client <span class="token operator">:=</span> iamv1<span class="token punctuation">.</span><span class="token function">NewIAMClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ä½¿ç”¨è®¿é—®å¯†é’¥è®¤è¯</span></span>
<span class="line">    creds <span class="token operator">:=</span> <span class="token operator">&amp;</span>Credentials<span class="token punctuation">{</span></span>
<span class="line">        AccessKeyID<span class="token punctuation">:</span>     <span class="token string">"AKIA1234567890EXAMPLE"</span><span class="token punctuation">,</span></span>
<span class="line">        SecretAccessKey<span class="token punctuation">:</span> <span class="token string">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    ctx <span class="token operator">:=</span> <span class="token function">createAuthenticatedContext</span><span class="token punctuation">(</span>creds<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// è°ƒç”¨API</span></span>
<span class="line">    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ListAccessKeys</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>ListAccessKeysRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span> <span class="token string">"john_doe"</span><span class="token punctuation">,</span></span>
<span class="line">        Page<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        PageSize<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®å¯†é’¥åˆ—è¡¨: %v\n"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>AccessKeys<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨å®˜æ–¹aws-sdk" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨å®˜æ–¹aws-sdk">#</a> ä½¿ç”¨å®˜æ–¹AWS SDK</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">"context"</span></span>
<span class="line">    <span class="token string">"fmt"</span></span>
<span class="line">    </span>
<span class="line">    <span class="token string">"github.com/aws/aws-sdk-go/aws"</span></span>
<span class="line">    <span class="token string">"github.com/aws/aws-sdk-go/aws/credentials"</span></span>
<span class="line">    <span class="token string">"github.com/aws/aws-sdk-go/aws/session"</span></span>
<span class="line">    <span class="token string">"github.com/aws/aws-sdk-go/service/iam"</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// åˆ›å»ºAWSä¼šè¯</span></span>
<span class="line">    sess <span class="token operator">:=</span> session<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">NewSession</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>aws<span class="token punctuation">.</span>Config<span class="token punctuation">{</span></span>
<span class="line">        Region<span class="token punctuation">:</span> aws<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"us-east-1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        Credentials<span class="token punctuation">:</span> credentials<span class="token punctuation">.</span><span class="token function">NewStaticCredentials</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">"AKIA1234567890EXAMPLE"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">""</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        Endpoint<span class="token punctuation">:</span> aws<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"http://localhost:50051"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// VGOæœåŠ¡ç«¯ç‚¹</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ›å»ºIAMå®¢æˆ·ç«¯</span></span>
<span class="line">    svc <span class="token operator">:=</span> iam<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>sess<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ—å‡ºè®¿é—®å¯†é’¥</span></span>
<span class="line">    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">ListAccessKeys</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>iam<span class="token punctuation">.</span>ListAccessKeysInput<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span> aws<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"john_doe"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®å¯†é’¥: %v\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>AccessKeyMetadata<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ› ï¸-ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ› ï¸-ä½¿ç”¨ç¤ºä¾‹">#</a> ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 id="å®Œæ•´çš„è®¿é—®å¯†é’¥ç®¡ç†ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®Œæ•´çš„è®¿é—®å¯†é’¥ç®¡ç†ç¤ºä¾‹">#</a> å®Œæ•´çš„è®¿é—®å¯†é’¥ç®¡ç†ç¤ºä¾‹</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">"context"</span></span>
<span class="line">    <span class="token string">"fmt"</span></span>
<span class="line">    <span class="token string">"log"</span></span>
<span class="line">    <span class="token string">"time"</span></span>
<span class="line">    </span>
<span class="line">    <span class="token string">"google.golang.org/grpc"</span></span>
<span class="line">    <span class="token string">"google.golang.org/grpc/credentials/insecure"</span></span>
<span class="line">    <span class="token string">"google.golang.org/protobuf/types/known/fieldmaskpb"</span></span>
<span class="line">    </span>
<span class="line">    iamv1 <span class="token string">"github.com/your-org/vgo/api/iam/v1"</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è¿æ¥åˆ°æœåŠ¡</span></span>
<span class="line">    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">"localhost:50051"</span><span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithTransportCredentials</span><span class="token punctuation">(</span>insecure<span class="token punctuation">.</span><span class="token function">NewCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    client <span class="token operator">:=</span> iamv1<span class="token punctuation">.</span><span class="token function">NewIAMClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span></span>
<span class="line">    ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    userName <span class="token operator">:=</span> <span class="token string">"test_user"</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 1. åˆ›å»ºè®¿é—®å¯†é’¥</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"1. åˆ›å»ºè®¿é—®å¯†é’¥..."</span><span class="token punctuation">)</span></span>
<span class="line">    createResp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CreateAccessKey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>CreateAccessKeyRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span>      userName<span class="token punctuation">,</span></span>
<span class="line">        Description<span class="token punctuation">:</span>   <span class="token string">"æµ‹è¯•APIå¯†é’¥"</span><span class="token punctuation">,</span></span>
<span class="line">        ExpiresInDays<span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ›å»ºè®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    accessKeyID <span class="token operator">:=</span> createResp<span class="token punctuation">.</span>AccessKey<span class="token punctuation">.</span>AccessKeyId</span>
<span class="line">    secretAccessKey <span class="token operator">:=</span> createResp<span class="token punctuation">.</span>AccessKey<span class="token punctuation">.</span>SecretAccessKey</span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®å¯†é’¥åˆ›å»ºæˆåŠŸ:\n"</span><span class="token punctuation">)</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"  Access Key ID: %s\n"</span><span class="token punctuation">,</span> accessKeyID<span class="token punctuation">)</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"  Secret Access Key: %s\n"</span><span class="token punctuation">,</span> secretAccessKey<span class="token punctuation">)</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"  è¿‡æœŸæ—¶é—´: %s\n"</span><span class="token punctuation">,</span> createResp<span class="token punctuation">.</span>AccessKey<span class="token punctuation">.</span>ExpiresAt<span class="token punctuation">.</span><span class="token function">AsTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>RFC3339<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. åˆ—å‡ºç”¨æˆ·çš„è®¿é—®å¯†é’¥</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"\n2. åˆ—å‡ºè®¿é—®å¯†é’¥..."</span><span class="token punctuation">)</span></span>
<span class="line">    listResp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ListAccessKeys</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>ListAccessKeysRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span> userName<span class="token punctuation">,</span></span>
<span class="line">        Page<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        PageSize<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ—å‡ºè®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æ‰¾åˆ° %d ä¸ªè®¿é—®å¯†é’¥:\n"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>listResp<span class="token punctuation">.</span>AccessKeys<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> i<span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> listResp<span class="token punctuation">.</span>AccessKeys <span class="token punctuation">{</span></span>
<span class="line">        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"  %d. %s - %s (%s)\n"</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>AccessKeyId<span class="token punctuation">,</span> key<span class="token punctuation">.</span>Description<span class="token punctuation">,</span> key<span class="token punctuation">.</span>Status<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. ç¦ç”¨è®¿é—®å¯†é’¥</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"\n3. ç¦ç”¨è®¿é—®å¯†é’¥..."</span><span class="token punctuation">)</span></span>
<span class="line">    updateResp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">UpdateAccessKey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>UpdateAccessKeyRequest<span class="token punctuation">{</span></span>
<span class="line">        AccessKeyId<span class="token punctuation">:</span> accessKeyID<span class="token punctuation">,</span></span>
<span class="line">        Status<span class="token punctuation">:</span>      iamv1<span class="token punctuation">.</span>AccessKeyStatus_ACCESS_KEY_STATUS_INACTIVE<span class="token punctuation">,</span></span>
<span class="line">        UpdateMask<span class="token punctuation">:</span> <span class="token operator">&amp;</span>fieldmaskpb<span class="token punctuation">.</span>FieldMask<span class="token punctuation">{</span></span>
<span class="line">            Paths<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"æ›´æ–°è®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®å¯†é’¥çŠ¶æ€æ›´æ–°ä¸º: %s\n"</span><span class="token punctuation">,</span> updateResp<span class="token punctuation">.</span>AccessKey<span class="token punctuation">.</span>Status<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 4. é‡æ–°å¯ç”¨è®¿é—®å¯†é’¥</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"\n4. é‡æ–°å¯ç”¨è®¿é—®å¯†é’¥..."</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">UpdateAccessKey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>UpdateAccessKeyRequest<span class="token punctuation">{</span></span>
<span class="line">        AccessKeyId<span class="token punctuation">:</span> accessKeyID<span class="token punctuation">,</span></span>
<span class="line">        Status<span class="token punctuation">:</span>      iamv1<span class="token punctuation">.</span>AccessKeyStatus_ACCESS_KEY_STATUS_ACTIVE<span class="token punctuation">,</span></span>
<span class="line">        Description<span class="token punctuation">:</span> <span class="token string">"é‡æ–°å¯ç”¨çš„æµ‹è¯•APIå¯†é’¥"</span><span class="token punctuation">,</span></span>
<span class="line">        UpdateMask<span class="token punctuation">:</span> <span class="token operator">&amp;</span>fieldmaskpb<span class="token punctuation">.</span>FieldMask<span class="token punctuation">{</span></span>
<span class="line">            Paths<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token punctuation">,</span> <span class="token string">"description"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"æ›´æ–°è®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®å¯†é’¥å·²é‡æ–°å¯ç”¨"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 5. åˆ é™¤è®¿é—®å¯†é’¥</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"\n5. åˆ é™¤è®¿é—®å¯†é’¥..."</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">DeleteAccessKey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>DeleteAccessKeyRequest<span class="token punctuation">{</span></span>
<span class="line">        AccessKeyId<span class="token punctuation">:</span> accessKeyID<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤è®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®å¯†é’¥åˆ é™¤æˆåŠŸ"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 6. éªŒè¯åˆ é™¤</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"\n6. éªŒè¯åˆ é™¤ç»“æœ..."</span><span class="token punctuation">)</span></span>
<span class="line">    listResp2<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ListAccessKeys</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>ListAccessKeysRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span> userName<span class="token punctuation">,</span></span>
<span class="line">        Page<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        PageSize<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ—å‡ºè®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å‰©ä½™è®¿é—®å¯†é’¥æ•°é‡: %d\n"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>listResp2<span class="token punctuation">.</span>AccessKeys<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰¹é‡è®¿é—®å¯†é’¥ç®¡ç†è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡è®¿é—®å¯†é’¥ç®¡ç†è„šæœ¬">#</a> æ‰¹é‡è®¿é—®å¯†é’¥ç®¡ç†è„šæœ¬</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ‰¹é‡è®¿é—®å¯†é’¥ç®¡ç†è„šæœ¬</span></span>
<span class="line"><span class="token assign-left variable">SERVER</span><span class="token operator">=</span><span class="token string">"localhost:50051"</span></span>
<span class="line"><span class="token assign-left variable">USERS_FILE</span><span class="token operator">=</span><span class="token string">"users.txt"</span></span>
<span class="line"><span class="token assign-left variable">OUTPUT_FILE</span><span class="token operator">=</span><span class="token string">"access_keys.csv"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºCSVå¤´éƒ¨</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ç”¨æˆ·å,è®¿é—®å¯†é’¥ID,ç§˜å¯†è®¿é—®å¯†é’¥,æè¿°,çŠ¶æ€,åˆ›å»ºæ—¶é—´"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$OUTPUT_FILE</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºè®¿é—®å¯†é’¥</span></span>
<span class="line"><span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> username<span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"ä¸ºç”¨æˆ· <span class="token variable">$username</span> åˆ›å»ºè®¿é—®å¯†é’¥..."</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># åˆ›å»ºè®¿é—®å¯†é’¥</span></span>
<span class="line">    <span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>user_name<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$username</span><span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>description<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span>æ‰¹é‡åˆ›å»ºçš„APIå¯†é’¥<span class="token entity" title="\&quot;">\"</span></span>
<span class="line">    }"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/CreateAccessKey <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span class="token variable">)</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token comment"># è§£æç»“æœ</span></span>
<span class="line">        <span class="token assign-left variable">access_key_id</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$result</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.access_key_id'</span><span class="token variable">)</span></span></span>
<span class="line">        <span class="token assign-left variable">secret_access_key</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$result</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.secret_access_key'</span><span class="token variable">)</span></span></span>
<span class="line">        <span class="token assign-left variable">description</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$result</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.description'</span><span class="token variable">)</span></span></span>
<span class="line">        <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$result</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.status'</span><span class="token variable">)</span></span></span>
<span class="line">        <span class="token assign-left variable">created_at</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$result</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.created_at'</span><span class="token variable">)</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># å†™å…¥CSVæ–‡ä»¶</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$username</span>,<span class="token variable">$access_key_id</span>,<span class="token variable">$secret_access_key</span>,<span class="token variable">$description</span>,<span class="token variable">$status</span>,<span class="token variable">$created_at</span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$OUTPUT_FILE</span>"</span></span>
<span class="line">        </span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"  æˆåŠŸ: <span class="token variable">$access_key_id</span>"</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"  å¤±è´¥: æ— æ³•ä¸ºç”¨æˆ· <span class="token variable">$username</span> åˆ›å»ºè®¿é—®å¯†é’¥"</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">sleep</span> <span class="token number">0.1</span>  <span class="token comment"># é¿å…è¿‡å¿«è¯·æ±‚</span></span>
<span class="line"><span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">$USERS_FILE</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"æ‰¹é‡åˆ›å»ºå®Œæˆï¼Œç»“æœä¿å­˜åœ¨ <span class="token variable">$OUTPUT_FILE</span>"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è®¿é—®å¯†é’¥è½®æ¢è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#è®¿é—®å¯†é’¥è½®æ¢è„šæœ¬">#</a> è®¿é—®å¯†é’¥è½®æ¢è„šæœ¬</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¿é—®å¯†é’¥è½®æ¢è„šæœ¬</span></span>
<span class="line"><span class="token assign-left variable">SERVER</span><span class="token operator">=</span><span class="token string">"localhost:50051"</span></span>
<span class="line"><span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$USER_NAME</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"ç”¨æ³•: <span class="token variable">$0</span> &lt;ç”¨æˆ·å>"</span></span>
<span class="line">    <span class="token builtin class-name">exit</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"å¼€å§‹ä¸ºç”¨æˆ· <span class="token variable">$USER_NAME</span> è½®æ¢è®¿é—®å¯†é’¥..."</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 1. è·å–å½“å‰æ´»è·ƒçš„è®¿é—®å¯†é’¥</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"1. è·å–å½“å‰è®¿é—®å¯†é’¥..."</span></span>
<span class="line"><span class="token assign-left variable">current_keys</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">    <span class="token entity" title="\&quot;">\"</span>user_name<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$USER_NAME</span><span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">    <span class="token entity" title="\&quot;">\"</span>status<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span>ACCESS_KEY_STATUS_ACTIVE<span class="token entity" title="\&quot;">\"</span></span>
<span class="line">}"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/ListAccessKeys<span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"é”™è¯¯: æ— æ³•è·å–å½“å‰è®¿é—®å¯†é’¥"</span></span>
<span class="line">    <span class="token builtin class-name">exit</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"2. åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥..."</span></span>
<span class="line"><span class="token assign-left variable">new_key</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">    <span class="token entity" title="\&quot;">\"</span>user_name<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$USER_NAME</span><span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">    <span class="token entity" title="\&quot;">\"</span>description<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span>è½®æ¢ç”Ÿæˆçš„è®¿é—®å¯†é’¥ <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span><span class="token entity" title="\&quot;">\"</span></span>
<span class="line">}"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/CreateAccessKey<span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"é”™è¯¯: æ— æ³•åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥"</span></span>
<span class="line">    <span class="token builtin class-name">exit</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token assign-left variable">new_access_key_id</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$new_key</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.access_key_id'</span><span class="token variable">)</span></span></span>
<span class="line"><span class="token assign-left variable">new_secret_access_key</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$new_key</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_key.secret_access_key'</span><span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"æ–°è®¿é—®å¯†é’¥åˆ›å»ºæˆåŠŸ:"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  Access Key ID: <span class="token variable">$new_access_key_id</span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"  Secret Access Key: <span class="token variable">$new_secret_access_key</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. ç­‰å¾…ç”¨æˆ·ç¡®è®¤æ›´æ–°åº”ç”¨é…ç½®</span></span>
<span class="line"><span class="token builtin class-name">echo</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"è¯·æ›´æ–°æ‚¨çš„åº”ç”¨é…ç½®ä»¥ä½¿ç”¨æ–°çš„è®¿é—®å¯†é’¥ï¼Œç„¶åæŒ‰å›è½¦é”®ç»§ç»­..."</span></span>
<span class="line"><span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. ç¦ç”¨æ—§çš„è®¿é—®å¯†é’¥</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"3. ç¦ç”¨æ—§çš„è®¿é—®å¯†é’¥..."</span></span>
<span class="line"><span class="token assign-left variable">old_keys</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$current_keys</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.access_keys[].access_key_id'</span><span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">old_key_id</span> <span class="token keyword">in</span> <span class="token variable">$old_keys</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$old_key_id</span>"</span> <span class="token operator">!=</span> <span class="token string">"<span class="token variable">$new_access_key_id</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"  ç¦ç”¨å¯†é’¥: <span class="token variable">$old_key_id</span>"</span></span>
<span class="line">        grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">            <span class="token entity" title="\&quot;">\"</span>access_key_id<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$old_key_id</span><span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">            <span class="token entity" title="\&quot;">\"</span>status<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span>ACCESS_KEY_STATUS_INACTIVE<span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">            <span class="token entity" title="\&quot;">\"</span>update_mask<span class="token entity" title="\&quot;">\"</span>: {</span>
<span class="line">                <span class="token entity" title="\&quot;">\"</span>paths<span class="token entity" title="\&quot;">\"</span>: [<span class="token entity" title="\&quot;">\"</span>status<span class="token entity" title="\&quot;">\"</span>]</span>
<span class="line">            }</span>
<span class="line">        }"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/UpdateAccessKey <span class="token operator">></span> /dev/null</span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5. ç­‰å¾…ç¡®è®¤ååˆ é™¤æ—§å¯†é’¥</span></span>
<span class="line"><span class="token builtin class-name">echo</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"æ—§è®¿é—®å¯†é’¥å·²ç¦ç”¨ã€‚å¦‚æœæ–°å¯†é’¥å·¥ä½œæ­£å¸¸ï¼ŒæŒ‰å›è½¦é”®åˆ é™¤æ—§å¯†é’¥..."</span></span>
<span class="line"><span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"4. åˆ é™¤æ—§çš„è®¿é—®å¯†é’¥..."</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">old_key_id</span> <span class="token keyword">in</span> <span class="token variable">$old_keys</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$old_key_id</span>"</span> <span class="token operator">!=</span> <span class="token string">"<span class="token variable">$new_access_key_id</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"  åˆ é™¤å¯†é’¥: <span class="token variable">$old_key_id</span>"</span></span>
<span class="line">        grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">            <span class="token entity" title="\&quot;">\"</span>access_key_id<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$old_key_id</span><span class="token entity" title="\&quot;">\"</span></span>
<span class="line">        }"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/DeleteAccessKey <span class="token operator">></span> /dev/null</span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"è®¿é—®å¯†é’¥è½®æ¢å®Œæˆï¼"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æœ€ä½³å®è·µ">#</a> ğŸ” æœ€ä½³å®è·µ</h2>
<h3 id="_1-è®¿é—®å¯†é’¥å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#_1-è®¿é—®å¯†é’¥å®‰å…¨">#</a> 1. è®¿é—®å¯†é’¥å®‰å…¨</h3>
<h4 id="å®‰å…¨å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨å­˜å‚¨">#</a> å®‰å…¨å­˜å‚¨</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ä½¿ç”¨ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token string">"AKIA1234567890EXAMPLE"</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token string">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®é€‚å½“æƒé™ï¼‰</span></span>
<span class="line"><span class="token function">chmod</span> <span class="token number">600</span> ~/.aws/credentials</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é¿å…ç¡¬ç¼–ç " tabindex="-1"><a class="header-anchor" href="#é¿å…ç¡¬ç¼–ç ">#</a> é¿å…ç¡¬ç¼–ç </h4>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token comment">// é”™è¯¯åšæ³•</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">    AccessKeyID     <span class="token operator">=</span> <span class="token string">"AKIA1234567890EXAMPLE"</span></span>
<span class="line">    SecretAccessKey <span class="token operator">=</span> <span class="token string">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ­£ç¡®åšæ³•</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Credentials<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    accessKeyID <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">"AWS_ACCESS_KEY_ID"</span><span class="token punctuation">)</span></span>
<span class="line">    secretAccessKey <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">"AWS_SECRET_ACCESS_KEY"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> accessKeyID <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> secretAccessKey <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"ç¼ºå°‘è®¿é—®å¯†é’¥é…ç½®"</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Credentials<span class="token punctuation">{</span></span>
<span class="line">        AccessKeyID<span class="token punctuation">:</span>     accessKeyID<span class="token punctuation">,</span></span>
<span class="line">        SecretAccessKey<span class="token punctuation">:</span> secretAccessKey<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å¯†é’¥è½®æ¢ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_2-å¯†é’¥è½®æ¢ç­–ç•¥">#</a> 2. å¯†é’¥è½®æ¢ç­–ç•¥</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token comment">// å®šæœŸè½®æ¢è®¿é—®å¯†é’¥</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">rotateAccessKeys</span><span class="token punctuation">(</span>client iamv1<span class="token punctuation">.</span>IAMClient<span class="token punctuation">,</span> userName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">    ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 1. åˆ›å»ºæ–°å¯†é’¥</span></span>
<span class="line">    newKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CreateAccessKey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>CreateAccessKeyRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span>    userName<span class="token punctuation">,</span></span>
<span class="line">        Description<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"è½®æ¢å¯†é’¥ %s"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"åˆ›å»ºæ–°å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. æ›´æ–°åº”ç”¨é…ç½®ï¼ˆè¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå®ç°ï¼‰</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">updateApplicationConfig</span><span class="token punctuation">(</span>newKey<span class="token punctuation">.</span>AccessKey<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æ›´æ–°åº”ç”¨é…ç½®å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. ç­‰å¾…é…ç½®ç”Ÿæ•ˆ</span></span>
<span class="line">    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 4. åˆ é™¤æ—§å¯†é’¥</span></span>
<span class="line">    oldKeys<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ListAccessKeys</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>ListAccessKeysRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span> userName<span class="token punctuation">,</span></span>
<span class="line">        Status<span class="token punctuation">:</span>   iamv1<span class="token punctuation">.</span>AccessKeyStatus_ACCESS_KEY_STATUS_ACTIVE<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"è·å–æ—§å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> oldKeys<span class="token punctuation">.</span>AccessKeys <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> key<span class="token punctuation">.</span>AccessKeyId <span class="token operator">!=</span> newKey<span class="token punctuation">.</span>AccessKey<span class="token punctuation">.</span>AccessKeyId <span class="token punctuation">{</span></span>
<span class="line">            <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">DeleteAccessKey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>DeleteAccessKeyRequest<span class="token punctuation">{</span></span>
<span class="line">                AccessKeyId<span class="token punctuation">:</span> key<span class="token punctuation">.</span>AccessKeyId<span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤æ—§å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-å¯†é’¥ä½¿ç”¨ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#_3-å¯†é’¥ä½¿ç”¨ç›‘æ§">#</a> 3. å¯†é’¥ä½¿ç”¨ç›‘æ§</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token comment">// ç›‘æ§è®¿é—®å¯†é’¥ä½¿ç”¨æƒ…å†µ</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">monitorAccessKeyUsage</span><span class="token punctuation">(</span>client iamv1<span class="token punctuation">.</span>IAMClient<span class="token punctuation">,</span> userName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    keys<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ListAccessKeys</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>ListAccessKeysRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span> userName<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è·å–è®¿é—®å¯†é’¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> keys<span class="token punctuation">.</span>AccessKeys <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// æ£€æŸ¥æœ€åä½¿ç”¨æ—¶é—´</span></span>
<span class="line">        <span class="token keyword">if</span> key<span class="token punctuation">.</span>LastUsedAt <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            lastUsed <span class="token operator">:=</span> key<span class="token punctuation">.</span>LastUsedAt<span class="token punctuation">.</span><span class="token function">AsTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>lastUsed<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">30</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Hour <span class="token punctuation">{</span> <span class="token comment">// 30å¤©æœªä½¿ç”¨</span></span>
<span class="line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è­¦å‘Š: è®¿é—®å¯†é’¥ %s å·²è¶…è¿‡30å¤©æœªä½¿ç”¨"</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>AccessKeyId<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// æ£€æŸ¥è¿‡æœŸæ—¶é—´</span></span>
<span class="line">        <span class="token keyword">if</span> key<span class="token punctuation">.</span>ExpiresAt <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            expiresAt <span class="token operator">:=</span> key<span class="token punctuation">.</span>ExpiresAt<span class="token punctuation">.</span><span class="token function">AsTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> time<span class="token punctuation">.</span><span class="token function">Until</span><span class="token punctuation">(</span>expiresAt<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Hour <span class="token punctuation">{</span> <span class="token comment">// 7å¤©å†…è¿‡æœŸ</span></span>
<span class="line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è­¦å‘Š: è®¿é—®å¯†é’¥ %s å°†åœ¨7å¤©å†…è¿‡æœŸ"</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>AccessKeyId<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-é”™è¯¯å¤„ç†å’Œé‡è¯•" tabindex="-1"><a class="header-anchor" href="#_4-é”™è¯¯å¤„ç†å’Œé‡è¯•">#</a> 4. é”™è¯¯å¤„ç†å’Œé‡è¯•</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token comment">// å¸¦é‡è¯•çš„è®¿é—®å¯†é’¥æ“ä½œ</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">createAccessKeyWithRetry</span><span class="token punctuation">(</span>client iamv1<span class="token punctuation">.</span>IAMClient<span class="token punctuation">,</span> req <span class="token operator">*</span>iamv1<span class="token punctuation">.</span>CreateAccessKeyRequest<span class="token punctuation">,</span> maxRetries <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>iamv1<span class="token punctuation">.</span>CreateAccessKeyResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> lastErr <span class="token builtin">error</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxRetries<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">        resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CreateAccessKey</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> resp<span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        lastErr <span class="token operator">=</span> err</span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// æ£€æŸ¥æ˜¯å¦ä¸ºå¯é‡è¯•é”™è¯¯</span></span>
<span class="line">        <span class="token keyword">if</span> status<span class="token punctuation">.</span><span class="token function">Code</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">==</span> codes<span class="token punctuation">.</span>ResourceExhausted <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// è¾¾åˆ°å¯†é’¥æ•°é‡é™åˆ¶ï¼Œä¸é‡è¯•</span></span>
<span class="line">            <span class="token keyword">break</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// æŒ‡æ•°é€€é¿</span></span>
<span class="line">        backoff <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">float64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second</span>
<span class="line">        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>backoff<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"åˆ›å»ºè®¿é—®å¯†é’¥å¤±è´¥ï¼Œå·²é‡è¯•%dæ¬¡: %v"</span><span class="token punctuation">,</span> maxRetries<span class="token punctuation">,</span> lastErr<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-è®¿é—®å¯†é’¥å®¡è®¡" tabindex="-1"><a class="header-anchor" href="#_5-è®¿é—®å¯†é’¥å®¡è®¡">#</a> 5. è®¿é—®å¯†é’¥å®¡è®¡</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¿é—®å¯†é’¥å®¡è®¡è„šæœ¬</span></span>
<span class="line"><span class="token assign-left variable">SERVER</span><span class="token operator">=</span><span class="token string">"localhost:50051"</span></span>
<span class="line"><span class="token assign-left variable">REPORT_FILE</span><span class="token operator">=</span><span class="token string">"access_key_audit_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>.txt"</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"=== è®¿é—®å¯†é’¥å®¡è®¡æŠ¥å‘Š ==="</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ç”Ÿæˆæ—¶é—´: <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è·å–æ‰€æœ‰ç”¨æˆ·</span></span>
<span class="line"><span class="token assign-left variable">users</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 1000</span>
<span class="line">}'</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/ListUsers <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.users[].name'</span><span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"1. ç”¨æˆ·è®¿é—®å¯†é’¥ç»Ÿè®¡"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ç”¨æˆ·å,æ´»è·ƒå¯†é’¥æ•°,éæ´»è·ƒå¯†é’¥æ•°,æ€»æ•°"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">user</span> <span class="token keyword">in</span> <span class="token variable">$users</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token comment"># è·å–ç”¨æˆ·çš„è®¿é—®å¯†é’¥</span></span>
<span class="line">    <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>user_name<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$user</span><span class="token entity" title="\&quot;">\"</span></span>
<span class="line">    }"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/ListAccessKeys<span class="token variable">)</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token assign-left variable">active_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$keys</span>"</span> <span class="token operator">|</span> jq <span class="token string">'[.access_keys[] | select(.status == "ACCESS_KEY_STATUS_ACTIVE")] | length'</span><span class="token variable">)</span></span></span>
<span class="line">    <span class="token assign-left variable">inactive_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$keys</span>"</span> <span class="token operator">|</span> jq <span class="token string">'[.access_keys[] | select(.status == "ACCESS_KEY_STATUS_INACTIVE")] | length'</span><span class="token variable">)</span></span></span>
<span class="line">    <span class="token assign-left variable">total_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$keys</span>"</span> <span class="token operator">|</span> jq <span class="token string">'.access_keys | length'</span><span class="token variable">)</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$user</span>,<span class="token variable">$active_count</span>,<span class="token variable">$inactive_count</span>,<span class="token variable">$total_count</span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"2. é•¿æœŸæœªä½¿ç”¨çš„è®¿é—®å¯†é’¥"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ç”¨æˆ·å,è®¿é—®å¯†é’¥ID,æœ€åä½¿ç”¨æ—¶é—´,å¤©æ•°"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æŸ¥æ‰¾é•¿æœŸæœªä½¿ç”¨çš„å¯†é’¥ï¼ˆè¶…è¿‡30å¤©ï¼‰</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">user</span> <span class="token keyword">in</span> <span class="token variable">$users</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>user_name<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">$user</span><span class="token entity" title="\&quot;">\"</span></span>
<span class="line">    }"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/ListAccessKeys<span class="token variable">)</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$keys</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token parameter variable">--arg</span> user <span class="token string">"<span class="token variable">$user</span>"</span> <span class="token string">'</span>
<span class="line">        .access_keys[] | </span>
<span class="line">        select(.last_used_at != null) |</span>
<span class="line">        select((now - (.last_used_at | fromdateiso8601)) > (30 * 24 * 3600)) |</span>
<span class="line">        "\($user),\(.access_key_id),\(.last_used_at),\((now - (.last_used_at | fromdateiso8601)) / (24 * 3600) | floor)"</span>
<span class="line">    '</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ: <span class="token variable">$REPORT_FILE</span>"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš¨-æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#ğŸš¨-æ³¨æ„äº‹é¡¹">#</a> ğŸš¨ æ³¨æ„äº‹é¡¹</h2>
<h3 id="å®‰å…¨è€ƒè™‘" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨è€ƒè™‘">#</a> å®‰å…¨è€ƒè™‘</h3>
<ol>
<li>
<p><strong>å¯†é’¥ä¿æŠ¤</strong>ï¼š</p>
<ul>
<li>æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç è®¿é—®å¯†é’¥</li>
<li>ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å®‰å…¨çš„é…ç½®ç®¡ç†ç³»ç»Ÿ</li>
<li>è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™ï¼ˆ600ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å¯†é’¥è½®æ¢</strong>ï¼š</p>
<ul>
<li>å®šæœŸè½®æ¢è®¿é—®å¯†é’¥ï¼ˆå»ºè®®90å¤©ï¼‰</li>
<li>ç›‘æ§å¯†é’¥ä½¿ç”¨æƒ…å†µ</li>
<li>åŠæ—¶åˆ é™¤ä¸ä½¿ç”¨çš„å¯†é’¥</li>
</ul>
</li>
<li>
<p><strong>è®¿é—®æ§åˆ¶</strong>ï¼š</p>
<ul>
<li>éµå¾ªæœ€å°æƒé™åŸåˆ™</li>
<li>ä¸ºä¸åŒç”¨é€”åˆ›å»ºä¸åŒçš„å¯†é’¥</li>
<li>å®šæœŸå®¡æŸ¥å¯†é’¥æƒé™</li>
</ul>
</li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–">#</a> æ€§èƒ½ä¼˜åŒ–</h3>
<ol>
<li>
<p><strong>è¿æ¥å¤ç”¨</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è¿æ¥æ± </li>
<li>é¿å…é¢‘ç¹åˆ›å»ºè¿æ¥</li>
<li>è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´</li>
</ul>
</li>
<li>
<p><strong>æ‰¹é‡æ“ä½œ</strong>ï¼š</p>
<ul>
<li>é¿å…å¾ªç¯è°ƒç”¨API</li>
<li>ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢å¤§é‡æ•°æ®</li>
<li>åˆç†æ§åˆ¶å¹¶å‘æ•°</li>
</ul>
</li>
</ol>
<h3 id="é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯å¤„ç†">#</a> é”™è¯¯å¤„ç†</h3>
<ol>
<li>
<p><strong>é‡è¯•ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å®ç°æŒ‡æ•°é€€é¿é‡è¯•</li>
<li>åŒºåˆ†å¯é‡è¯•å’Œä¸å¯é‡è¯•é”™è¯¯</li>
<li>è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°</li>
</ul>
</li>
<li>
<p><strong>ç›‘æ§å‘Šè­¦</strong>ï¼š</p>
<ul>
<li>ç›‘æ§APIè°ƒç”¨æˆåŠŸç‡</li>
<li>è®¾ç½®å¯†é’¥è¿‡æœŸå‘Šè­¦</li>
<li>ç›‘æ§å¼‚å¸¸ä½¿ç”¨æ¨¡å¼</li>
</ul>
</li>
</ol>
<hr>
<div class="hint-container tip">
<p class="hint-container-title">æç¤º</p>
<p>å»ºè®®ä¸ºæ¯ä¸ªåº”ç”¨æˆ–æœåŠ¡åˆ›å»ºç‹¬ç«‹çš„è®¿é—®å¯†é’¥ï¼Œä¾¿äºç®¡ç†å’Œå®¡è®¡ã€‚</p>
</div>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>è®¿é—®å¯†é’¥çš„ç§˜å¯†éƒ¨åˆ†åªåœ¨åˆ›å»ºæ—¶è¿”å›ä¸€æ¬¡ï¼Œè¯·åŠ¡å¿…å¦¥å–„ä¿å­˜ã€‚å¦‚æœä¸¢å¤±ï¼Œéœ€è¦é‡æ–°åˆ›å»ºæ–°çš„å¯†é’¥ã€‚</p>
</div>
</div></template>


