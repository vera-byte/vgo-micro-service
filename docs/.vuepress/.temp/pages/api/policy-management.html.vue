<template><div><h1 id="ç­–ç•¥ç®¡ç†-api" tabindex="-1"><a class="header-anchor" href="#ç­–ç•¥ç®¡ç†-api">#</a> ç­–ç•¥ç®¡ç† API</h1>
<p>ç­–ç•¥ç®¡ç†APIæä¾›äº†å®Œæ•´çš„æƒé™ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç­–ç•¥çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ä»¥åŠç­–ç•¥ä¸ç”¨æˆ·çš„ç»‘å®šå…³ç³»ç®¡ç†ã€‚</p>
<h2 id="ğŸ“‹-api-æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“‹-api-æ¦‚è§ˆ">#</a> ğŸ“‹ API æ¦‚è§ˆ</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
<th>æƒé™è¦æ±‚</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>CreatePolicy</code></td>
<td>åˆ›å»ºæ–°ç­–ç•¥</td>
<td><code v-pre>iam:CreatePolicy</code></td>
</tr>
<tr>
<td><code v-pre>GetPolicy</code></td>
<td>è·å–ç­–ç•¥ä¿¡æ¯</td>
<td><code v-pre>iam:GetPolicy</code></td>
</tr>
<tr>
<td><code v-pre>UpdatePolicy</code></td>
<td>æ›´æ–°ç­–ç•¥ä¿¡æ¯</td>
<td><code v-pre>iam:UpdatePolicy</code></td>
</tr>
<tr>
<td><code v-pre>DeletePolicy</code></td>
<td>åˆ é™¤ç­–ç•¥</td>
<td><code v-pre>iam:DeletePolicy</code></td>
</tr>
<tr>
<td><code v-pre>ListPolicies</code></td>
<td>è·å–ç­–ç•¥åˆ—è¡¨</td>
<td><code v-pre>iam:ListPolicies</code></td>
</tr>
<tr>
<td><code v-pre>AttachUserPolicy</code></td>
<td>ç»‘å®šç­–ç•¥åˆ°ç”¨æˆ·</td>
<td><code v-pre>iam:AttachUserPolicy</code></td>
</tr>
<tr>
<td><code v-pre>DetachUserPolicy</code></td>
<td>è§£ç»‘ç”¨æˆ·ç­–ç•¥</td>
<td><code v-pre>iam:DetachUserPolicy</code></td>
</tr>
</tbody>
</table>
<h2 id="ğŸ”§-api-è¯¦æƒ…" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-api-è¯¦æƒ…">#</a> ğŸ”§ API è¯¦æƒ…</h2>
<h3 id="createpolicy-åˆ›å»ºç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#createpolicy-åˆ›å»ºç­–ç•¥">#</a> CreatePolicy - åˆ›å»ºç­–ç•¥</h3>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„æƒé™ç­–ç•¥ã€‚</p>
<h4 id="è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">CreatePolicyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">// ç­–ç•¥åç§°ï¼ˆå¿…éœ€ï¼Œå”¯ä¸€ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> description <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>       <span class="token comment">// ç­–ç•¥æè¿°ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> policy_document <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>   <span class="token comment">// ç­–ç•¥æ–‡æ¡£JSONï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line">  <span class="token keyword">repeated</span> <span class="token builtin">string</span> tags <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>     <span class="token comment">// ç­–ç•¥æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”" tabindex="-1"><a class="header-anchor" href="#å“åº”">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">CreatePolicyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token positional-class-name class-name">Policy</span> policy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token comment">// åˆ›å»ºçš„ç­–ç•¥ä¿¡æ¯</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºåªè¯»ç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "ReadOnlyPolicy",</span>
<span class="line">  "description": "åªè¯»æƒé™ç­–ç•¥",</span>
<span class="line">  "policy_document": "{\"Version\":\"2025-01-01\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"iam:GetUser\",\"iam:ListUsers\",\"iam:GetPolicy\",\"iam:ListPolicies\"],\"Resource\":[\"*\"]}]}",</span>
<span class="line">  "tags": ["readonly", "basic"]</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CreatePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºç®¡ç†å‘˜ç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "AdminPolicy",</span>
<span class="line">  "description": "ç®¡ç†å‘˜å®Œå…¨æƒé™ç­–ç•¥",</span>
<span class="line">  "policy_document": "{\"Version\":\"2025-01-01\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"*\"],\"Resource\":[\"*\"]}]}",</span>
<span class="line">  "tags": ["admin", "full-access"]</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CreatePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"policy"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"pol-123456"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ReadOnlyPolicy"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"åªè¯»æƒé™ç­–ç•¥"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"policy_document"</span><span class="token operator">:</span> <span class="token string">"{\"Version\":\"2025-01-01\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"iam:GetUser\",\"iam:ListUsers\",\"iam:GetPolicy\",\"iam:ListPolicies\"],\"Resource\":[\"*\"]}]}"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"readonly"</span><span class="token punctuation">,</span> <span class="token string">"basic"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é”™è¯¯æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>INVALID_ARGUMENT</code></td>
<td>ç­–ç•¥åç§°ä¸ºç©ºæˆ–ç­–ç•¥æ–‡æ¡£æ ¼å¼é”™è¯¯</td>
<td>æä¾›æœ‰æ•ˆçš„ç­–ç•¥åç§°å’ŒJSONæ–‡æ¡£</td>
</tr>
<tr>
<td><code v-pre>ALREADY_EXISTS</code></td>
<td>ç­–ç•¥åç§°å·²å­˜åœ¨</td>
<td>ä½¿ç”¨ä¸åŒçš„ç­–ç•¥åç§°</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— åˆ›å»ºç­–ç•¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:CreatePolicy</code>æƒé™</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="getpolicy-è·å–ç­–ç•¥ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#getpolicy-è·å–ç­–ç•¥ä¿¡æ¯">#</a> GetPolicy - è·å–ç­–ç•¥ä¿¡æ¯</h3>
<p>æ ¹æ®ç­–ç•¥åç§°æˆ–ç­–ç•¥IDè·å–ç­–ç•¥è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h4 id="è¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-1">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">GetPolicyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">oneof</span> identifier <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">// ç­–ç•¥åç§°</span></span>
<span class="line">    <span class="token builtin">string</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>      <span class="token comment">// ç­–ç•¥ID</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-1" tabindex="-1"><a class="header-anchor" href="#å“åº”-1">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">GetPolicyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token positional-class-name class-name">Policy</span> policy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// ç­–ç•¥ä¿¡æ¯</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># é€šè¿‡ç­–ç•¥åç§°è·å–</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "ReadOnlyPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/GetPolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># é€šè¿‡ç­–ç•¥IDè·å–</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "id": "pol-123456"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/GetPolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹-1">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"policy"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"pol-123456"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ReadOnlyPolicy"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"åªè¯»æƒé™ç­–ç•¥"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"policy_document"</span><span class="token operator">:</span> <span class="token string">"{\"Version\":\"2025-01-01\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"iam:GetUser\",\"iam:ListUsers\",\"iam:GetPolicy\",\"iam:ListPolicies\"],\"Resource\":[\"*\"]}]}"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"readonly"</span><span class="token punctuation">,</span> <span class="token string">"basic"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"attached_users_count"</span><span class="token operator">:</span> <span class="token number">5</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>
<h3 id="updatepolicy-æ›´æ–°ç­–ç•¥ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#updatepolicy-æ›´æ–°ç­–ç•¥ä¿¡æ¯">#</a> UpdatePolicy - æ›´æ–°ç­–ç•¥ä¿¡æ¯</h3>
<p>æ›´æ–°ç°æœ‰ç­–ç•¥çš„ä¿¡æ¯ã€‚</p>
<h4 id="è¯·æ±‚-2" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-2">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">UpdatePolicyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">oneof</span> identifier <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">// ç­–ç•¥åç§°</span></span>
<span class="line">    <span class="token builtin">string</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token comment">// ç­–ç•¥ID</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token builtin">string</span> description <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>         <span class="token comment">// æ–°çš„æè¿°ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> policy_document <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>     <span class="token comment">// æ–°çš„ç­–ç•¥æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token keyword">repeated</span> <span class="token builtin">string</span> tags <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>       <span class="token comment">// æ–°çš„æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>FieldMask</span> update_mask <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment">// æ›´æ–°å­—æ®µæ©ç </span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-2" tabindex="-1"><a class="header-anchor" href="#å“åº”-2">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">UpdatePolicyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token positional-class-name class-name">Policy</span> policy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">// æ›´æ–°åçš„ç­–ç•¥ä¿¡æ¯</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ›´æ–°ç­–ç•¥æè¿°</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "ReadOnlyPolicy",</span>
<span class="line">  "description": "æ›´æ–°åçš„åªè¯»æƒé™ç­–ç•¥æè¿°",</span>
<span class="line">  "update_mask": {</span>
<span class="line">    "paths": ["description"]</span>
<span class="line">  }</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/UpdatePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ›´æ–°ç­–ç•¥æ–‡æ¡£</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "id": "pol-123456",</span>
<span class="line">  "policy_document": "{\"Version\":\"2025-01-01\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"iam:GetUser\",\"iam:ListUsers\",\"iam:GetPolicy\",\"iam:ListPolicies\",\"iam:GetApplication\"],\"Resource\":[\"*\"]}]}",</span>
<span class="line">  "update_mask": {</span>
<span class="line">    "paths": ["policy_document"]</span>
<span class="line">  }</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/UpdatePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é”™è¯¯æƒ…å†µ-1" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ-1">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>INVALID_ARGUMENT</code></td>
<td>æ— æ•ˆçš„ç­–ç•¥æ–‡æ¡£æ ¼å¼</td>
<td>æ£€æŸ¥JSONè¯­æ³•å’Œç­–ç•¥ç»“æ„</td>
</tr>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>ç­–ç•¥ä¸å­˜åœ¨</td>
<td>ç¡®è®¤ç­–ç•¥æ ‡è¯†ç¬¦æ­£ç¡®</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— æ›´æ–°ç­–ç•¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:UpdatePolicy</code>æƒé™</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="deletepolicy-åˆ é™¤ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#deletepolicy-åˆ é™¤ç­–ç•¥">#</a> DeletePolicy - åˆ é™¤ç­–ç•¥</h3>
<p>åˆ é™¤æŒ‡å®šçš„ç­–ç•¥ã€‚</p>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>åˆ é™¤ç­–ç•¥å‰ä¼šè‡ªåŠ¨è§£ç»‘æ‰€æœ‰å…³è”çš„ç”¨æˆ·ã€‚</p>
</div>
<h4 id="è¯·æ±‚-3" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-3">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">DeletePolicyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">oneof</span> identifier <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">// ç­–ç•¥åç§°</span></span>
<span class="line">    <span class="token builtin">string</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>      <span class="token comment">// ç­–ç•¥ID</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token builtin">bool</span> force <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>       <span class="token comment">// å¼ºåˆ¶åˆ é™¤ï¼ˆå³ä½¿æœ‰ç”¨æˆ·ç»‘å®šï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-3" tabindex="-1"><a class="header-anchor" href="#å“åº”-3">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">DeletePolicyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ç©ºå“åº”ï¼ŒæˆåŠŸæ—¶æ— è¿”å›å†…å®¹</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ é™¤ç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "ReadOnlyPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/DeletePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># å¼ºåˆ¶åˆ é™¤ç­–ç•¥ï¼ˆè‡ªåŠ¨è§£ç»‘ç”¨æˆ·ï¼‰</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "id": "pol-123456",</span>
<span class="line">  "force": true</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/DeletePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>
<h3 id="listpolicies-è·å–ç­–ç•¥åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#listpolicies-è·å–ç­–ç•¥åˆ—è¡¨">#</a> ListPolicies - è·å–ç­–ç•¥åˆ—è¡¨</h3>
<p>è·å–ç³»ç»Ÿä¸­çš„ç­–ç•¥åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤ã€‚</p>
<h4 id="è¯·æ±‚-4" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-4">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">ListPoliciesRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">int32</span> page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>           <span class="token comment">// é¡µç ï¼ˆä»1å¼€å§‹ï¼‰</span></span>
<span class="line">  <span class="token builtin">int32</span> page_size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>      <span class="token comment">// æ¯é¡µå¤§å°ï¼ˆæœ€å¤§100ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> filter <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token comment">// è¿‡æ»¤æ¡ä»¶</span></span>
<span class="line">  <span class="token builtin">string</span> order_by <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>      <span class="token comment">// æ’åºå­—æ®µ</span></span>
<span class="line">  <span class="token builtin">bool</span> desc <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>            <span class="token comment">// æ˜¯å¦é™åº</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¿‡æ»¤æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#è¿‡æ»¤æ¡ä»¶">#</a> è¿‡æ»¤æ¡ä»¶</h4>
<p>æ”¯æŒçš„è¿‡æ»¤å­—æ®µï¼š</p>
<ul>
<li><code v-pre>name</code>: ç­–ç•¥åç§°ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰</li>
<li><code v-pre>description</code>: ç­–ç•¥æè¿°ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰</li>
<li><code v-pre>tags</code>: ç­–ç•¥æ ‡ç­¾</li>
<li><code v-pre>created_after</code>: åˆ›å»ºæ—¶é—´ä¹‹å</li>
<li><code v-pre>created_before</code>: åˆ›å»ºæ—¶é—´ä¹‹å‰</li>
</ul>
<h4 id="ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-4">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># è·å–æ‰€æœ‰ç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 20</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListPolicies</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æŒ‰æ ‡ç­¾è¿‡æ»¤</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 10,</span>
<span class="line">  "filter": "tags CONTAINS readonly"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListPolicies</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å“åº”ç¤ºä¾‹-2">#</a> å“åº”ç¤ºä¾‹</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"policies"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"pol-123456"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ReadOnlyPolicy"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"åªè¯»æƒé™ç­–ç•¥"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"readonly"</span><span class="token punctuation">,</span> <span class="token string">"basic"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"attached_users_count"</span><span class="token operator">:</span> <span class="token number">5</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"pagination"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">"page"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"page_size"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"total_count"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">"total_pages"</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>
<h3 id="attachuserpolicy-ç»‘å®šç­–ç•¥åˆ°ç”¨æˆ·" tabindex="-1"><a class="header-anchor" href="#attachuserpolicy-ç»‘å®šç­–ç•¥åˆ°ç”¨æˆ·">#</a> AttachUserPolicy - ç»‘å®šç­–ç•¥åˆ°ç”¨æˆ·</h3>
<p>å°†ç­–ç•¥ç»‘å®šåˆ°æŒ‡å®šç”¨æˆ·ã€‚</p>
<h4 id="è¯·æ±‚-5" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-5">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">AttachUserPolicyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> user_name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">// ç”¨æˆ·åï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> policy_name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// ç­–ç•¥åç§°ï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-4" tabindex="-1"><a class="header-anchor" href="#å“åº”-4">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">AttachUserPolicyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ç©ºå“åº”ï¼ŒæˆåŠŸæ—¶æ— è¿”å›å†…å®¹</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-5">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ç»‘å®šåªè¯»ç­–ç•¥åˆ°ç”¨æˆ·</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "john_doe",</span>
<span class="line">  "policy_name": "ReadOnlyPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/AttachUserPolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ç»‘å®šç®¡ç†å‘˜ç­–ç•¥åˆ°ç”¨æˆ·</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "admin_user",</span>
<span class="line">  "policy_name": "AdminPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/AttachUserPolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é”™è¯¯æƒ…å†µ-2" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ-2">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>ç”¨æˆ·æˆ–ç­–ç•¥ä¸å­˜åœ¨</td>
<td>ç¡®è®¤ç”¨æˆ·åå’Œç­–ç•¥åæ­£ç¡®</td>
</tr>
<tr>
<td><code v-pre>ALREADY_EXISTS</code></td>
<td>ç­–ç•¥å·²ç»‘å®šåˆ°ç”¨æˆ·</td>
<td>æ— éœ€é‡å¤ç»‘å®š</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— ç»‘å®šç­–ç•¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:AttachUserPolicy</code>æƒé™</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="detachuserpolicy-è§£ç»‘ç”¨æˆ·ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#detachuserpolicy-è§£ç»‘ç”¨æˆ·ç­–ç•¥">#</a> DetachUserPolicy - è§£ç»‘ç”¨æˆ·ç­–ç•¥</h3>
<p>ä»ç”¨æˆ·è§£ç»‘æŒ‡å®šç­–ç•¥ã€‚</p>
<h4 id="è¯·æ±‚-6" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚-6">#</a> è¯·æ±‚</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">DetachUserPolicyRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> user_name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">// ç”¨æˆ·åï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> policy_name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// ç­–ç•¥åç§°ï¼ˆå¿…éœ€ï¼‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å“åº”-5" tabindex="-1"><a class="header-anchor" href="#å“åº”-5">#</a> å“åº”</h4>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">DetachUserPolicyResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ç©ºå“åº”ï¼ŒæˆåŠŸæ—¶æ— è¿”å›å†…å®¹</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-6">#</a> ç¤ºä¾‹</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># è§£ç»‘ç”¨æˆ·ç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "john_doe",</span>
<span class="line">  "policy_name": "ReadOnlyPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/DetachUserPolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é”™è¯¯æƒ…å†µ-3" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æƒ…å†µ-3">#</a> é”™è¯¯æƒ…å†µ</h4>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>NOT_FOUND</code></td>
<td>ç”¨æˆ·ã€ç­–ç•¥ä¸å­˜åœ¨æˆ–æœªç»‘å®š</td>
<td>ç¡®è®¤ç»‘å®šå…³ç³»å­˜åœ¨</td>
</tr>
<tr>
<td><code v-pre>PERMISSION_DENIED</code></td>
<td>æ— è§£ç»‘ç­–ç•¥æƒé™</td>
<td>ç¡®ä¿æœ‰<code v-pre>iam:DetachUserPolicy</code>æƒé™</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ“Š-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-æ•°æ®æ¨¡å‹">#</a> ğŸ“Š æ•°æ®æ¨¡å‹</h2>
<h3 id="policy-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#policy-å¯¹è±¡">#</a> Policy å¯¹è±¡</h3>
<div class="language-protobuf line-numbers-mode" data-highlighter="prismjs" data-ext="protobuf"><pre v-pre><code class="language-protobuf"><span class="line"><span class="token keyword">message</span> <span class="token class-name">Policy</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">string</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token comment">// ç­–ç•¥IDï¼ˆç³»ç»Ÿç”Ÿæˆï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                  <span class="token comment">// ç­–ç•¥åç§°ï¼ˆå”¯ä¸€ï¼‰</span></span>
<span class="line">  <span class="token builtin">string</span> description <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>           <span class="token comment">// ç­–ç•¥æè¿°</span></span>
<span class="line">  <span class="token builtin">string</span> policy_document <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>       <span class="token comment">// ç­–ç•¥æ–‡æ¡£JSON</span></span>
<span class="line">  <span class="token keyword">repeated</span> <span class="token builtin">string</span> tags <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>         <span class="token comment">// ç­–ç•¥æ ‡ç­¾</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> created_at <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>     <span class="token comment">// åˆ›å»ºæ—¶é—´</span></span>
<span class="line">  <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> updated_at <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>     <span class="token comment">// æ›´æ–°æ—¶é—´</span></span>
<span class="line">  <span class="token builtin">int32</span> attached_users_count <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">// ç»‘å®šç”¨æˆ·æ•°é‡</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-ç­–ç•¥æ–‡æ¡£è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#ğŸ”-ç­–ç•¥æ–‡æ¡£è¯­æ³•">#</a> ğŸ” ç­–ç•¥æ–‡æ¡£è¯­æ³•</h2>
<h3 id="åŸºæœ¬ç»“æ„" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç»“æ„">#</a> åŸºæœ¬ç»“æ„</h3>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:GetUser"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:ListUsers"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"StringEquals"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"aws:RequestedRegion"</span><span class="token operator">:</span> <span class="token string">"us-east-1"</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å­—æ®µè¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å­—æ®µè¯´æ˜">#</a> å­—æ®µè¯´æ˜</h3>
<h4 id="version" tabindex="-1"><a class="header-anchor" href="#version">#</a> Version</h4>
<p>ç­–ç•¥è¯­è¨€ç‰ˆæœ¬ï¼Œå½“å‰æ”¯æŒ <code v-pre>&quot;2025-01-01&quot;</code>ã€‚</p>
<h4 id="statement" tabindex="-1"><a class="header-anchor" href="#statement">#</a> Statement</h4>
<p>æƒé™å£°æ˜æ•°ç»„ï¼Œæ¯ä¸ªå£°æ˜åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>
<ul>
<li>
<p><strong>Effect</strong>: æƒé™æ•ˆæœ</p>
<ul>
<li><code v-pre>&quot;Allow&quot;</code>: å…è®¸</li>
<li><code v-pre>&quot;Deny&quot;</code>: æ‹’ç»</li>
</ul>
</li>
<li>
<p><strong>Action</strong>: æ“ä½œåˆ—è¡¨</p>
<ul>
<li>æ”¯æŒé€šé…ç¬¦ <code v-pre>*</code></li>
<li>æ”¯æŒå‰ç¼€åŒ¹é… <code v-pre>iam:*</code></li>
<li>å…·ä½“æ“ä½œ <code v-pre>iam:GetUser</code></li>
</ul>
</li>
<li>
<p><strong>Resource</strong>: èµ„æºåˆ—è¡¨</p>
<ul>
<li>æ”¯æŒé€šé…ç¬¦ <code v-pre>*</code></li>
<li>ARNæ ¼å¼ <code v-pre>arn:iam::user/john_doe</code></li>
<li>å˜é‡æ›¿æ¢ <code v-pre>arn:iam::user/${aws:username}</code></li>
</ul>
</li>
<li>
<p><strong>Condition</strong>: æ¡ä»¶çº¦æŸï¼ˆå¯é€‰ï¼‰</p>
<ul>
<li>æ”¯æŒå¤šç§æ¡ä»¶æ“ä½œç¬¦</li>
<li>æ”¯æŒä¸Šä¸‹æ–‡å˜é‡</li>
</ul>
</li>
</ul>
<h3 id="å¸¸ç”¨ç­–ç•¥æ¨¡æ¿" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨ç­–ç•¥æ¨¡æ¿">#</a> å¸¸ç”¨ç­–ç•¥æ¨¡æ¿</h3>
<h4 id="_1-ç®¡ç†å‘˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_1-ç®¡ç†å‘˜ç­–ç•¥">#</a> 1. ç®¡ç†å‘˜ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-åªè¯»ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_2-åªè¯»ç­–ç•¥">#</a> 2. åªè¯»ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:Get*"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:List*"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-ç”¨æˆ·è‡ªç®¡ç†ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_3-ç”¨æˆ·è‡ªç®¡ç†ç­–ç•¥">#</a> 3. ç”¨æˆ·è‡ªç®¡ç†ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:GetUser"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:UpdateUser"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:CreateAccessKey"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:ListAccessKeys"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:UpdateAccessKey"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:DeleteAccessKey"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:iam::user/${aws:username}"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-åº”ç”¨ç®¡ç†ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_4-åº”ç”¨ç®¡ç†ç­–ç•¥">#</a> 4. åº”ç”¨ç®¡ç†ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:CreateApplication"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:GetApplication"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:UpdateApplication"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:DeleteApplication"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:ListApplications"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"StringEquals"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"iam:ApplicationOwner"</span><span class="token operator">:</span> <span class="token string">"${aws:username}"</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-æ—¶é—´é™åˆ¶ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_5-æ—¶é—´é™åˆ¶ç­–ç•¥">#</a> 5. æ—¶é—´é™åˆ¶ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"iam:*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"DateGreaterThan"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"aws:CurrentTime"</span><span class="token operator">:</span> <span class="token string">"2024-01-01T00:00:00Z"</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">"DateLessThan"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"aws:CurrentTime"</span><span class="token operator">:</span> <span class="token string">"2024-12-31T23:59:59Z"</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-ipé™åˆ¶ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_6-ipé™åˆ¶ç­–ç•¥">#</a> 6. IPé™åˆ¶ç­–ç•¥</h4>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"iam:*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">"IpAddress"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">"aws:SourceIp"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">"192.168.1.0/24"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">"10.0.0.0/8"</span></span>
<span class="line">          <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¡ä»¶æ“ä½œç¬¦" tabindex="-1"><a class="header-anchor" href="#æ¡ä»¶æ“ä½œç¬¦">#</a> æ¡ä»¶æ“ä½œç¬¦</h3>
<table>
<thead>
<tr>
<th>æ“ä½œç¬¦</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>StringEquals</code></td>
<td>å­—ç¬¦ä¸²ç›¸ç­‰</td>
<td><code v-pre>&quot;aws:username&quot;: &quot;john&quot;</code></td>
</tr>
<tr>
<td><code v-pre>StringLike</code></td>
<td>å­—ç¬¦ä¸²æ¨¡å¼åŒ¹é…</td>
<td><code v-pre>&quot;aws:userid&quot;: &quot;user-*&quot;</code></td>
</tr>
<tr>
<td><code v-pre>NumericEquals</code></td>
<td>æ•°å€¼ç›¸ç­‰</td>
<td><code v-pre>&quot;aws:TokenIssueTime&quot;: &quot;1234567890&quot;</code></td>
</tr>
<tr>
<td><code v-pre>NumericLessThan</code></td>
<td>æ•°å€¼å°äº</td>
<td><code v-pre>&quot;aws:MultiFactorAuthAge&quot;: &quot;3600&quot;</code></td>
</tr>
<tr>
<td><code v-pre>DateGreaterThan</code></td>
<td>æ—¥æœŸå¤§äº</td>
<td><code v-pre>&quot;aws:CurrentTime&quot;: &quot;2024-01-01T00:00:00Z&quot;</code></td>
</tr>
<tr>
<td><code v-pre>DateLessThan</code></td>
<td>æ—¥æœŸå°äº</td>
<td><code v-pre>&quot;aws:CurrentTime&quot;: &quot;2024-12-31T23:59:59Z&quot;</code></td>
</tr>
<tr>
<td><code v-pre>IpAddress</code></td>
<td>IPåœ°å€åŒ¹é…</td>
<td><code v-pre>&quot;aws:SourceIp&quot;: &quot;192.168.1.0/24&quot;</code></td>
</tr>
<tr>
<td><code v-pre>Bool</code></td>
<td>å¸ƒå°”å€¼</td>
<td><code v-pre>&quot;aws:SecureTransport&quot;: &quot;true&quot;</code></td>
</tr>
</tbody>
</table>
<h3 id="ä¸Šä¸‹æ–‡å˜é‡" tabindex="-1"><a class="header-anchor" href="#ä¸Šä¸‹æ–‡å˜é‡">#</a> ä¸Šä¸‹æ–‡å˜é‡</h3>
<table>
<thead>
<tr>
<th>å˜é‡</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>${aws:username}</code></td>
<td>å½“å‰ç”¨æˆ·å</td>
<td><code v-pre>john_doe</code></td>
</tr>
<tr>
<td><code v-pre>${aws:userid}</code></td>
<td>å½“å‰ç”¨æˆ·ID</td>
<td><code v-pre>user-123456</code></td>
</tr>
<tr>
<td><code v-pre>${aws:SourceIp}</code></td>
<td>è¯·æ±‚æ¥æºIP</td>
<td><code v-pre>192.168.1.100</code></td>
</tr>
<tr>
<td><code v-pre>${aws:CurrentTime}</code></td>
<td>å½“å‰æ—¶é—´</td>
<td><code v-pre>2024-01-01T12:00:00Z</code></td>
</tr>
<tr>
<td><code v-pre>${aws:SecureTransport}</code></td>
<td>æ˜¯å¦ä½¿ç”¨HTTPS</td>
<td><code v-pre>true</code></td>
</tr>
<tr>
<td><code v-pre>${aws:RequestedRegion}</code></td>
<td>è¯·æ±‚åŒºåŸŸ</td>
<td><code v-pre>us-east-1</code></td>
</tr>
</tbody>
</table>
<h2 id="ğŸ› ï¸-ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ› ï¸-ä½¿ç”¨ç¤ºä¾‹">#</a> ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 id="go-å®¢æˆ·ç«¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#go-å®¢æˆ·ç«¯ç¤ºä¾‹">#</a> Go å®¢æˆ·ç«¯ç¤ºä¾‹</h3>
<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre v-pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">"context"</span></span>
<span class="line">    <span class="token string">"encoding/json"</span></span>
<span class="line">    <span class="token string">"fmt"</span></span>
<span class="line">    <span class="token string">"log"</span></span>
<span class="line">    </span>
<span class="line">    <span class="token string">"google.golang.org/grpc"</span></span>
<span class="line">    <span class="token string">"google.golang.org/grpc/credentials/insecure"</span></span>
<span class="line">    </span>
<span class="line">    iamv1 <span class="token string">"github.com/your-org/vgo/api/iam/v1"</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> PolicyDocument <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Version   <span class="token builtin">string</span>      <span class="token string">`json:"Version"`</span></span>
<span class="line">    Statement <span class="token punctuation">[</span><span class="token punctuation">]</span>Statement <span class="token string">`json:"Statement"`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Statement <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    Effect   <span class="token builtin">string</span>   <span class="token string">`json:"Effect"`</span></span>
<span class="line">    Action   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:"Action"`</span></span>
<span class="line">    Resource <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:"Resource"`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è¿æ¥åˆ°æœåŠ¡</span></span>
<span class="line">    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">"localhost:50051"</span><span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithTransportCredentials</span><span class="token punctuation">(</span>insecure<span class="token punctuation">.</span><span class="token function">NewCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    client <span class="token operator">:=</span> iamv1<span class="token punctuation">.</span><span class="token function">NewIAMClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span></span>
<span class="line">    ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ›å»ºç­–ç•¥æ–‡æ¡£</span></span>
<span class="line">    policyDoc <span class="token operator">:=</span> PolicyDocument<span class="token punctuation">{</span></span>
<span class="line">        Version<span class="token punctuation">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">        Statement<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Statement<span class="token punctuation">{</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                Effect<span class="token punctuation">:</span>   <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">                Action<span class="token punctuation">:</span>   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"iam:GetUser"</span><span class="token punctuation">,</span> <span class="token string">"iam:ListUsers"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                Resource<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"*"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    policyJSON<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>policyDoc<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åºåˆ—åŒ–ç­–ç•¥æ–‡æ¡£å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ›å»ºç­–ç•¥</span></span>
<span class="line">    createResp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CreatePolicy</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>CreatePolicyRequest<span class="token punctuation">{</span></span>
<span class="line">        Name<span class="token punctuation">:</span>           <span class="token string">"TestReadOnlyPolicy"</span><span class="token punctuation">,</span></span>
<span class="line">        Description<span class="token punctuation">:</span>    <span class="token string">"æµ‹è¯•åªè¯»ç­–ç•¥"</span><span class="token punctuation">,</span></span>
<span class="line">        PolicyDocument<span class="token punctuation">:</span> <span class="token function">string</span><span class="token punctuation">(</span>policyJSON<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        Tags<span class="token punctuation">:</span>           <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"readonly"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ›å»ºç­–ç•¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç­–ç•¥åˆ›å»ºæˆåŠŸ: %v\n"</span><span class="token punctuation">,</span> createResp<span class="token punctuation">.</span>Policy<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ç»‘å®šç­–ç•¥åˆ°ç”¨æˆ·</span></span>
<span class="line">    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">AttachUserPolicy</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>AttachUserPolicyRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span>   <span class="token string">"test_user"</span><span class="token punctuation">,</span></span>
<span class="line">        PolicyName<span class="token punctuation">:</span> <span class="token string">"TestReadOnlyPolicy"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"ç»‘å®šç­–ç•¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ç­–ç•¥ç»‘å®šæˆåŠŸ"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// è·å–ç­–ç•¥åˆ—è¡¨</span></span>
<span class="line">    listResp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ListPolicies</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>ListPoliciesRequest<span class="token punctuation">{</span></span>
<span class="line">        Page<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        PageSize<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">        Filter<span class="token punctuation">:</span>   <span class="token string">"tags CONTAINS test"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è·å–ç­–ç•¥åˆ—è¡¨å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç­–ç•¥åˆ—è¡¨: %v\n"</span><span class="token punctuation">,</span> listResp<span class="token punctuation">.</span>Policies<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// è§£ç»‘ç­–ç•¥</span></span>
<span class="line">    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">DetachUserPolicy</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>DetachUserPolicyRequest<span class="token punctuation">{</span></span>
<span class="line">        UserName<span class="token punctuation">:</span>   <span class="token string">"test_user"</span><span class="token punctuation">,</span></span>
<span class="line">        PolicyName<span class="token punctuation">:</span> <span class="token string">"TestReadOnlyPolicy"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è§£ç»‘ç­–ç•¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ç­–ç•¥è§£ç»‘æˆåŠŸ"</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ é™¤ç­–ç•¥</span></span>
<span class="line">    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">DeletePolicy</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>DeletePolicyRequest<span class="token punctuation">{</span></span>
<span class="line">        Identifier<span class="token punctuation">:</span> <span class="token operator">&amp;</span>iamv1<span class="token punctuation">.</span>DeletePolicyRequest_Name<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"TestReadOnlyPolicy"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤ç­–ç•¥å¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ç­–ç•¥åˆ é™¤æˆåŠŸ"</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰¹é‡ç­–ç•¥ç®¡ç†è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡ç­–ç•¥ç®¡ç†è„šæœ¬">#</a> æ‰¹é‡ç­–ç•¥ç®¡ç†è„šæœ¬</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ‰¹é‡åˆ›å»ºç­–ç•¥è„šæœ¬</span></span>
<span class="line"><span class="token assign-left variable">POLICIES_DIR</span><span class="token operator">=</span><span class="token string">"policies"</span></span>
<span class="line"><span class="token assign-left variable">SERVER</span><span class="token operator">=</span><span class="token string">"localhost:50051"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºç­–ç•¥ç›®å½•</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$POLICIES_DIR</span>"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºåªè¯»ç­–ç•¥æ–‡ä»¶</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$POLICIES_DIR</span>/readonly.json"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'</span>
<span class="line">{</span>
<span class="line">  "Version": "2025-01-01",</span>
<span class="line">  "Statement": [</span>
<span class="line">    {</span>
<span class="line">      "Effect": "Allow",</span>
<span class="line">      "Action": [</span>
<span class="line">        "iam:Get*",</span>
<span class="line">        "iam:List*"</span>
<span class="line">      ],</span>
<span class="line">      "Resource": "*"</span>
<span class="line">    }</span>
<span class="line">  ]</span>
<span class="line">}</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºç”¨æˆ·ç®¡ç†ç­–ç•¥æ–‡ä»¶</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$POLICIES_DIR</span>/user-management.json"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'</span>
<span class="line">{</span>
<span class="line">  "Version": "2025-01-01",</span>
<span class="line">  "Statement": [</span>
<span class="line">    {</span>
<span class="line">      "Effect": "Allow",</span>
<span class="line">      "Action": [</span>
<span class="line">        "iam:CreateUser",</span>
<span class="line">        "iam:GetUser",</span>
<span class="line">        "iam:UpdateUser",</span>
<span class="line">        "iam:DeleteUser",</span>
<span class="line">        "iam:ListUsers"</span>
<span class="line">      ],</span>
<span class="line">      "Resource": "*"</span>
<span class="line">    }</span>
<span class="line">  ]</span>
<span class="line">}</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ‰¹é‡åˆ›å»ºç­–ç•¥</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">policy_file</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">$POLICIES_DIR</span>"</span>/*.json<span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">    <span class="token assign-left variable">policy_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> <span class="token string">"<span class="token variable">$policy_file</span>"</span> .json<span class="token variable">)</span></span></span>
<span class="line">    <span class="token assign-left variable">policy_content</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> <span class="token string">"<span class="token variable">$policy_file</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-c</span> <span class="token builtin class-name">.</span><span class="token variable">)</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">"åˆ›å»ºç­–ç•¥: <span class="token variable">$policy_name</span>"</span></span>
<span class="line">    grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">"{</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>name<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable">${policy_name}</span><span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>description<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span>ä»æ–‡ä»¶ <span class="token variable">${policy_file}</span> åˆ›å»ºçš„ç­–ç•¥<span class="token entity" title="\&quot;">\"</span>,</span>
<span class="line">        <span class="token entity" title="\&quot;">\"</span>policy_document<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $policy_content <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/"/\\"/g'</span><span class="token variable">)</span></span><span class="token entity" title="\&quot;">\"</span></span>
<span class="line">    }"</span> <span class="token string">"<span class="token variable">$SERVER</span>"</span> iam.v1.IAM/CreatePolicy</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"ç­–ç•¥ <span class="token variable">$policy_name</span> åˆ›å»ºæˆåŠŸ"</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">"ç­–ç•¥ <span class="token variable">$policy_name</span> åˆ›å»ºå¤±è´¥"</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">sleep</span> <span class="token number">0.1</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"æ‰¹é‡ç­–ç•¥åˆ›å»ºå®Œæˆ"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç­–ç•¥éªŒè¯å·¥å…·" tabindex="-1"><a class="header-anchor" href="#ç­–ç•¥éªŒè¯å·¥å…·">#</a> ç­–ç•¥éªŒè¯å·¥å…·</h3>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code class="language-python"><span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">import</span> jsonschema</span>
<span class="line"><span class="token keyword">from</span> jsonschema <span class="token keyword">import</span> validate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç­–ç•¥æ–‡æ¡£JSON Schema</span></span>
<span class="line">policy_schema <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">"Version"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">"enum"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"2025-01-01"</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"Statement"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token string">"Effect"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token string">"enum"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"Allow"</span><span class="token punctuation">,</span> <span class="token string">"Deny"</span><span class="token punctuation">]</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">"Action"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token string">"oneOf"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="line">                            <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token punctuation">{</span></span>
<span class="line">                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span></span>
<span class="line">                                <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token punctuation">]</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">"Resource"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token string">"oneOf"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="line">                            <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token punctuation">{</span></span>
<span class="line">                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span></span>
<span class="line">                                <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token punctuation">]</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">"Condition"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"Effect"</span><span class="token punctuation">,</span> <span class="token string">"Action"</span><span class="token punctuation">,</span> <span class="token string">"Resource"</span><span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"Version"</span><span class="token punctuation">,</span> <span class="token string">"Statement"</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">validate_policy</span><span class="token punctuation">(</span>policy_document<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">"""éªŒè¯ç­–ç•¥æ–‡æ¡£æ ¼å¼"""</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        policy <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>policy_document<span class="token punctuation">)</span></span>
<span class="line">        validate<span class="token punctuation">(</span>instance<span class="token operator">=</span>policy<span class="token punctuation">,</span> schema<span class="token operator">=</span>policy_schema<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"ç­–ç•¥æ–‡æ¡£æ ¼å¼æ­£ç¡®"</span></span>
<span class="line">    <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"JSONæ ¼å¼é”™è¯¯: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span></span>
<span class="line">    <span class="token keyword">except</span> jsonschema<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ValidationError <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"ç­–ç•¥æ ¼å¼é”™è¯¯: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">.</span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span></span>
<span class="line">    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"éªŒè¯å¤±è´¥: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># æµ‹è¯•ç­–ç•¥æ–‡æ¡£</span></span>
<span class="line">    test_policy <span class="token operator">=</span> <span class="token triple-quoted-string string">'''</span>
<span class="line">    {</span>
<span class="line">        "Version": "2025-01-01",</span>
<span class="line">        "Statement": [</span>
<span class="line">            {</span>
<span class="line">                "Effect": "Allow",</span>
<span class="line">                "Action": ["iam:GetUser", "iam:ListUsers"],</span>
<span class="line">                "Resource": "*"</span>
<span class="line">            }</span>
<span class="line">        ]</span>
<span class="line">    }</span>
<span class="line">    '''</span></span>
<span class="line">    </span>
<span class="line">    is_valid<span class="token punctuation">,</span> message <span class="token operator">=</span> validate_policy<span class="token punctuation">(</span>test_policy<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"éªŒè¯ç»“æœ: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æœ€ä½³å®è·µ">#</a> ğŸ” æœ€ä½³å®è·µ</h2>
<h3 id="_1-ç­–ç•¥å‘½åè§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#_1-ç­–ç•¥å‘½åè§„èŒƒ">#</a> 1. ç­–ç•¥å‘½åè§„èŒƒ</h3>
<ul>
<li>ä½¿ç”¨æè¿°æ€§åç§°</li>
<li>éµå¾ªä¸€è‡´çš„å‘½åçº¦å®š</li>
<li>åŒ…å«ç­–ç•¥ç”¨é€”å’ŒèŒƒå›´</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># å¥½çš„ç­–ç•¥åç§°ç¤ºä¾‹</span></span>
<span class="line"><span class="token string">"ReadOnlyPolicy"</span></span>
<span class="line"><span class="token string">"UserManagementPolicy"</span></span>
<span class="line"><span class="token string">"ApplicationDeveloperPolicy"</span></span>
<span class="line"><span class="token string">"AdminFullAccessPolicy"</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># é¿å…çš„ç­–ç•¥åç§°</span></span>
<span class="line"><span class="token string">"Policy1"</span></span>
<span class="line"><span class="token string">"Test"</span></span>
<span class="line"><span class="token string">"Temp"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æœ€å°æƒé™åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#_2-æœ€å°æƒé™åŸåˆ™">#</a> 2. æœ€å°æƒé™åŸåˆ™</h3>
<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre v-pre><code class="language-json"><span class="line"><span class="token comment">// å¥½çš„åšæ³•ï¼šå…·ä½“çš„æƒé™</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">"iam:GetUser"</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">"iam:UpdateUser"</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:iam::user/${aws:username}"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é¿å…ï¼šè¿‡äºå®½æ³›çš„æƒé™</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ç­–ç•¥ç‰ˆæœ¬ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_3-ç­–ç•¥ç‰ˆæœ¬ç®¡ç†">#</a> 3. ç­–ç•¥ç‰ˆæœ¬ç®¡ç†</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºç­–ç•¥æ—¶åŒ…å«ç‰ˆæœ¬ä¿¡æ¯</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "ReadOnlyPolicy_v2",</span>
<span class="line">  "description": "åªè¯»ç­–ç•¥ v2.0 - å¢åŠ åº”ç”¨æŸ¥çœ‹æƒé™",</span>
<span class="line">  "policy_document": "...",</span>
<span class="line">  "tags": ["readonly", "v2"]</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CreatePolicy</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-ç­–ç•¥æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-ç­–ç•¥æµ‹è¯•">#</a> 4. ç­–ç•¥æµ‹è¯•</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºæµ‹è¯•ç”¨æˆ·</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "test_policy_user",</span>
<span class="line">  "display_name": "Policy Test User",</span>
<span class="line">  "email": "test@example.com"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CreateUser</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç»‘å®šç­–ç•¥</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "test_policy_user",</span>
<span class="line">  "policy_name": "ReadOnlyPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/AttachUserPolicy</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æµ‹è¯•æƒé™</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "test_policy_user",</span>
<span class="line">  "action": "iam:GetUser",</span>
<span class="line">  "resource": "*"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/CheckPermission</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ¸…ç†æµ‹è¯•æ•°æ®</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "user_name": "test_policy_user",</span>
<span class="line">  "policy_name": "ReadOnlyPolicy"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/DetachUserPolicy</span>
<span class="line"></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "name": "test_policy_user"</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/DeleteUser</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-ç­–ç•¥å®¡è®¡" tabindex="-1"><a class="header-anchor" href="#_5-ç­–ç•¥å®¡è®¡">#</a> 5. ç­–ç•¥å®¡è®¡</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç­–ç•¥å®¡è®¡è„šæœ¬</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"=== ç­–ç•¥å®¡è®¡æŠ¥å‘Š ==="</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"ç”Ÿæˆæ—¶é—´: <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span></span>
<span class="line"><span class="token builtin class-name">echo</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è·å–æ‰€æœ‰ç­–ç•¥</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"1. ç­–ç•¥æ€»æ•°ç»Ÿè®¡"</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 1000</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListPolicies <span class="token operator">|</span> jq <span class="token string">'.pagination.total_count'</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"2. æœªç»‘å®šç”¨æˆ·çš„ç­–ç•¥"</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 1000</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListPolicies <span class="token operator">|</span> jq <span class="token string">'.policies[] | select(.attached_users_count == 0) | .name'</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"3. ä½¿ç”¨é€šé…ç¬¦æƒé™çš„ç­–ç•¥"</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{</span>
<span class="line">  "page": 1,</span>
<span class="line">  "page_size": 1000</span>
<span class="line">}'</span> localhost:50051 iam.v1.IAM/ListPolicies <span class="token operator">|</span> jq <span class="token string">'.policies[] | select(.policy_document | contains("\"*\"")) | .name'</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">"å®¡è®¡å®Œæˆ"</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš¨-æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#ğŸš¨-æ³¨æ„äº‹é¡¹">#</a> ğŸš¨ æ³¨æ„äº‹é¡¹</h2>
<h3 id="å®‰å…¨è€ƒè™‘" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨è€ƒè™‘">#</a> å®‰å…¨è€ƒè™‘</h3>
<ol>
<li>
<p><strong>ç­–ç•¥æ–‡æ¡£å®‰å…¨</strong>ï¼š</p>
<ul>
<li>é¿å…åœ¨ç­–ç•¥ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯</li>
<li>ä½¿ç”¨å˜é‡æ›¿æ¢è€Œéå…·ä½“å€¼</li>
<li>å®šæœŸå®¡æŸ¥ç­–ç•¥æƒé™</li>
</ul>
</li>
<li>
<p><strong>æƒé™æ§åˆ¶</strong>ï¼š</p>
<ul>
<li>éµå¾ªæœ€å°æƒé™åŸåˆ™</li>
<li>é¿å…ä½¿ç”¨è¿‡äºå®½æ³›çš„é€šé…ç¬¦</li>
<li>å®šæœŸæ¸…ç†ä¸ä½¿ç”¨çš„ç­–ç•¥</li>
</ul>
</li>
<li>
<p><strong>ç­–ç•¥å†²çª</strong>ï¼š</p>
<ul>
<li>Denyä¼˜å…ˆäºAllow</li>
<li>æ˜ç¡®çš„æƒé™ä¼˜å…ˆäºé€šé…ç¬¦</li>
<li>é¿å…ç­–ç•¥é—´çš„å†²çª</li>
</ul>
</li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–">#</a> æ€§èƒ½ä¼˜åŒ–</h3>
<ol>
<li>
<p><strong>ç­–ç•¥ç¼“å­˜</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜é¢‘ç¹ä½¿ç”¨çš„ç­–ç•¥</li>
<li>è®¾ç½®åˆé€‚çš„ç¼“å­˜è¿‡æœŸæ—¶é—´</li>
<li>åŠæ—¶æ›´æ–°ç¼“å­˜</li>
</ul>
</li>
<li>
<p><strong>æ‰¹é‡æ“ä½œ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ‰¹é‡ç»‘å®š/è§£ç»‘æ“ä½œ</li>
<li>é¿å…é¢‘ç¹çš„å•ä¸ªæ“ä½œ</li>
<li>åˆç†æ§åˆ¶å¹¶å‘æ•°</li>
</ul>
</li>
</ol>
<hr>
<div class="hint-container tip">
<p class="hint-container-title">æç¤º</p>
<p>å»ºè®®ä¸ºä¸åŒè§’è‰²åˆ›å»ºæ ‡å‡†åŒ–çš„ç­–ç•¥æ¨¡æ¿ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ã€‚</p>
</div>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>ç­–ç•¥æ›´æ–°ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè¯·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…æ“ä½œï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ã€‚</p>
</div>
</div></template>


