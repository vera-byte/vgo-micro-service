<template><div><h1 id="å®‰è£…æŒ‡å—" tabindex="-1"><a class="header-anchor" href="#å®‰è£…æŒ‡å—">#</a> å®‰è£…æŒ‡å—</h1>
<p>æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†VGOå¾®æœåŠ¡çš„å„ç§å®‰è£…æ–¹å¼ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„å®‰è£…æ–¹æ³•ã€‚</p>
<h2 id="ğŸ“¦-å®‰è£…æ–¹å¼æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“¦-å®‰è£…æ–¹å¼æ¦‚è§ˆ">#</a> ğŸ“¦ å®‰è£…æ–¹å¼æ¦‚è§ˆ</h2>
<table>
<thead>
<tr>
<th>å®‰è£…æ–¹å¼</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>éš¾åº¦</th>
<th>æ¨èåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker Compose</td>
<td>å¼€å‘ã€æµ‹è¯•</td>
<td>â­</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td>äºŒè¿›åˆ¶æ–‡ä»¶</td>
<td>ç”Ÿäº§ç¯å¢ƒ</td>
<td>â­â­</td>
<td>â­â­â­â­</td>
</tr>
<tr>
<td>æºç ç¼–è¯‘</td>
<td>å®šåˆ¶å¼€å‘</td>
<td>â­â­â­</td>
<td>â­â­â­</td>
</tr>
<tr>
<td>Kubernetes</td>
<td>äº‘åŸç”Ÿç¯å¢ƒ</td>
<td>â­â­â­â­</td>
<td>â­â­â­â­â­</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ³-docker-compose-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ğŸ³-docker-compose-å®‰è£…">#</a> ğŸ³ Docker Compose å®‰è£…</h2>
<h3 id="ç³»ç»Ÿè¦æ±‚" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿè¦æ±‚">#</a> ç³»ç»Ÿè¦æ±‚</h3>
<ul>
<li>Docker 20.10+</li>
<li>Docker Compose 2.0+</li>
<li>è‡³å°‘ 2GB å¯ç”¨å†…å­˜</li>
<li>è‡³å°‘ 5GB å¯ç”¨ç£ç›˜ç©ºé—´</li>
</ul>
<h3 id="å®‰è£…æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#å®‰è£…æ­¥éª¤">#</a> å®‰è£…æ­¥éª¤</h3>
<h4 id="_1-è·å–é¡¹ç›®ä»£ç " tabindex="-1"><a class="header-anchor" href="#_1-è·å–é¡¹ç›®ä»£ç ">#</a> 1. è·å–é¡¹ç›®ä»£ç </h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ä½¿ç”¨Gitå…‹éš†</span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/vera-byte/vgo_micro_service.git</span>
<span class="line"><span class="token builtin class-name">cd</span> vgo_micro_service</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æˆ–è€…ä¸‹è½½å‹ç¼©åŒ…</span></span>
<span class="line"><span class="token function">wget</span> https://github.com/vera-byte/vgo_micro_service/archive/main.zip</span>
<span class="line"><span class="token function">unzip</span> main.zip</span>
<span class="line"><span class="token builtin class-name">cd</span> vgo_micro_service-main</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-é…ç½®ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®ç¯å¢ƒå˜é‡">#</a> 2. é…ç½®ç¯å¢ƒå˜é‡</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿</span></span>
<span class="line"><span class="token function">cp</span> .env.example .env</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç¼–è¾‘ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span class="token function">vim</span> .env</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³é”®é…ç½®é¡¹ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ•°æ®åº“é…ç½®</span></span>
<span class="line"><span class="token assign-left variable">POSTGRES_DB</span><span class="token operator">=</span>vgo_iam</span>
<span class="line"><span class="token assign-left variable">POSTGRES_USER</span><span class="token operator">=</span>vgo_iam</span>
<span class="line"><span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>your_secure_password</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æœåŠ¡é…ç½®</span></span>
<span class="line"><span class="token assign-left variable">GRPC_PORT</span><span class="token operator">=</span><span class="token number">50051</span></span>
<span class="line"><span class="token assign-left variable">HTTP_PORT</span><span class="token operator">=</span><span class="token number">8080</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å®‰å…¨é…ç½®</span></span>
<span class="line"><span class="token assign-left variable">MASTER_KEY</span><span class="token operator">=</span>your_master_key_here</span>
<span class="line"><span class="token assign-left variable">JWT_SECRET</span><span class="token operator">=</span>your_jwt_secret_here</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-å¯åŠ¨æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_3-å¯åŠ¨æœåŠ¡">#</a> 3. å¯åŠ¨æœåŠ¡</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># å¯åŠ¨æ‰€æœ‰æœåŠ¡</span></span>
<span class="line"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token function">ps</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æŸ¥çœ‹æ—¥å¿—</span></span>
<span class="line"><span class="token function">docker-compose</span> logs <span class="token parameter variable">-f</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-åˆå§‹åŒ–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_4-åˆå§‹åŒ–æ•°æ®">#</a> 4. åˆå§‹åŒ–æ•°æ®</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ç­‰å¾…æ•°æ®åº“å¯åŠ¨å®Œæˆ</span></span>
<span class="line"><span class="token function">sleep</span> <span class="token number">30</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è¿è¡Œæ•°æ®åº“è¿ç§»</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> vgo-iam ./bin/iam-service migrate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> vgo-iam ./bin/iam-service init-admin</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“-äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ğŸ“-äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…">#</a> ğŸ“ äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…</h2>
<h3 id="ä¸‹è½½é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸‹è½½é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶">#</a> ä¸‹è½½é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span>
<span class="line"><span class="token function">wget</span> https://github.com/vera-byte/vgo_micro_service/releases/latest/download/iam-service-linux-amd64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è§£å‹</span></span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xzf</span> iam-service-linux-amd64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç§»åŠ¨åˆ°ç³»ç»Ÿè·¯å¾„</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">mv</span> iam-service /usr/local/bin/</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/iam-service</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–‡ä»¶">#</a> é…ç½®æ–‡ä»¶</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºé…ç½®ç›®å½•</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/vgo-iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¸‹è½½é…ç½®æ¨¡æ¿</span></span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/vgo-iam/config.yaml https://raw.githubusercontent.com/vera-byte/vgo_micro_service/main/vgo-iam/config/config.yaml.example</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç¼–è¾‘é…ç½®</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/vgo-iam/config.yaml</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºç³»ç»ŸæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç³»ç»ŸæœåŠ¡">#</a> åˆ›å»ºç³»ç»ŸæœåŠ¡</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/vgo-iam.service <span class="token operator">></span> /dev/null <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">[Unit]</span>
<span class="line">Description=VGO IAM Service</span>
<span class="line">After=network.target postgresql.service</span>
<span class="line"></span>
<span class="line">[Service]</span>
<span class="line">Type=simple</span>
<span class="line">User=vgo-iam</span>
<span class="line">Group=vgo-iam</span>
<span class="line">ExecStart=/usr/local/bin/iam-service server --config /etc/vgo-iam/config.yaml</span>
<span class="line">Restart=always</span>
<span class="line">RestartSec=5</span>
<span class="line"></span>
<span class="line">[Install]</span>
<span class="line">WantedBy=multi-user.target</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ›å»ºç”¨æˆ·</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">useradd</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-s</span> /bin/false vgo-iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># é‡è½½systemdé…ç½®</span></span>
<span class="line"><span class="token function">sudo</span> systemctl daemon-reload</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯åŠ¨æœåŠ¡</span></span>
<span class="line"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> vgo-iam</span>
<span class="line"><span class="token function">sudo</span> systemctl start vgo-iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æŸ¥çœ‹çŠ¶æ€</span></span>
<span class="line"><span class="token function">sudo</span> systemctl status vgo-iam</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”¨-æºç ç¼–è¯‘å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ğŸ”¨-æºç ç¼–è¯‘å®‰è£…">#</a> ğŸ”¨ æºç ç¼–è¯‘å®‰è£…</h2>
<h3 id="ç³»ç»Ÿè¦æ±‚-1" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿè¦æ±‚-1">#</a> ç³»ç»Ÿè¦æ±‚</h3>
<ul>
<li>Go 1.19+</li>
<li>Git</li>
<li>Make</li>
<li>Protocol Buffersç¼–è¯‘å™¨</li>
</ul>
<h3 id="å®‰è£…ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ä¾èµ–">#</a> å®‰è£…ä¾èµ–</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># Ubuntu/Debian</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> update</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span> <span class="token function">make</span> protobuf-compiler</span>
<span class="line"></span>
<span class="line"><span class="token comment"># CentOS/RHEL</span></span>
<span class="line"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span> <span class="token function">make</span> protobuf-compiler</span>
<span class="line"></span>
<span class="line"><span class="token comment"># macOS</span></span>
<span class="line">brew <span class="token function">install</span> <span class="token function">git</span> <span class="token function">make</span> protobuf</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼–è¯‘æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘æ­¥éª¤">#</a> ç¼–è¯‘æ­¥éª¤</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># 1. å…‹éš†ä»£ç </span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/vera-byte/vgo_micro_service.git</span>
<span class="line"><span class="token builtin class-name">cd</span> vgo_micro_service/vgo-iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. å®‰è£…Goä¾èµ–</span></span>
<span class="line">go mod download</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. å®‰è£…protobufå·¥å…·</span></span>
<span class="line">go <span class="token function">install</span> google.golang.org/protobuf/cmd/protoc-gen-go@latest</span>
<span class="line">go <span class="token function">install</span> google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. ç”Ÿæˆprotobufä»£ç </span></span>
<span class="line"><span class="token function">make</span> proto</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5. ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶</span></span>
<span class="line"><span class="token function">make</span> build</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 6. è¿è¡Œæµ‹è¯•</span></span>
<span class="line"><span class="token function">make</span> <span class="token builtin class-name">test</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 7. å®‰è£…åˆ°ç³»ç»Ÿ</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼–è¯‘é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘é€‰é¡¹">#</a> ç¼–è¯‘é€‰é¡¹</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># ç¼–è¯‘ç‰¹å®šå¹³å°</span></span>
<span class="line"><span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 <span class="token function">make</span> build</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç¼–è¯‘æ‰€æœ‰å¹³å°</span></span>
<span class="line"><span class="token function">make</span> build-all</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç¼–è¯‘Dockeré•œåƒ</span></span>
<span class="line"><span class="token function">make</span> <span class="token function">docker</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç¼–è¯‘å¹¶æ¨é€Dockeré•œåƒ</span></span>
<span class="line"><span class="token function">make</span> docker-push</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="â˜¸ï¸-kubernetes-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#â˜¸ï¸-kubernetes-å®‰è£…">#</a> â˜¸ï¸ Kubernetes å®‰è£…</h2>
<h3 id="å‰ç½®è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#å‰ç½®è¦æ±‚">#</a> å‰ç½®è¦æ±‚</h3>
<ul>
<li>Kubernetes 1.20+</li>
<li>kubectl é…ç½®å®Œæˆ</li>
<li>Helm 3.0+ (å¯é€‰)</li>
</ul>
<h3 id="ä½¿ç”¨helmå®‰è£…-æ¨è" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨helmå®‰è£…-æ¨è">#</a> ä½¿ç”¨Helmå®‰è£…ï¼ˆæ¨èï¼‰</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># 1. æ·»åŠ Helmä»“åº“</span></span>
<span class="line">helm repo <span class="token function">add</span> vgo https://charts.vgo.dev</span>
<span class="line">helm repo update</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. åˆ›å»ºå‘½åç©ºé—´</span></span>
<span class="line">kubectl create namespace vgo-system</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. å®‰è£…VGO</span></span>
<span class="line">helm <span class="token function">install</span> vgo-iam vgo/vgo-iam <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--namespace</span> vgo-system <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--set</span> <span class="token assign-left variable">postgresql.enabled</span><span class="token operator">=</span>true <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--set</span> <span class="token assign-left variable">redis.enabled</span><span class="token operator">=</span>true</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. æŸ¥çœ‹å®‰è£…çŠ¶æ€</span></span>
<span class="line">kubectl get pods <span class="token parameter variable">-n</span> vgo-system</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨yamlæ–‡ä»¶å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨yamlæ–‡ä»¶å®‰è£…">#</a> ä½¿ç”¨YAMLæ–‡ä»¶å®‰è£…</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># 1. åº”ç”¨Kubernetesé…ç½®</span></span>
<span class="line">kubectl apply <span class="token parameter variable">-f</span> k8s/namespace.yaml</span>
<span class="line">kubectl apply <span class="token parameter variable">-f</span> k8s/postgres.yaml</span>
<span class="line">kubectl apply <span class="token parameter variable">-f</span> k8s/redis.yaml</span>
<span class="line">kubectl apply <span class="token parameter variable">-f</span> k8s/vgo-iam.yaml</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€</span></span>
<span class="line">kubectl get all <span class="token parameter variable">-n</span> vgo-system</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—</span></span>
<span class="line">kubectl logs <span class="token parameter variable">-f</span> deployment/vgo-iam <span class="token parameter variable">-n</span> vgo-system</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®ingress" tabindex="-1"><a class="header-anchor" href="#é…ç½®ingress">#</a> é…ç½®Ingress</h3>
<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre v-pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam<span class="token punctuation">-</span>ingress</span>
<span class="line">  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>system</span>
<span class="line">  <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> nginx</span>
<span class="line">    <span class="token key atrule">cert-manager.io/cluster-issuer</span><span class="token punctuation">:</span> letsencrypt<span class="token punctuation">-</span>prod</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">tls</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> iam.yourdomain.com</span>
<span class="line">    <span class="token key atrule">secretName</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam<span class="token punctuation">-</span>tls</span>
<span class="line">  <span class="token key atrule">rules</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> iam.yourdomain.com</span>
<span class="line">    <span class="token key atrule">http</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /</span>
<span class="line">        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix</span>
<span class="line">        <span class="token key atrule">backend</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">service</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">name</span><span class="token punctuation">:</span> vgo<span class="token punctuation">-</span>iam</span>
<span class="line">            <span class="token key atrule">port</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8080</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-å®‰è£…åé…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-å®‰è£…åé…ç½®">#</a> ğŸ”§ å®‰è£…åé…ç½®</h2>
<h3 id="æ•°æ®åº“åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“åˆå§‹åŒ–">#</a> æ•°æ®åº“åˆå§‹åŒ–</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># Docker Composeç¯å¢ƒ</span></span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> vgo-iam ./bin/iam-service migrate</span>
<span class="line"><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> vgo-iam ./bin/iam-service init-admin</span>
<span class="line"></span>
<span class="line"><span class="token comment"># äºŒè¿›åˆ¶å®‰è£…</span></span>
<span class="line">iam-service migrate <span class="token parameter variable">--config</span> /etc/vgo-iam/config.yaml</span>
<span class="line">iam-service init-admin <span class="token parameter variable">--config</span> /etc/vgo-iam/config.yaml</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Kubernetesç¯å¢ƒ</span></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> deployment/vgo-iam <span class="token parameter variable">-n</span> vgo-system -- ./bin/iam-service migrate</span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> deployment/vgo-iam <span class="token parameter variable">-n</span> vgo-system -- ./bin/iam-service init-admin</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="éªŒè¯å®‰è£…" tabindex="-1"><a class="header-anchor" href="#éªŒè¯å®‰è£…">#</a> éªŒè¯å®‰è£…</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:8080/health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æµ‹è¯•gRPCæ¥å£</span></span>
<span class="line">grpcurl <span class="token parameter variable">-plaintext</span> localhost:50051 grpc.health.v1.Health/Check</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¿é—®è°ƒè¯•ç•Œé¢</span></span>
<span class="line"><span class="token function">open</span> http://localhost:8080</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš¨-æ•…éšœæ’é™¤" tabindex="-1"><a class="header-anchor" href="#ğŸš¨-æ•…éšœæ’é™¤">#</a> ğŸš¨ æ•…éšœæ’é™¤</h2>
<h3 id="å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é—®é¢˜">#</a> å¸¸è§é—®é¢˜</h3>
<h4 id="_1-ç«¯å£è¢«å ç”¨" tabindex="-1"><a class="header-anchor" href="#_1-ç«¯å£è¢«å ç”¨">#</a> 1. ç«¯å£è¢«å ç”¨</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æŸ¥çœ‹ç«¯å£å ç”¨</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">netstat</span> <span class="token parameter variable">-tlnp</span> <span class="token operator">|</span> <span class="token function">grep</span> :8080</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">netstat</span> <span class="token parameter variable">-tlnp</span> <span class="token operator">|</span> <span class="token function">grep</span> :50051</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£</span></span>
<span class="line"><span class="token function">vim</span> config/config.yaml</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-æ•°æ®åº“è¿æ¥å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®åº“è¿æ¥å¤±è´¥">#</a> 2. æ•°æ®åº“è¿æ¥å¤±è´¥</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ£€æŸ¥PostgreSQLçŠ¶æ€</span></span>
<span class="line"><span class="token function">sudo</span> systemctl status postgresql</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æµ‹è¯•æ•°æ®åº“è¿æ¥</span></span>
<span class="line">psql <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-U</span> vgo_iam <span class="token parameter variable">-d</span> vgo_iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ£€æŸ¥é˜²ç«å¢™è®¾ç½®</span></span>
<span class="line"><span class="token function">sudo</span> ufw status</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-æƒé™é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-æƒé™é—®é¢˜">#</a> 3. æƒé™é—®é¢˜</h4>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># æ£€æŸ¥æ–‡ä»¶æƒé™</span></span>
<span class="line"><span class="token function">ls</span> <span class="token parameter variable">-la</span> /usr/local/bin/iam-service</span>
<span class="line"><span class="token function">ls</span> <span class="token parameter variable">-la</span> /etc/vgo-iam/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¿®å¤æƒé™</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> vgo-iam:vgo-iam /etc/vgo-iam/config.yaml</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> /etc/vgo-iam/config.yaml</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ—¥å¿—æŸ¥çœ‹" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—æŸ¥çœ‹">#</a> æ—¥å¿—æŸ¥çœ‹</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre v-pre><code class="language-bash"><span class="line"><span class="token comment"># Docker Compose</span></span>
<span class="line"><span class="token function">docker-compose</span> logs vgo-iam</span>
<span class="line"></span>
<span class="line"><span class="token comment"># SystemdæœåŠ¡</span></span>
<span class="line"><span class="token function">sudo</span> journalctl <span class="token parameter variable">-u</span> vgo-iam <span class="token parameter variable">-f</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Kubernetes</span></span>
<span class="line">kubectl logs <span class="token parameter variable">-f</span> deployment/vgo-iam <span class="token parameter variable">-n</span> vgo-system</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-ä¸‹ä¸€æ­¥" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-ä¸‹ä¸€æ­¥">#</a> ğŸ“š ä¸‹ä¸€æ­¥</h2>
<p>å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š</p>
<ol>
<li><RouteLink to="/guide/configuration.html">é…ç½®è¯¦è§£</RouteLink> - äº†è§£è¯¦ç»†é…ç½®é€‰é¡¹</li>
<li><RouteLink to="/guide/basic-usage.html">åŸºæœ¬ä½¿ç”¨</RouteLink> - å¼€å§‹ä½¿ç”¨VGOæœåŠ¡</li>
<li><a href="/api/" target="_blank" rel="noopener noreferrer">APIæ–‡æ¡£</a> - æŸ¥çœ‹APIæ¥å£æ–‡æ¡£</li>
</ol>
<div class="hint-container warning">
<p class="hint-container-title">æ³¨æ„</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·ç¡®ä¿ï¼š</p>
<ul>
<li>ä½¿ç”¨å¼ºå¯†ç å’Œå®‰å…¨çš„å¯†é’¥</li>
<li>é…ç½®é€‚å½“çš„é˜²ç«å¢™è§„åˆ™</li>
<li>å®šæœŸå¤‡ä»½æ•°æ®åº“</li>
<li>ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€</li>
</ul>
</div>
</div></template>


