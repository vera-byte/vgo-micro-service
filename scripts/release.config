# VGO微服务版本发布配置文件
# 此文件包含发布脚本的默认配置

# 项目配置
PROJECTS="vgo-kit vgo-iam vgo-gateway"
REPO_BASE="https://github.com/vera-byte"
REGISTRY="ghcr.io/vera-byte"

# Git配置
DEFAULT_BRANCH="main"
REQUIRE_CLEAN_WORKING_TREE=true
REQUIRE_SYNC_WITH_REMOTE=true

# 发布配置
AUTO_CREATE_RELEASE=true
AUTO_PUSH_TAGS=true
RUN_TESTS_BEFORE_RELEASE=true
RUN_LINT_BEFORE_RELEASE=true

# Docker配置
DOCKER_PLATFORMS="linux/amd64,linux/arm64"
DOCKER_BUILD_ARGS="--cache-from=type=gha --cache-to=type=gha,mode=max"

# 通知配置
NOTIFY_ON_SUCCESS=true
NOTIFY_ON_FAILURE=true

# Slack通知配置（可选）
# SLACK_WEBHOOK_URL=""
# SLACK_CHANNEL="#releases"

# 钉钉通知配置（可选）
# DINGTALK_WEBHOOK_URL=""

# 企业微信通知配置（可选）
# WECHAT_WEBHOOK_URL=""

# 版本规则
# 支持的版本格式：v1.0.0, v1.0.0-beta, v1.0.0-alpha.1
VERSION_PATTERN="^v[0-9]+\.[0-9]+\.[0-9]+(-[a-zA-Z0-9\.]+)?$"

# 发布顺序（重要：vgo-kit必须首先发布，因为其他项目依赖它）
RELEASE_ORDER="vgo-kit vgo-iam vgo-gateway"

# 超时配置（秒）
TEST_TIMEOUT=300
BUILD_TIMEOUT=600
DOCKER_BUILD_TIMEOUT=1200

# 重试配置
MAX_RETRIES=3
RETRY_DELAY=5

# 日志配置
LOG_LEVEL="INFO"  # DEBUG, INFO, WARN, ERROR
LOG_FILE="/tmp/vgo-release.log"
KEEP_LOG_DAYS=7

# 安全配置
REQUIRE_GPG_SIGNED_TAGS=false
REQUIRE_SIGNED_COMMITS=false

# 备份配置
BACKUP_BEFORE_RELEASE=true
BACKUP_DIR="/tmp/vgo-backup"

# 环境配置
GO_VERSION="1.24.1"
NODE_VERSION="18"
DOCKER_VERSION="24"

# CI/CD配置
GITHUB_ACTIONS_TIMEOUT=30  # 分钟
WAIT_FOR_CI_SUCCESS=true
CI_CHECK_INTERVAL=30  # 秒
CI_MAX_WAIT_TIME=1800  # 秒

# 发布后操作
AUTO_UPDATE_CHANGELOG=true
AUTO_CREATE_GITHUB_RELEASE=true
AUTO_NOTIFY_TEAM=true

# 回滚配置
ENABLE_ROLLBACK=true
ROLLBACK_TIMEOUT=300
KEEP_PREVIOUS_RELEASES=5

# 健康检查配置
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_TIMEOUT=60
HEALTH_CHECK_RETRIES=3

# 监控配置
MONITORING_ENABLED=true
METRICS_ENDPOINT="/metrics"
HEALTH_ENDPOINT="/health"

# 文档配置
AUTO_UPDATE_DOCS=true
DOCS_DIR="docs"
API_DOCS_DIR="docs/api"

# 测试配置
RUN_UNIT_TESTS=true
RUN_INTEGRATION_TESTS=true
RUN_E2E_TESTS=false
TEST_COVERAGE_THRESHOLD=80

# 代码质量配置
RUN_LINTER=true
RUN_SECURITY_SCAN=true
RUN_DEPENDENCY_CHECK=true
RUN_VULNERABILITY_SCAN=true

# 性能配置
PARALLEL_BUILDS=true
MAX_PARALLEL_JOBS=4
BUILD_CACHE_ENABLED=true

# 调试配置
DEBUG_MODE=false
VERBOSE_OUTPUT=false
DRY_RUN_MODE=false

# 兼容性配置
BACKWARD_COMPATIBILITY_CHECK=true
API_COMPATIBILITY_CHECK=true
SCHEMA_COMPATIBILITY_CHECK=true